var LichessTournamentSchedule=function(){"use strict";const e={createElement:function(e,t){return document.createElement(e,t)},createElementNS:function(e,t,n){return document.createElementNS(e,t,n)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,n){e.insertBefore(t,n)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},getTextContent:function(e){return e.textContent},isElement:function(e){return 1===e.nodeType},isText:function(e){return 3===e.nodeType},isComment:function(e){return 8===e.nodeType}};function t(e,t,n,o,r){return{sel:e,data:t,children:n,text:o,elm:r,key:void 0===t?void 0:t.key}}const n=Array.isArray;function o(e){return"string"==typeof e||"number"==typeof e}function r(e){return void 0===e}function i(e){return void 0!==e}const l=t("",{},[],void 0,void 0);function s(e,t){var n,o;const r=e.key===t.key,i=(null===(n=e.data)||void 0===n?void 0:n.is)===(null===(o=t.data)||void 0===o?void 0:o.is);return e.sel===t.sel&&r&&i}function a(e,t,n){var o;const r={};for(let i=t;i<=n;++i){const t=null===(o=e[i])||void 0===o?void 0:o.key;void 0!==t&&(r[t]=i)}return r}const c=["create","update","remove","destroy","pre","post"];function u(e,t,n){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==t)for(let e=0;e<t.length;++e){const n=t[e].data;void 0!==n&&u(n,t[e].children,t[e].sel)}}function d(e,r,i){let l,s,a,c={};if(void 0!==i?(null!==r&&(c=r),n(i)?l=i:o(i)?s=i:i&&i.sel&&(l=[i])):null!=r&&(n(r)?l=r:o(r)?s=r:r&&r.sel?l=[r]:c=r),void 0!==l)for(a=0;a<l.length;++a)o(l[a])&&(l[a]=t(void 0,void 0,void 0,l[a],void 0));return"s"!==e[0]||"v"!==e[1]||"g"!==e[2]||3!==e.length&&"."!==e[3]&&"#"!==e[3]||u(c,l,e),t(e,c,l,s,void 0)}function f(e,t){let n;const o=t.elm;let r=e.data.attrs,i=t.data.attrs;if((r||i)&&r!==i){for(n in r=r||{},i=i||{},i){const e=i[n];r[n]!==e&&(!0===e?o.setAttribute(n,""):!1===e?o.removeAttribute(n):120!==n.charCodeAt(0)?o.setAttribute(n,e):58===n.charCodeAt(3)?o.setAttributeNS("http://www.w3.org/XML/1998/namespace",n,e):58===n.charCodeAt(5)?o.setAttributeNS("http://www.w3.org/1999/xlink",n,e):o.setAttribute(n,e))}for(n in r)n in i||o.removeAttribute(n)}}const h={create:f,update:f};function m(e,t){let n,o;const r=t.elm;let i=e.data.class,l=t.data.class;if((i||l)&&i!==l){for(o in i=i||{},l=l||{},i)i[o]&&!Object.prototype.hasOwnProperty.call(l,o)&&r.classList.remove(o);for(o in l)n=l[o],n!==i[o]&&r.classList[n?"add":"remove"](o)}}const p={create:m,update:m};let v,g,x;const y={};function b(e){return 8*(6e4*Math.floor(e/1e3/60)-g)/1e3/60}function w(e){return e.schedule&&"unique"===e.schedule.freq?-1:"standard"!==e.variant.key?99:e.schedule&&e.hasMaxRating?50+parseInt(e.fullName.slice(1,5))/1e4:e.schedule&&"superBlitz"===e.schedule.speed?e.perf.position-.5:e.schedule&&"hyperBullet"===e.schedule.speed||e.schedule&&"ultraBullet"===e.perf.key?4:e.perf.position}function C(e,t){return!e.some((function(e){return!(e.finishesAt<=t.startsAt||t.finishesAt<=e.startsAt)}))}function T(e){const t=30===e.status,n="lichess"!==e.createdBy,o={"tsht-rated":e.rated,"tsht-casual":!e.rated,"tsht-finished":t,"tsht-joinable":!t,"tsht-user-created":n,"tsht-thematic":!!e.position,"tsht-short":e.minutes<=30,"tsht-max-rating":!n&&e.hasMaxRating};return e.schedule&&(o["tsht-"+e.schedule.freq]=!0),o}function k(e,t){return e.schedule&&"shield"===e.schedule.freq?"5":t}let A;function N(){const e=new Date(g);e.setSeconds(0),e.setMinutes(10*Math.floor(e.getMinutes()/10));const t=[],n=(x-g)/6e5;for(let o=0;o<n;o++)t.push(d("div.timeheader",{class:{hour:!e.getMinutes()},attrs:{style:"left: "+b(e.getTime())+"px"}},E(e))),e.setUTCMinutes(e.getUTCMinutes()+10);return t.push(d("div.timeheader.now",{attrs:{style:"left: "+b(v)+"px"}})),d("div.timeline",t)}function E(e){return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}function M(e){v=Date.now(),g=v-108e5,x=g+36e6;const t=e.data(),n=[],o=[];t.finished.concat(t.started).concat(t.created).filter((e=>e.finishesAt>g)).forEach((e=>{!function(e){return!!e.schedule}(e)?o.push(e):n.push(e)}));const r=function(e){let t,n=[];return e.forEach((e=>{const o=[[]];e.forEach((e=>{let n=!0;for(t=0;t<o.length;t++)if(C(o[t],e)){o[t].push(e),n=!1;break}n&&o.push([e])})),n=n.concat(o)})),n}(function(e,t){const n={};let o;return e.forEach((e=>{o=t(e),n[o]||(n[o]=[]),n[o].push(e)})),Object.keys(n).sort().map((function(e){return n[e]}))}(n,w).concat([o])).filter((e=>e.length>0));return d("div.tour-chart",[d("div.tour-chart__inner.dragscroll.",{hook:{insert:e=>{const t=e.elm,n=v+9e5;t.scrollLeft=b(n-t.clientWidth/2.5/8*60*1e3),t.addEventListener("mousedown",(e=>{A=[e.clientX,e.clientY]})),t.addEventListener("click",(e=>!((A?Math.abs(e.clientX-A[0])+Math.abs(e.clientY-A[1]):0)>20)||(e.preventDefault(),!1)))}}},[N(),...r.map((t=>d("div.tournamentline",t.map((t=>function(e,t){let n=8*t.minutes;const o=b(t.startsAt),r=t.minutes<90?0:Math.max(0,Math.min(n-250,b(v)-o-380));return n=Math.min(n,b(x)-o),d("a.tsht",{class:T(t),attrs:{href:"/tournament/"+t.id,style:"width: "+n+"px; left: "+o+"px; padding-left: "+r+"px"}},[d("span.icon",t.perf?{attrs:{"data-icon":k(t,t.perf.icon),title:t.perf.name}}:{}),d("span.body",[d("span.name",(l=t,y[l.id]||(y[l.id]=l.fullName),y[l.id])),d("span.infos",[d("span.text",[(i=t.clock,function(e){switch(e){case 15:return"¼";case 30:return"½";case 45:return"¾";case 90:return"1.5";default:return e/60}}(i.limit)+"+"+i.increment+" "),"standard"===t.variant.key?null:t.variant.name+" ",t.position?"Thematic ":null,t.rated?e.trans("ratedTournament"):e.trans("casualTournament")]),t.nbPlayers?d("span.nb-players",{attrs:{"data-icon":"r"}},t.nbPlayers):null])])]);var i,l}(e,t))))))])])}var S,B;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;(function(e,t){var n,o,r,i,l,s,a,c,u,d,f,h,m;n=t,i=window,l=document,s="mousemove",a="mouseup",c="mousedown",d="add"+(u="EventListener"),f="remove"+u,h=[],m=function(e,t){for(e=0;e<h.length;)(t=(t=h[e++]).container||t)[f](c,t.md,0),i[f](a,t.mu,0),i[f](s,t.mm,0);for(h=[].slice.call(l.getElementsByClassName("dragscroll")),e=0;e<h.length;)!function(e,t,n,u,f,h){(h=e.container||e)[d](c,h.md=function(o){e.hasAttribute("nochilddrag")&&l.elementFromPoint(o.pageX,o.pageY)!=h||(u=1,t=o.clientX,n=o.clientY,o.preventDefault())},0),i[d](a,h.mu=function(){u=0},0),i[d](s,h.mm=function(i){u&&((f=e.scroller||e).scrollLeft-=o=-t+(t=i.clientX),f.scrollTop-=r=-n+(n=i.clientY),e==l.body&&((f=l.documentElement).scrollLeft-=o,f.scrollTop-=r))},0)}(h[e++])},"complete"==l.readyState?m():i[d]("load",m,0),n.reset=m})(B={path:S,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&B.path)}},B.exports),B.exports;const L=function(u,d){let f,h;const m={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},p=void 0!==d?d:e;for(f=0;f<c.length;++f)for(m[c[f]]=[],h=0;h<u.length;++h){const e=u[h][c[f]];void 0!==e&&m[c[f]].push(e)}function v(e){const n=e.id?"#"+e.id:"",o=e.className?"."+e.className.split(" ").join("."):"";return t(p.tagName(e).toLowerCase()+n+o,{},[],void 0,e)}function g(e,t){return function(){if(0==--t){const t=p.parentNode(e);p.removeChild(t,e)}}}function x(e,t){var s,a;let c,u=e.data;if(void 0!==u){const t=null===(s=u.hook)||void 0===s?void 0:s.init;i(t)&&(t(e),u=e.data)}const d=e.children,f=e.sel;if("!"===f)r(e.text)&&(e.text=""),e.elm=p.createComment(e.text);else if(void 0!==f){const r=f.indexOf("#"),s=f.indexOf(".",r),h=r>0?r:f.length,v=s>0?s:f.length,g=-1!==r||-1!==s?f.slice(0,Math.min(h,v)):f,y=e.elm=i(u)&&i(c=u.ns)?p.createElementNS(c,g,u):p.createElement(g,u);for(h<v&&y.setAttribute("id",f.slice(h+1,v)),s>0&&y.setAttribute("class",f.slice(v+1).replace(/\./g," ")),c=0;c<m.create.length;++c)m.create[c](l,e);if(n(d))for(c=0;c<d.length;++c){const e=d[c];null!=e&&p.appendChild(y,x(e,t))}else o(e.text)&&p.appendChild(y,p.createTextNode(e.text));const b=e.data.hook;i(b)&&(null===(a=b.create)||void 0===a||a.call(b,l,e),b.insert&&t.push(e))}else e.elm=p.createTextNode(e.text);return e.elm}function y(e,t,n,o,r,i){for(;o<=r;++o){const r=n[o];null!=r&&p.insertBefore(e,x(r,i),t)}}function b(e){var t,n;const o=e.data;if(void 0!==o){null===(n=null===(t=null==o?void 0:o.hook)||void 0===t?void 0:t.destroy)||void 0===n||n.call(t,e);for(let t=0;t<m.destroy.length;++t)m.destroy[t](e);if(void 0!==e.children)for(let t=0;t<e.children.length;++t){const n=e.children[t];null!=n&&"string"!=typeof n&&b(n)}}}function w(e,t,n,o){for(var r,l;n<=o;++n){let o,s;const a=t[n];if(null!=a)if(i(a.sel)){b(a),o=m.remove.length+1,s=g(a.elm,o);for(let e=0;e<m.remove.length;++e)m.remove[e](a,s);const e=null===(l=null===(r=null==a?void 0:a.data)||void 0===r?void 0:r.hook)||void 0===l?void 0:l.remove;i(e)?e(a,s):s()}else p.removeChild(e,a.elm)}}function C(e,t,n){var o,l,c,u,d;const f=null===(o=t.data)||void 0===o?void 0:o.hook;null===(l=null==f?void 0:f.prepatch)||void 0===l||l.call(f,e,t);const h=t.elm=e.elm,v=e.children,g=t.children;if(e!==t){if(void 0!==t.data){for(let n=0;n<m.update.length;++n)m.update[n](e,t);null===(u=null===(c=t.data.hook)||void 0===c?void 0:c.update)||void 0===u||u.call(c,e,t)}r(t.text)?i(v)&&i(g)?v!==g&&function(e,t,n,o){let i,l,c,u,d=0,f=0,h=t.length-1,m=t[0],v=t[h],g=n.length-1,b=n[0],T=n[g];for(;d<=h&&f<=g;)null==m?m=t[++d]:null==v?v=t[--h]:null==b?b=n[++f]:null==T?T=n[--g]:s(m,b)?(C(m,b,o),m=t[++d],b=n[++f]):s(v,T)?(C(v,T,o),v=t[--h],T=n[--g]):s(m,T)?(C(m,T,o),p.insertBefore(e,m.elm,p.nextSibling(v.elm)),m=t[++d],T=n[--g]):s(v,b)?(C(v,b,o),p.insertBefore(e,v.elm,m.elm),v=t[--h],b=n[++f]):(void 0===i&&(i=a(t,d,h)),l=i[b.key],r(l)?p.insertBefore(e,x(b,o),m.elm):(c=t[l],c.sel!==b.sel?p.insertBefore(e,x(b,o),m.elm):(C(c,b,o),t[l]=void 0,p.insertBefore(e,c.elm,m.elm))),b=n[++f]);(d<=h||f<=g)&&(d>h?(u=null==n[g+1]?null:n[g+1].elm,y(e,u,n,f,g,o)):w(e,t,d,h))}(h,v,g,n):i(g)?(i(e.text)&&p.setTextContent(h,""),y(h,null,g,0,g.length-1,n)):i(v)?w(h,v,0,v.length-1):i(e.text)&&p.setTextContent(h,""):e.text!==t.text&&(i(v)&&w(h,v,0,v.length-1),p.setTextContent(h,t.text)),null===(d=null==f?void 0:f.postpatch)||void 0===d||d.call(f,e,t)}}return function(e,t){let n,o,r;const i=[];for(n=0;n<m.pre.length;++n)m.pre[n]();for(function(e){return void 0!==e.sel}(e)||(e=v(e)),s(e,t)?C(e,t,i):(o=e.elm,r=p.parentNode(o),x(t,i),null!==r&&(p.insertBefore(r,t.elm,p.nextSibling(o)),w(r,[e],0,0))),n=0;n<i.length;++n)i[n].data.hook.insert(i[n]);for(n=0;n<m.post.length;++n)m.post[n]();return t}}([p,h]);function q(e,t){const n=(new Date).getTime();return t.concat(e.filter((e=>!e.schedule||e.finishesAt<n)))}return function(e){lichess.StrongSocket.defaultParams.flag="tournament";const t=document.querySelector(".tour-chart"),n={data:()=>e.data,trans:lichess.trans(e.i18n)};let o;function r(){o=L(o||t,M(n))}r(),setInterval(r,3700),lichess.pubsub.on("socket.in.reload",(t=>{e.data={created:q(e.data.created,t.created),started:q(e.data.started,t.started),finished:q(e.data.finished,t.finished)},r()}))}}();
