!function(){"use strict";var t,e,n=(function(t){!function(){function e(t,n){if(!(this instanceof e))return new e(t,n);if(!t||"TABLE"!==t.tagName)throw new Error("Element must be a table");this.init(t,n||{})}var n=[],r=function(t){var e;return window.CustomEvent&&"function"==typeof window.CustomEvent?e=new CustomEvent(t):(e=document.createEvent("CustomEvent")).initCustomEvent(t,!1,!1,void 0),e},o=function(t){return t.getAttribute("data-sort")||t.textContent||t.innerText||""},i=function(t,e){return(t=t.trim().toLowerCase())===(e=e.trim().toLowerCase())?0:t<e?1:-1},s=function(t,e){return[].slice.call(t).find((function(t){return t.getAttribute("data-sort-column-key")===e}))},a=function(t,e){return function(n,r){var o=t(n.td,r.td);return 0===o?e?r.index-n.index:n.index-r.index:o}};e.extend=function(t,e,r){if("function"!=typeof e||"function"!=typeof r)throw new Error("Pattern and sort must be a function");n.push({name:t,pattern:e,sort:r})},e.prototype={init:function(t,e){var n,r,o,i,s=this;if(s.table=t,s.thead=!1,s.options=e,t.rows&&t.rows.length>0)if(t.tHead&&t.tHead.rows.length>0){for(o=0;o<t.tHead.rows.length;o++)if("thead"===t.tHead.rows[o].getAttribute("data-sort-method")){n=t.tHead.rows[o];break}n||(n=t.tHead.rows[t.tHead.rows.length-1]),s.thead=!0}else n=t.rows[0];if(n){var a=function(){s.current&&s.current!==this&&s.current.removeAttribute("aria-sort"),s.current=this,s.sortTable(this)};for(o=0;o<n.cells.length;o++)(i=n.cells[o]).setAttribute("role","columnheader"),"none"!==i.getAttribute("data-sort-method")&&(i.tabindex=0,i.addEventListener("click",a,!1),null!==i.getAttribute("data-sort-default")&&(r=i));r&&(s.current=r,s.sortTable(r))}},sortTable:function(t,e){var c=this,d=t.getAttribute("data-sort-column-key"),l=t.cellIndex,u=i,f="",h=[],g=c.thead?0:1,m=t.getAttribute("data-sort-method"),b=t.getAttribute("aria-sort");if(c.table.dispatchEvent(r("beforeSort")),e||(b="ascending"===b?"descending":"descending"===b?"ascending":c.options.descending?"descending":"ascending",t.setAttribute("aria-sort",b)),!(c.table.rows.length<2)){if(!m){for(;h.length<3&&g<c.table.tBodies[0].rows.length;)(f=(f=(A=d?s(c.table.tBodies[0].rows[g].cells,d):c.table.tBodies[0].rows[g].cells[l])?o(A):"").trim()).length>0&&h.push(f),g++;if(!h)return}for(g=0;g<n.length;g++)if(f=n[g],m){if(f.name===m){u=f.sort;break}}else if(h.every(f.pattern)){u=f.sort;break}for(c.col=l,g=0;g<c.table.tBodies.length;g++){var p,w=[],y={},v=0,x=0;if(!(c.table.tBodies[g].rows.length<2)){for(p=0;p<c.table.tBodies[g].rows.length;p++){var A;"none"===(f=c.table.tBodies[g].rows[p]).getAttribute("data-sort-method")?y[v]=f:(A=d?s(f.cells,d):f.cells[c.col],w.push({tr:f,td:A?o(A):"",index:v})),v++}for("descending"===b?w.sort(a(u,!0)):(w.sort(a(u,!1)),w.reverse()),p=0;p<v;p++)y[p]?(f=y[p],x++):f=w[p-x].tr,c.table.tBodies[g].appendChild(f)}}c.table.dispatchEvent(r("afterSort"))}},refresh:function(){void 0!==this.current&&this.sortTable(this.current,!0)}},t.exports?t.exports=e:window.Tablesort=e}()}(e={path:t,exports:{},require:function(t,n){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==n&&e.path)}},e.exports),e.exports);const r=t=>t.replace(/[^\-?0-9.]/g,""),o=(t,e)=>(t=parseFloat(t),e=parseFloat(e),(t=isNaN(t)?0:t)-(e=isNaN(e)?0:e));const i={cache:"no-cache",credentials:"same-origin"},s={"X-Requested-With":"XMLHttpRequest"},a=(t,e={})=>fetch(t,Object.assign(Object.assign(Object.assign({},i),{headers:Object.assign({},s)}),e)),c=t=>{const e=t.getAttribute("action");return e?((t,e={})=>a(t,e).then((t=>{if(t.ok)return t.text();throw t.statusText})))(e,{method:t.method,body:new FormData(t)}):Promise.reject(`Form has no action: ${t}`)};lichess.load.then((()=>{l(),d(),u()}));const d=()=>{const t=document.querySelector(".mod-games__filter-form");$(t).find("select").on("change",(()=>t.submit()))},l=()=>{const t=document.querySelector("table.game-list");n.extend("number",(t=>t.match(/^[-+]?(\d)*-?([,\.]){0,1}-?(\d)+([E,e][\-+][\d]+)?%?$/)),((t,e)=>o(r(e),r(t)))),n(t,{descending:!0});const e=f(t);h(t,e),g(t)},u=()=>{const t=document.querySelector(".mod-games__analysis-form"),e=function(t,e,n=!1){let r,o=0;return function(...i){const s=this;r&&clearTimeout(r),r=void 0;const a=performance.now()-o;o=performance.now(),n&&a>e?t.apply(s,i):r=setTimeout((()=>{r=void 0,t.apply(s,i)}),e)}}((()=>c(t).then((()=>{confirm("Analysis completed. Reload the page?")&&lichess.reload()}))),1e3);$(t).on("click","button",(n=>{const r=n.target.getAttribute("value"),o=t.querySelectorAll("input:checked").length;if(o<1)return!1;if("analyse"==r){if(o>=20&&!confirm(`Analyse ${o} games?`))return;return $(t).find('button[value="analyse"]').text("Sent").prop("disabled",!0),e(),!1}}))},f=t=>{let e;return(n,r)=>{r&&e&&n!=e&&((e,n)=>{let r=!1;for(const o of t.querySelectorAll("tbody input"))if(e==o||n==o){if(r)return;r=!0}else r&&(o.checked=n.checked)})(e,n),e=n}},h=(t,e)=>$(t).on("click","td:first-child",(t=>{if("INPUT"==t.target.tagName)e(t.target,t.shiftKey);else{const n=t.target.querySelector("input");n&&(n.checked=!n.checked,e(n,t.shiftKey))}})),g=t=>$(t).find("thead input").on("change",(e=>$(t).find("tbody input").prop("checked",e.target.checked)))}();
