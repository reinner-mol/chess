!function(){"use strict";lichess.load.then((()=>{const e=window.location.host,t=new RegExp(e+"/study/(?:embed/)?(\\w{8})/(\\w{8})(#\\d+)?\\b"),n=new RegExp(e+"/(?:embed/)?(\\w{8})(?:(?:/(white|black))|\\w{4}|)(#\\d+)?\\b"),r=["training","analysis","insights","practice","features","password","streamer","timeline"];function i(e){const i=function(e){if(!e)return;const t=e.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch)?(?:\?v=)?([^"&?/ ]{11})(?:\?|&|)(\S*)/i);if(!t)return;let n=1;t[2].split("&").forEach((e=>{const t=e.split("=");if("t"===t[0]||"start"===t[0])if(t[1].match(/^\d+$/))n=parseInt(t[1]);else{const e=t[1].match(/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?/);n=e?3600*(parseInt(e[1])||0)+60*(parseInt(e[2])||0)+(parseInt(e[3])||0):0}}));const r="modestbranding=1&rel=0&controls=2&iv_load_policy=3&start="+n;return"https://www.youtube.com/embed/"+t[1]+"?"+r}(e.href);if(i)return{type:"youtube",src:i};let s=e.href.match(t);if(s&&s[2]&&e.text.match(t))return{type:"study",src:"/study/embed/"+s[1]+"/"+s[2]+(s[3]||"")};if(s=e.href.match(n),s&&s[1]&&!r.includes(s[1])&&e.text.match(n)){let e="/embed/"+s[1];return s[2]&&(e+="/"+s[2]),s[3]&&(e+=s[3]),{type:"game",src:e}}}function s(e){const t=$("<iframe>").addClass("analyse "+e.type).attr("src",e.src);return $(e.element).replaceWith($('<div class="embed">').prepend(t)),t.on("load",(function(){var e;(null===(e=this.contentDocument)||void 0===e?void 0:e.title.startsWith("404"))&&(this.style.height="100px")})).on("mouseenter",(function(){this.focus()}))}const a=["blue","blue2","blue3","blue-marble","canvas","wood","wood2","wood3","wood4","maple","maple2","brown","leather","green","marble","green-plastic","grey","metal","olive","newspaper","purple","purple-diag","pink","ic","horsey"];function c(e){if(e.includes("://"))return e;const t=new URL(e,window.location.href),n=a.find((e=>document.body.classList.contains(e)));return n&&t.searchParams.append("theme",n),t.searchParams.append("bg",document.body.getAttribute("data-theme")),t.href}const o=Array.from(document.querySelectorAll(".expand-text a")).map((e=>{const t=i(e);return!!t&&{element:e,parent:e.parentNode,type:t.type,src:c(t.src)}})).filter((e=>e));!function e(t,n=100){n=Math.min(1500,n);const r=t.shift();r&&function(e){const t=$('<div class="embed"><iframe src="'+e.src+'"></iframe></div>');return $(e.element).replaceWith(t),t}(r).find("iframe").on("load",(function(){setTimeout((function(){e(t,n+200)}),n)}))}(o.filter((e=>"youtube"===e.type))),function e(t,n=100){const r=t.shift();n=Math.min(1500,n),r&&s(r).on("load",(()=>{setTimeout((()=>e(t,n+200)),n)}))}(o.filter((e=>"study"===e.type)).map((e=>(e.element.classList.add("embedding_analyse"),e.element.innerHTML='<div class="spinner"><svg viewBox="0 0 40 40"><circle cx=20 cy=20 r=18 fill="none"></circle></svg></div>',e)))),function(e){(function(e){const t=[];let n={parent:null,index:-1};return e.forEach((e=>{e.parent===n.parent?t[n.index].push(e):(n={parent:e.parent,index:n.index+1},t[n.index]=[e])})),t})(e).forEach((e=>{e.length<3?e.forEach(s):e.forEach((e=>{e.element.title="Click to expand",e.element.classList.add("text"),e.element.setAttribute("data-icon","="),e.element.addEventListener("click",(function(t){0===t.button&&(t.preventDefault(),s(e))}))}))}))}(o.filter((e=>"game"===e.type)))}))}();
