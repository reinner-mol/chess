!function(){"use strict";const e={cache:"no-cache",credentials:"same-origin"},o={"X-Requested-With":"XMLHttpRequest"},t=(e,o={})=>n(e,o).then((e=>{if(e.ok)return e.text();throw e.statusText})),n=(t,n={})=>fetch(t,Object.assign(Object.assign(Object.assign({},e),{headers:Object.assign({},o)}),n)),s=e=>{const o=new FormData;for(const t of Object.keys(e))o.append(t,e[t]);return o};function a(e,o,t){a.close();const n=$('<div id="modal-wrap"><span class="close" data-icon="L"></span></div>'),s=$(`<div id="modal-overlay" class="${o}">`).on("click",a.close);return n.appendTo(s),e.clone().removeClass("none").appendTo(n),a.onClose=t,n.find(".close").on("click",a.close),n.on("click",(e=>e.stopPropagation())),$("body").addClass("overlayed").prepend(s),n}a.close=()=>{$("body").removeClass("overlayed"),$("#modal-overlay").each((function(){a.onClose&&a.onClose(),$(this).remove()})),delete a.onClose},a.onClose=void 0,lichess.load.then((()=>{let e=!0,o=!1;const n=()=>$(".auto-refresh").toggleClass("active",e).toggleClass("hold",o),c=()=>t("/mod/public-chat").then((e=>{$(e).find("#communication").appendTo($("#comm-wrap").empty()),i()})),i=()=>{$("#communication").append($('<a class="auto-refresh button">Auto refresh</a>').on("click",(()=>{e=!e,n()}))),n(),$("#communication .chat").each((function(){this.scrollTop=99999})),$("#communication").on("mouseenter",".chat",(()=>{o=!0,$(".auto-refresh").addClass("hold")})).on("mouseleave",".chat",(()=>{o=!1,$(".auto-refresh").removeClass("hold")})),$("#communication").on("click",".line:not(.lichess)",(function(){const e=$(this),o=e.parents(".game").data("room"),n=e.parents(".game").data("chan"),i=a($(".timeout-modal"));i.find(".username").text(e.find(".user-link").text()),i.find(".text").text(e.text().split(" ").slice(1).join(" ")),i.on("click",".button",(function(){a.close(),t("/mod/public-chat/timeout",{method:"post",body:s({roomId:o,chan:n,userId:i.find(".username").text().toLowerCase(),reason:this.value,text:i.find(".text").text()})}).then((e=>setTimeout(c,1e3)))}))}))};i(),setInterval((function(){e&&"hidden"!==document.visibilityState&&!o&&c()}),5e3)}))}();
