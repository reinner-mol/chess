var UserComplete=function(){"use strict";const e={Accept:"application/vnd.lichess.v5+json"},t={cache:"no-cache",credentials:"same-origin"},n={"X-Requested-With":"XMLHttpRequest"};function o(e){const t=e.minLength||3,n=e.empty||(()=>'<div class="complete-list__empty">No results.</div>'),o=new Map,s=()=>{if(null!==c)return a[c]},r=t=>{const n=a.length;c=(null===c?1==t?0:-1:c+t)%n,c<0&&(c+=n),l();const o=s();o&&(e.input.value=e.populate(o))},l=()=>{i.find(".complete-selected").removeClass("complete-selected"),null!==c&&i.find(".complete-result").eq(c).addClass("complete-selected")},i=$('<div class="complete-list none"></div>').insertAfter(e.input);let c=null,a=[];e.input.autocomplete="off";const u=()=>{const n=e.input.value.trim();n.length>=t&&(!e.regex||n.match(e.regex))?(t=>o.has(t)?new Promise((e=>setTimeout((()=>e(o.get(t))),50))):t.length>3&&Array.from({length:t.length-3},((e,t)=>-t-1)).map((e=>t.slice(0,e))).some((e=>o.has(e)&&!o.get(e).length))?Promise.resolve([]):e.fetch(t).then((e=>(o.set(t,e),e))))(n).then(p,console.log):i.addClass("none")};$(e.input).on({input:u,focus:u,blur:()=>(setTimeout((()=>i.addClass("none")),100),!0),keydown(t){if(!i.hasClass("none")){if("ArrowDown"==t.code)return r(1),!1;if("ArrowUp"==t.code)return r(-1),!1;if("Enter"==t.code){i.addClass("none");const t=s()||(a[0]&&e.populate(a[0])==e.input.value?a[0]:void 0);if(t)return e.onSelect&&e.onSelect(t),!1}}}});const p=t=>{i.empty(),t[0]?t.forEach((t=>$(e.render(t)).on("mousedown touchdown",(()=>{const n=e.populate(t);return e.input.value=n,e.onSelect&&e.onSelect(t),!0})).appendTo(i))):i.html(n()),a=t,c=null,l(),i.removeClass("none")}}function s(e){return"function"==typeof e?e():e}function r(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e}return function(l){const i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=void 0,l=void 0,i=void 0,c=[];return function(){var u=s(t),p=(new Date).getTime(),m=!o||p-o>u;o=p;for(var d=arguments.length,h=Array(d),f=0;f<d;f++)h[f]=arguments[f];if(m&&n.leading)return n.accumulate?Promise.resolve(e.call(this,[h])).then((function(e){return e[0]})):Promise.resolve(e.call.apply(e,[this].concat(h)));if(l?clearTimeout(i):l=r(),c.push(h),i=setTimeout(a.bind(this),u),n.accumulate){var v=c.length-1;return l.promise.then((function(e){return e[v]}))}return l.promise};function a(){var t=l;clearTimeout(i),Promise.resolve(n.accumulate?e.call(this,c):e.apply(this,c[c.length-1])).then(t.resolve,t.reject),c=[],l=null}}((o=>((o,s={})=>fetch(o,Object.assign(Object.assign(Object.assign({},t),{headers:Object.assign(Object.assign({},e),n)}),s)).then((e=>{if(e.ok)return e.json();throw e.statusText})))(((e,t)=>{const n=new URLSearchParams;for(const e of Object.keys(t))void 0!==t[e]&&n.append(e,t[e]);const o=n.toString();return o?`${e}?${o}`:e})("/player/autocomplete",{term:o,friend:l.friend?1:0,tour:l.tour,swiss:l.swiss,object:1})).then((e=>Object.assign({term:o},e)))),150);o({input:l.input,fetch:e=>i(e).then((({term:t,result:n})=>e==t?n:Promise.reject("Debounced "+e))),render(e){const t=l.tag||"a";return"<"+t+' class="complete-result ulpt user-link'+(e.online?" online":"")+'" '+("a"===t?"":"data-")+'href="/@/'+e.name+'"><i class="line'+(e.patron?" patron":"")+'"></i>'+(e.title?'<span class="utitle"'+("BOT"==e.title?' data-bot="data-bot" ':"")+">"+e.title+"</span>&nbsp;":"")+e.name+"</"+t+">"},populate:l.populate||(e=>e.name),onSelect:l.onSelect,regex:/^[a-z0-9][\w-]{2,29}$/i})}}();
