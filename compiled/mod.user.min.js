!function(){"use strict";const t={cache:"no-cache",credentials:"same-origin"},e={"X-Requested-With":"XMLHttpRequest"},n=(t,e={})=>o(t,e).then((t=>{if(t.ok)return t.text();throw t.statusText})),o=(n,o={})=>fetch(n,Object.assign(Object.assign(Object.assign({},t),{headers:Object.assign({},e)}),o));var r,i,s=(function(t){!function(){function e(t,n){if(!(this instanceof e))return new e(t,n);if(!t||"TABLE"!==t.tagName)throw new Error("Element must be a table");this.init(t,n||{})}var n=[],o=function(t){var e;return window.CustomEvent&&"function"==typeof window.CustomEvent?e=new CustomEvent(t):(e=document.createEvent("CustomEvent")).initCustomEvent(t,!1,!1,void 0),e},r=function(t){return t.getAttribute("data-sort")||t.textContent||t.innerText||""},i=function(t,e){return(t=t.trim().toLowerCase())===(e=e.trim().toLowerCase())?0:t<e?1:-1},s=function(t,e){return[].slice.call(t).find((function(t){return t.getAttribute("data-sort-column-key")===e}))},a=function(t,e){return function(n,o){var r=t(n.td,o.td);return 0===r?e?o.index-n.index:n.index-o.index:r}};e.extend=function(t,e,o){if("function"!=typeof e||"function"!=typeof o)throw new Error("Pattern and sort must be a function");n.push({name:t,pattern:e,sort:o})},e.prototype={init:function(t,e){var n,o,r,i,s=this;if(s.table=t,s.thead=!1,s.options=e,t.rows&&t.rows.length>0)if(t.tHead&&t.tHead.rows.length>0){for(r=0;r<t.tHead.rows.length;r++)if("thead"===t.tHead.rows[r].getAttribute("data-sort-method")){n=t.tHead.rows[r];break}n||(n=t.tHead.rows[t.tHead.rows.length-1]),s.thead=!0}else n=t.rows[0];if(n){var a=function(){s.current&&s.current!==this&&s.current.removeAttribute("aria-sort"),s.current=this,s.sortTable(this)};for(r=0;r<n.cells.length;r++)(i=n.cells[r]).setAttribute("role","columnheader"),"none"!==i.getAttribute("data-sort-method")&&(i.tabindex=0,i.addEventListener("click",a,!1),null!==i.getAttribute("data-sort-default")&&(o=i));o&&(s.current=o,s.sortTable(o))}},sortTable:function(t,e){var c=this,l=t.getAttribute("data-sort-column-key"),d=t.cellIndex,u=i,h="",f=[],m=c.thead?0:1,g=t.getAttribute("data-sort-method"),p=t.getAttribute("aria-sort");if(c.table.dispatchEvent(o("beforeSort")),e||(p="ascending"===p?"descending":"descending"===p?"ascending":c.options.descending?"descending":"ascending",t.setAttribute("aria-sort",p)),!(c.table.rows.length<2)){if(!g){for(;f.length<3&&m<c.table.tBodies[0].rows.length;)(h=(h=(y=l?s(c.table.tBodies[0].rows[m].cells,l):c.table.tBodies[0].rows[m].cells[d])?r(y):"").trim()).length>0&&f.push(h),m++;if(!f)return}for(m=0;m<n.length;m++)if(h=n[m],g){if(h.name===g){u=h.sort;break}}else if(f.every(h.pattern)){u=h.sort;break}for(c.col=d,m=0;m<c.table.tBodies.length;m++){var b,w=[],$={},v=0,C=0;if(!(c.table.tBodies[m].rows.length<2)){for(b=0;b<c.table.tBodies[m].rows.length;b++){var y;"none"===(h=c.table.tBodies[m].rows[b]).getAttribute("data-sort-method")?$[v]=h:(y=l?s(h.cells,l):h.cells[c.col],w.push({tr:h,td:y?r(y):"",index:v})),v++}for("descending"===p?w.sort(a(u,!0)):(w.sort(a(u,!1)),w.reverse()),b=0;b<v;b++)$[b]?(h=$[b],C++):h=w[b-C].tr,c.table.tBodies[m].appendChild(h)}}c.table.dispatchEvent(o("afterSort"))}},refresh:function(){void 0!==this.current&&this.sortTable(this.current,!0)}},t.exports?t.exports=e:window.Tablesort=e}()}(i={path:r,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&i.path)}},i.exports),i.exports);const a=t=>t.replace(/[^\-?0-9.]/g,""),c=(t,e)=>(t=parseFloat(t),e=parseFloat(e),(t=isNaN(t)?0:t)-(e=isNaN(e)?0:e));lichess.load.then((()=>{const t=$(".mod-zone-toggle"),e=$(".mod-zone-full");let o=100;function r(){const n=new EventSource(t.attr("href")+"?nbOthers="+o),r=function(t,e,n=!1){let o,r=0;return function(...i){const s=this;o&&clearTimeout(o),o=void 0;const a=performance.now()-r;r=performance.now(),n&&a>e?t.apply(s,i):o=setTimeout((()=>{o=void 0,t.apply(s,i)}),e)}}((()=>d(e)),300);n.addEventListener("message",(t=>{if(!t.data)return;$("<output>").append($.parseHTML(t.data)).find(".mz-section").each((function(){const t=e.find(`.mz-section--${$(this).data("rel")}`);t.length?t.replaceWith($(this)):e.append($(this).clone())})),r()})),n.onerror=()=>n.close()}function i(t){const e=document.querySelector(t);if(e){const t=$("#inquiry").length?-50:50;window.scrollTo(0,e.offsetTop+t)}}t.on("click",(()=>(e.hasClass("none")?(e.html('<div class="spinner"><svg viewBox="0 0 40 40"><circle cx=20 cy=20 r=18 fill="none"></circle></svg></div>').removeClass("none"),$("#main-wrap").addClass("full-screen-force"),e.html(""),r(),window.addEventListener("scroll",u),i(".mod-zone-full")):(e.addClass("none"),$("#main-wrap").removeClass("full-screen-force"),window.removeEventListener("scroll",u),i("#top")),!1)));const l=t=>t.href.replace(/.+(#\w+)$/,"$1");function d(t){lichess.contentLoaded(t[0]);const a=(e,n,o="ready")=>{t.find(e+`:not(.${o})`).each((function(t){n($(this).addClass(o)[0],t)}))};$(".mz-section--menu > a:not(.available)").each((function(){$(this).toggleClass("available",!!$(l(this)).length)})),a(".mz-section--menu",(t=>{$(t).find("a").each((function(t){const e=l(this),n=""+(t+1);$(this).prepend(`<i>${n}</i>`),window.Mousetrap.bind(n,(()=>i(e)))}))})),a("form.xhr",(o=>{$(o).find("input.confirm, button.confirm").on("click",(function(){return confirm(this.title||"Confirm this action?")})),$(o).on("submit",(()=>($(o).addClass("ready").find("input").prop("disabled",!0),(t=>{const e=t.getAttribute("action");return e?n(e,{method:t.method,body:new FormData(t)}):Promise.reject(`Form has no action: ${t}`)})(o).then((n=>{e.find(".mz-section--actions").replaceWith(n),d(t)})),!1)))})),a("form.fide-title select",(t=>$(t).on("change",(()=>$(t).parent("form")[0].submit())))),a("form.pm-preset select",(t=>$(t).on("change",(()=>{const e=$(t).parent("form")[0];n(e.getAttribute("action")+encodeURIComponent(t.value),{method:"post"}),$(e).html("Sent!")})))),a(".mz-section--others",(t=>{$(t).height($(t).height()),$(t).find(".mark-alt").on("click",(function(){confirm("Close alt account?")&&(n(this.getAttribute("href"),{method:"post"}),$(this).remove())}))})),a(".mz-section--others table",(t=>{s(t,{descending:!0})})),a(".mz-section--identification .spy_filter",(e=>{let o;$(e).find(".button").on("click",(function(){return n($(this).attr("href"),{method:"post"}),$(this).parent().parent().toggleClass("blocked"),!1}));const r=t=>$(t).find("td:first-child").text(),i=e=>e?t.find(".mz-section--others tbody tr").each((function(){$(this).toggleClass("none",!($(this).data("tags")||"").includes(e))})):t.find(".mz-section--others tbody tr.none").removeClass("none");$(e).find("tr").on("click",(function(){const t=r(this);o=o==t?void 0:t,i(o),$(".spy_filter tr.selected").removeClass("selected"),$(this).toggleClass("selected",!!o)})).on("mouseenter",(function(){!o&&i(r(this))})),$(e).on("mouseleave",(()=>!o&&i()))})),a(".mz-section--identification .slist--sort",(t=>{s(t,{descending:!0})}),"ready-sort"),a(".mz-section--others .more-others",(t=>{$(t).addClass("ready").on("click",(()=>{o=1e3,r()}))}))}const u=()=>requestAnimationFrame((()=>{e.hasClass("none")||e.toggleClass("stick-menu",window.scrollY>200)}));s.extend("number",(t=>t.match(/^[-+]?(\d)*-?([,\.]){0,1}-?(\d)+([E,e][\-+][\d]+)?%?$/)),((t,e)=>c(a(e),a(t)))),new URL(location.href).searchParams.has("mod")&&t.trigger("click"),window.Mousetrap.bind("m",(()=>t.trigger("click"))).bind("i",(()=>e.find("button.inquiry").trigger("click")));const h=$("#communication,main.appeal");h.length&&d(h)}))}();
