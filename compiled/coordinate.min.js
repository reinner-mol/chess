!function(){"use strict";const t={cache:"no-cache",credentials:"same-origin"},e={"X-Requested-With":"XMLHttpRequest"},n=(t,e={})=>o(t,e).then((t=>{if(t.ok)return t.text();throw t.statusText})),o=(n,o={})=>fetch(n,Object.assign(Object.assign(Object.assign({},t),{headers:Object.assign({},e)}),o)),r=t=>{const e=new FormData;for(const n of Object.keys(t))e.append(n,t[n]);return e};function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var s,a,c=i((function(t){t.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){var o=n(2),r=n(3),i=n(4);t.exports=function(t){return o(t)||r(t)||i()}},function(t,e,n){n.r(e),n.d(e,"sparkline",(function(){return c}));var o=n(0),r=n.n(o);function i(t,e,n,o){return parseFloat((e-o*e/t+n).toFixed(2))}function s(t){return t.value}function a(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var o in e)n.setAttribute(o,e[o]);return n}function c(t,e,n){var o;if(o=t,r()(o.querySelectorAll("*")).forEach((function(t){return o.removeChild(t)})),!(e.length<=1)){n=n||{},"number"==typeof e[0]&&(e=e.map((function(t){return{value:t}})));var c=n.onmousemove,u=n.onmouseout,l="interactive"in n?n.interactive:!!c,d=n.spotRadius||2,p=2*d,f=n.cursorWidth||2,h=parseFloat(t.attributes["stroke-width"].value),m=n.fetch||s,v=e.map((function(t){return m(t)})),b=parseFloat(t.attributes.width.value)-2*p,y=parseFloat(t.attributes.height.value),x=y-2*h-p,g=Math.max.apply(Math,r()(v)),w=-1e3,_=v.length-1,C=b/_,$=[],O=i(g,x,h+d,v[0]),k="M".concat(p," ").concat(O);v.forEach((function(t,n){var o=n*C+p,r=i(g,x,h+d,t);$.push(Object.assign({},e[n],{index:n,x:o,y:r})),k+=" L ".concat(o," ").concat(r)}));var M=a("path",{class:"sparkline--line",d:k,fill:"none"}),j=a("path",{class:"sparkline--fill",d:"".concat(k," V ").concat(y," L ").concat(p," ").concat(y," Z"),stroke:"none"});if(t.appendChild(j),t.appendChild(M),l){var A=a("line",{class:"sparkline--cursor",x1:w,x2:w,y1:0,y2:y,"stroke-width":f}),z=a("circle",{class:"sparkline--spot",cx:w,cy:w,r:d});t.appendChild(A),t.appendChild(z);var E=a("rect",{width:t.attributes.width.value,height:t.attributes.height.value,style:"fill: transparent; stroke: transparent",class:"sparkline--interaction-layer"});t.appendChild(E),E.addEventListener("mouseout",(function(t){A.setAttribute("x1",w),A.setAttribute("x2",w),z.setAttribute("cx",w),u&&u(t)})),E.addEventListener("mousemove",(function(t){var e=t.offsetX,n=$.find((function(t){return t.x>=e}));n||(n=$[_]);var o,r=$[$.indexOf(n)-1],i=(o=r?r.x+(n.x-r.x)/2<=e?n:r:n).x,s=o.y;z.setAttribute("cx",i),z.setAttribute("cy",s),A.setAttribute("x1",i),A.setAttribute("x2",i),c&&c(t,o)}))}}}e.default=c},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}}])}(a={path:s,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&a.path)}},a.exports),a.exports));function u(t,e,o,r){if(0===e)return;const i=document.createElement("cg-resize");t.container.appendChild(i);const s=t=>{t.preventDefault();const e="touchstart"===t.type?"touchmove":"mousemove",o="touchstart"===t.type?"touchend":"mouseup",r=l(t),i=parseInt(getComputedStyle(document.body).getPropertyValue("--zoom"));let s=i;const a=function(t,e,n=!1){let o,r=0;return function(...i){const s=this;o&&clearTimeout(o),o=void 0;const a=performance.now()-r;r=performance.now(),n&&a>e?t.apply(s,i):o=setTimeout((()=>{o=void 0,t.apply(s,i)}),e)}}((()=>n(`/pref/zoom?v=${100+s}`,{method:"post"})),700),c=t=>{const e=l(t),n=e[0]-r[0]+e[1]-r[1];s=Math.round(Math.min(100,Math.max(0,i+n/10))),document.body.setAttribute("style","--zoom:"+s),window.dispatchEvent(new Event("resize")),a()};document.body.classList.add("resizing"),document.addEventListener(e,c),document.addEventListener(o,(()=>{document.removeEventListener(e,c),document.body.classList.remove("resizing")}),{once:!0})};if(i.addEventListener("touchstart",s,{passive:!1}),i.addEventListener("mousedown",s,{passive:!1}),1===e){const t=t=>i.classList.toggle("none",r?!r(t):t>=2);t(o),lichess.pubsub.on("ply",t)}}function l(t){var e;return t.clientX||0===t.clientX?[t.clientX,t.clientY]:(null===(e=t.targetTouches)||void 0===e?void 0:e[0])?[t.targetTouches[0].clientX,t.targetTouches[0].clientY]:void 0}lichess.load.then((()=>{$("#trainer").each((function(){const t=$(this),e=$(".coord-trainer__board .cg-wrap");let o;const i=$(".coord-trainer__side"),s=$(".coord-trainer__table"),a=t.find(".progress_bar"),l=[$("#next_coord0"),$("#next_coord1")],d=s.find(".start"),p=s.find(".explanation"),f=$(".coord-trainer__score"),h=$(".coord-trainer__timer"),m=t.data("score-url"),v=3e4,b=t.data("resize-pref");let y,x,g,w,_=t.data("color-pref"),C=0;const O=function(){y="random"==_?["white","black"][Math.round(Math.random())]:_,o?y!==o.state.orientation&&o.toggleOrientation():o=window.Chessground(e[0],{coordinates:!1,drawable:{enabled:!1},movable:{free:!1,color:null},orientation:y,addPieceZIndex:$("#main-wrap").hasClass("is3d"),events:{insert(t){u(t,b,C)}}}),t.removeClass("white black").addClass(y)};O(),t.find("form.color").each((function(){const t=this,e=$(this);e.find("input").on("change",(function(){const o={1:"white",2:"random",3:"black"}[e.find("input:checked").val()];return o!==_&&(t=>{const e=t.getAttribute("action");e?n(e,{method:t.method,body:new FormData(t)}):Promise.reject(`Form has no action: ${t}`)})(t),_=o,O(),!1}))}));const k=function(t,e){let n,o=0;return function(...r){const i=this,s=performance.now()-o;function a(){n=void 0,o=performance.now(),e.apply(i,r)}n&&clearTimeout(n),s>t?a():n=setTimeout(a,t-s)}}(1e3,(t=>n("/pref/zen",{method:"post",body:r({zen:t?1:0})})));function M(){i.find(".user_chart").each((function(){const t=$('<svg class="sparkline" height="80px" stroke-width="3">').attr("width",$(this).width()+"px").prependTo($(this).empty());c(t[0],$(this).data("points"),{interactive:!0})}))}lichess.pubsub.on("zen",(()=>{const t=!$("body").hasClass("zen");$("body").toggleClass("zen",t),window.dispatchEvent(new Event("resize")),k(t),requestAnimationFrame(M)})),window.Mousetrap.bind("z",(()=>lichess.pubsub.emit("zen"))),$("#zentog").on("click",(()=>lichess.pubsub.emit("zen"))),requestAnimationFrame(M);const j=function(){s.css("top",256-s.height()/2+"px")};j();const A=function(){$.each(l,(function(t,e){e.text("")}))},z=function(t){let e="abcdefgh";const n=e.indexOf(t[0]);e=e.slice(0,n)+e.slice(n+1,8);let o="12345678";const r=o.indexOf(t[1]);return o=o.slice(0,r)+o.slice(r+1,8),e[Math.round(Math.random()*(e.length-1))]+o[Math.round(Math.random()*(o.length-1))]},E=function(){const e=Math.min(v,(new Date).getTime()-x),s=((v-e)/1e3).toFixed(1);+s<10&&h.addClass("hurry"),h.text(s),a.css("width",100*e/v+"%"),e<v?setTimeout(E,50):(A(),t.removeClass("play"),j(),t.removeClass("wrong"),o.set({events:{select:!1}}),m&&n(m,{method:"post",body:r({color:y,score:g})}).then((t=>{i.find(".scores").html(t),M()})))};d.on("click",(()=>{p.remove(),t.addClass("play").removeClass("init"),h.removeClass("hurry"),C=2,o.redrawAll(),O(),A(),j(),g=0,f.text(g),a.css("width",0),setTimeout((function(){let e;for(x=new Date,o.set({events:{select(e){e==l[0].text()?(g++,f.text(g),function(){$("#next_coord0").removeClass("nope");const t=l.shift();$.each(l,(function(t,e){e.attr("id","next_coord"+t)})),t.attr("id","next_coord"+l.length),t.text(z(l[l.length-1].text())),l.push(t)}()):(clearTimeout(w),t.addClass("wrong"),w=setTimeout((function(){t.removeClass("wrong")}),500))}}}),l[0].text(z("a1")),e=1;e<l.length;e++)l[e].text(z(l[e-1].text()));E()}),1e3)}))}))}))}();
