!function(){"use strict";const e=e=>`lichess-${e}`,t=(t,s)=>t[e(s)],s=(t,s,n)=>t[e(s)]=n,n=e=>{const[t,s,n]=e.getAttribute("data-state").split(",");i(e,t,s,n)},i=(e,t,i,o)=>{window.Chessground?s(e,"chessground",window.Chessground(e,{orientation:i,coordinates:!1,viewOnly:!e.getAttribute("data-playable"),resizable:!1,fen:t,lastMove:o&&("@"===o[1]?[o.slice(2)]:[o[0]+o[1],o[2]+o[3]]),drawable:{enabled:!1,visible:!1}})):setTimeout((()=>n(e)),500)},o=e=>Array.from((e||document).getElementsByClassName("mini-board--init")).forEach(n);var a=Object.freeze({__proto__:null,init:n,initWith:i,initAll:o});const c=e=>e.indexOf(" b")>0?"black":"white",r=e=>{if(window.Chessground){const[t,n,i]=e.getAttribute("data-state").split(","),o={coordinates:!1,viewOnly:!0,resizable:!1,fen:t,orientation:n,lastMove:i&&("@"===i[1]?[i.slice(2)]:[i[0]+i[1],i[2]+i[3]]),drawable:{enabled:!1,visible:!1}},a=$(e).removeClass("mini-game--init"),r=a.find(".cg-wrap"),l=c(t);s(r[0],"chessground",window.Chessground(r[0],o)),["white","black"].forEach((e=>a.find(".mini-game__clock--"+e).each((function(){$(this).clock({time:parseInt(this.getAttribute("data-time")),pause:e!=l})}))))}else setTimeout((()=>r(e)),200);return e.getAttribute("data-live")},l=e=>{const t=Array.from((e||document).getElementsByClassName("mini-game--init")).map(r).filter((e=>e));t.length&&lichess.StrongSocket.firstConnect.then((e=>e("startWatching",t.join(" "))))},h=(e,s)=>{const n=$(e),i=s.lm,o=i&&("@"===i[1]?[i.slice(2)]:[i[0]+i[1],i[2]+i[3]]),a=t(e.querySelector(".cg-wrap"),"chessground");a&&a.set({fen:s.fen,lastMove:o});const r=c(s.fen),l=(e,t)=>{isNaN(e)||n.find(".mini-game__clock--"+t).clock("set",{time:e,pause:t!=r})};l(s.wc,"white"),l(s.bc,"black")},d=(e,t)=>["white","black"].forEach((s=>{const n=$(e).find(".mini-game__clock--"+s).each((function(){$(this).clock("destroy")}));n.data("managed")||n.replaceWith(`<span class="mini-game__result">${t?t==s[0]?1:0:"½"}</span>`)}));var u=Object.freeze({__proto__:null,init:r,initAll:l,update:h,finish:d});const p=[60,3600,86400,604800,2628e3,31536e3],m=[...p];m[2]*=2;const g=e=>e instanceof Date?e:new Date(isNaN(e)?e:parseInt(e)),f=e=>{let t=0;e<0&&(t=1,e=-e);const s=e;let n=0;for(;n<6&&e>=m[n];n++);return n>0&&(e/=p[n-1]),n*=2,(e=Math.floor(e))>(0===n?9:1)&&(n+=1),lichess.timeagoLocale(e,n,s)[t].replace("%s",e)};let b;const v=e=>f((Date.now()-g(e).getTime())/1e3),w=e=>requestAnimationFrame((()=>{const t=Date.now();[].slice.call((e||document).getElementsByClassName("timeago"),0,99).forEach((e=>{const s=e.classList,n=s.contains("abs"),i=s.contains("set");if(e.lichessDate=e.lichessDate||g(e.getAttribute("datetime")),!i){const t=(b=b||(window.Intl&&Intl.DateTimeFormat?new Intl.DateTimeFormat(document.documentElement.lang,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format:e=>e.toLocaleString()))(e.lichessDate);n?e.textContent=t:e.setAttribute("title",t),s.add("set"),(n||s.contains("once"))&&s.remove("timeago")}if(!n){const n=(t-e.lichessDate.getTime())/1e3;e.textContent=f(n),Math.abs(n)>9999&&s.remove("timeago")}}))})),y=e=>{w(),setTimeout((()=>y(1.1*e)),e)},k=e=>null!=e,S={cache:"no-cache",credentials:"same-origin"},C={"X-Requested-With":"XMLHttpRequest"},_=(e,t={})=>A(e,t).then((e=>{if(e.ok)return e.text();throw e.statusText})),A=(e,t={})=>fetch(e,Object.assign(Object.assign(Object.assign({},S),{headers:Object.assign({},C)}),t)),T=e=>{const t=new FormData;for(const s of Object.keys(e))t.append(s,e[s]);return t},L=(e,t)=>{window.requestIdleCallback?window.requestIdleCallback(e,t&&{timeout:t}):requestAnimationFrame(e)},E=e=>/[&<>"']/.test(e)?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;"):e;let M;const O=()=>{M&&clearTimeout(M),M=void 0,$("#announce").remove()},x=e=>{O(),e.msg&&($("body").append('<div id="announce" class="announce">'+E(e.msg)+(e.date?'<time class="timeago" datetime="'+e.date+'"></time>':"")+'<div class="actions"><a class="close">×</a></div></div>').find("#announce .close").on("click",O),M=setTimeout(O,e.date?new Date(e.date).getTime()-Date.now():5e3),e.date&&lichess.contentLoaded())};function I(e,t,s){const n=["mousemove","touchstart"];let i=!1,o=!0,a=performance.now();const c=()=>{o||s(),o=!0,a=performance.now(),r()},r=()=>{i&&(n.forEach((e=>document.removeEventListener(e,c))),i=!1)};setInterval((()=>{o&&performance.now()-a>e&&(t(),o=!1),i||(n.forEach((e=>document.addEventListener(e,c))),i=!0)}),1e4)}let D;try{const e=window.crypto.getRandomValues(new Uint8Array(9));D=btoa(String.fromCharCode(...e)).replace(/[/+]/g,"_")}catch(e){D=Math.random().toString(36).slice(2,12)}const q=D;let N=!1;const P=e=>{let t;if("string"==typeof e)t=e;else if(t=e.url,e.cookie){const t=document.domain.replace(/^.+(\.[^.]+\.[^.]+)$/,"$1"),s=[encodeURIComponent(e.cookie.name)+"="+e.cookie.value,"; max-age="+e.cookie.maxAge,"; path=/","; domain="+t].join("");document.cookie=s}const s="//"+location.host+"/"+t.replace(/^\//,"");N=s,location.href=s},U={expected:!1},j=()=>{N||(U.expected=!0,lichess.socket.disconnect(),location.hash?location.reload():location.assign(location.href))},R=e=>{const t={get:t=>e.getItem(t),set:(t,s)=>e.setItem(t,s),fire:(t,s)=>e.setItem(t,JSON.stringify({sri:q,nonce:Math.random(),value:s})),remove:t=>e.removeItem(t),make:s=>({get:()=>t.get(s),set:e=>t.set(s,e),fire:e=>t.fire(s,e),remove:()=>t.remove(s),listen:t=>window.addEventListener("storage",(n=>{if(n.key!==s||n.storageArea!==e||null===n.newValue)return;let i;try{i=JSON.parse(n.newValue)}catch(e){return}(null==i?void 0:i.sri)&&i.sri!==q&&t(i)}))}),makeBoolean:e=>({get:()=>"1"==t.get(e),set:s=>t.set(e,s?"1":"0"),toggle:()=>t.set(e,"1"==t.get(e)?"0":"1")})};return t},F=R(window.localStorage),V=R(window.sessionStorage);class B{constructor(e,t,s={}){this.url=e,this.pubsub=lichess.pubsub,this.ackable=new W(((e,t,s)=>this.send(e,t,s))),this.lastPingTime=performance.now(),this.pongCount=0,this.averageLag=0,this.tryOtherUrl=!1,this.autoReconnect=!0,this.nbConnects=0,this.storage=F.make("surl15"),this.sign=e=>{this._sign=e,this.ackable.sign(e)},this.connect=()=>{this.destroy(),this.autoReconnect=!0;const e=((e,t)=>{const s=new URLSearchParams;for(const e of Object.keys(t))void 0!==t[e]&&s.append(e,t[e]);const n=s.toString();return n?`${e}?${n}`:e})(this.options.protocol+"//"+this.baseUrl()+this.url,Object.assign(Object.assign({},this.settings.params),{v:!1===this.version?void 0:this.version}));this.debug("connection attempt to "+e);try{const t=this.ws=new WebSocket(e);t.onerror=e=>this.onError(e),t.onclose=()=>{this.pubsub.emit("socket.close"),this.autoReconnect&&(this.debug("Will autoreconnect in "+this.options.autoReconnectDelay),this.scheduleConnect(this.options.autoReconnectDelay))},t.onopen=()=>{this.debug("connected to "+e),this.onSuccess();const t=document.body.classList;t.remove("offline"),t.add("online"),t.toggle("reconnected",this.nbConnects>1),this.pingNow(),this.pubsub.emit("socket.open"),this.ackable.resend()},t.onmessage=e=>{if(0==e.data)return this.pong();const t=JSON.parse(e.data);"n"===t.t&&this.pong(),this.handle(t)}}catch(e){this.onError(e)}this.scheduleConnect(this.options.pingMaxLag)},this.send=(e,t,s={},n=!1)=>{const i={t:e};void 0!==t&&(s.withLag&&(t.l=Math.round(this.averageLag)),s.millis>=0&&(t.s=Math.round(.1*s.millis).toString(36)),i.d=t),s.ackable&&(i.d=i.d||{},this.ackable.register(e,i.d));const o=JSON.stringify(i);if("racerScore"!=e||s.sign==this._sign){if("move"==e&&s.sign!=this._sign){let e;try{e=(new Error).stack.split("\n").join(" / ").replace(/\s+/g," ")}catch(t){e=`${t.message} ${navigator.userAgent}`}e.includes("round.nvui")||setTimeout((()=>this.send("rep",{n:`soc: ${o} ${e}`})),1e4)}this.debug("send "+o);try{this.ws.send(o)}catch(t){n||setTimeout((()=>this.send(e,i.d,s,!0)),1e3)}}},this.scheduleConnect=e=>{this.options.idle&&(e=1e4+10*Math.random()*1e3),clearTimeout(this.pingSchedule),clearTimeout(this.connectSchedule),this.connectSchedule=setTimeout((()=>{document.body.classList.add("offline"),document.body.classList.remove("online"),this.tryOtherUrl=!0,this.connect()}),e)},this.schedulePing=e=>{clearTimeout(this.pingSchedule),this.pingSchedule=setTimeout(this.pingNow,e)},this.pingNow=()=>{clearTimeout(this.pingSchedule),clearTimeout(this.connectSchedule);const e=this.options.isAuth&&this.pongCount%8==2?JSON.stringify({t:"p",l:Math.round(.1*this.averageLag)}):"null";try{this.ws.send(e),this.lastPingTime=performance.now()}catch(e){this.debug(e,!0)}this.scheduleConnect(this.options.pingMaxLag)},this.computePingDelay=()=>this.options.pingDelay+(this.options.idle?1e3:0),this.pong=()=>{clearTimeout(this.connectSchedule),this.schedulePing(this.computePingDelay());const e=Math.min(performance.now()-this.lastPingTime,1e4);this.pongCount++;const t=this.pongCount>4?.1:1/this.pongCount;this.averageLag+=t*(e-this.averageLag),this.pubsub.emit("socket.lag",this.averageLag)},this.handle=e=>{if(e.v&&!1!==this.version){if(e.v<=this.version)return void this.debug("already has event "+e.v);if(e.v>this.version+1)return j();this.version=e.v}switch(e.t||!1){case!1:break;case"resync":j();break;case"ack":this.ackable.onServerAck(e.d);break;default:this.settings.receive&&this.settings.receive(e.t,e.d)||(this.pubsub.emit("socket.in."+e.t,e.d,e),this.settings.events[e.t]&&this.settings.events[e.t](e.d||null,e))}},this.debug=(e,t=!1)=>{(t||this.options.debug)&&console.debug(e)},this.destroy=()=>{clearTimeout(this.pingSchedule),clearTimeout(this.connectSchedule),this.disconnect(),this.ws=void 0},this.disconnect=()=>{const e=this.ws;e&&(this.debug("Disconnect"),this.autoReconnect=!1,e.onerror=e.onclose=e.onopen=e.onmessage=()=>{},e.close())},this.onError=e=>{this.options.debug=!0,this.debug("error: "+JSON.stringify(e)),this.tryOtherUrl=!0,clearTimeout(this.pingSchedule)},this.onSuccess=()=>{if(this.nbConnects++,1==this.nbConnects){let e;B.resolveFirstConnect(this.send),I(6e5,(()=>{this.options.idle=!0,e=setTimeout(this.destroy,72e5)}),(()=>{this.options.idle=!1,this.ws?clearTimeout(e):location.reload()}))}},this.baseUrl=()=>{const e=document.body.getAttribute("data-socket-domains").split(",");let t=this.storage.get();return t&&!this.tryOtherUrl||(t=e[Math.floor(Math.random()*e.length)],this.storage.set(t)),t},this.pingInterval=()=>this.computePingDelay()+this.averageLag,this.getVersion=()=>this.version,this.settings={receive:s.receive,events:s.events||{},params:Object.assign(Object.assign({},B.defaultParams),s.params||{})},this.options=Object.assign(Object.assign({},B.defaultOptions),s.options||{}),this.version=t,this.pubsub.on("socket.send",this.send),window.addEventListener("unload",this.destroy),this.connect()}}B.defaultOptions={idle:!1,pingMaxLag:9e3,pingDelay:2500,autoReconnectDelay:3500,protocol:"https:"===location.protocol?"wss:":"ws:",isAuth:document.body.hasAttribute("user")},B.defaultParams={sri:q},B.firstConnect=new Promise((e=>{B.resolveFirstConnect=e}));class W{constructor(e){this.send=e,this.currentId=1,this.messages=[],this.sign=e=>this._sign=e,this.resend=()=>{const e=performance.now()-2500;this.messages.forEach((t=>{t.at<e&&this.send(t.t,t.d,{sign:this._sign})}))},this.register=(e,t)=>{t.a=this.currentId++,this.messages.push({t:e,d:t,at:performance.now()})},this.onServerAck=e=>{this.messages=this.messages.filter((t=>t.d.a!==e))},setInterval(this.resend,1200)}}const H=(e,t={})=>{const s=(t=t||{}).sameDomain?"":document.body.getAttribute("data-asset-url"),n=t.version||document.body.getAttribute("data-asset-version");return s+"/assets"+(t.noVersion?"":"/_"+n)+"/"+e},J=new Map,z=e=>{if(!J.has(e)){J.set(e,!0);const t=document.createElement("link");t.rel="stylesheet",t.href=H(e),document.head.append(t)}},G=e=>z(`css/${e}.${$("body").data("theme")}.${$("body").data("dev")?"dev":"min"}.css`),X=e=>`compiled/${e}${$("body").data("dev")?"":".min"}.js`,K=new Map,Z=(e,t={})=>{var s;return K.has(e)||K.set(e,(s=H(e,t),new Promise(((e,t)=>{const n=document.body.getAttribute("data-nonce"),i=document.createElement("script");n&&i.setAttribute("nonce",n),i.onload=e,i.onerror=t,i.src=s,document.head.append(i)})))),K.get(e)},Q=e=>Z(X(e)),Y=()=>(G("complete"),Q("userComplete").then((e=>window.UserComplete))),ee=()=>(z("vendor/hopscotch/dist/css/hopscotch.min.css"),Z("vendor/hopscotch/dist/js/hopscotch.min.js",{noVersion:!0})),te=e=>new Promise((t=>requestAnimationFrame((()=>{e.loadCss=G,t(window.LichessChat(document.querySelector(".mchat"),e))}))));function se(e,t){return"always"===t||!F.get(e)&&(F.set(e,"1"),!0)}const ne='<div class="spinner"><svg viewBox="0 0 40 40"><circle cx=20 cy=20 r=18 fill="none"></circle></svg></div>',ie=e=>{var t;return null===(t=document.querySelector(".crosstable"))||void 0===t?void 0:t.contains(e)};function oe(e,t){return function(s){const n=($(s).data("href")||s.href).replace(/\?.+$/,"");t&&t(n),_(n+"/mini").then((t=>{const s=document.getElementById(e);s.innerHTML=t,lichess.contentLoaded(s)}))}}const ae=(e,t)=>`<a class="btn-rack__btn" href="${e}" data-icon="${t}"></a>`,ce=(e,t)=>{t=t||e.getAttribute("data-pt-pos")||(ie(e)?"n":"s"),$(e).removeClass("ulpt").powerTip({preRender:oe("powerTip",(t=>{const s=t.substr(3),n=$(e).data("name")||$(e).html();$("#powerTip").html('<div class="upt__info"><div class="upt__info__top"><span class="user-link offline">'+n+'</span></div></div><div class="upt__actions btn-rack">'+ae("/@/"+s+"/tv","1")+ae("/inbox/new?user="+s,"c")+ae("/?user="+s+"#friend","U")+'<a class="btn-rack__btn relation-button" disabled></a></div>')})),placement:t})};function re(e){$(e).removeClass("glpt").powerTip({preRender:oe("miniGame",(()=>ne)),placement:ie(e)?"n":"w",popupId:"miniGame"})}function le(e,t,s){"ontouchstart"in window||(s(e),$.powerTip.show(e,t))}function he(e,t,s){L((()=>Array.prototype.forEach.call(e.querySelectorAll(t),(e=>s(e)))),800)}const de={watchMouse(){document.body.addEventListener("mouseover",(e=>{const t=e.target,s=t.classList;s.contains("ulpt")?le(t,e,ce):s.contains("glpt")&&le(t,e,re)}))},manualGameIn(e){he(e,".glpt",re)},manualGame:re,manualUser:ce,manualUserIn(e){he(e,".ulpt",ce)}},ue=(e,n)=>{const i=$[e]=function(t,s){const n=this;n.element=$(s),s[e]=this,n.options=t,n._create()};i.prototype=n,$.fn[e]=function(n){const o=Array.prototype.slice.call(arguments,1);return"string"==typeof n?this.each((function(){const s=t(this,e);s&&$.isFunction(s[n])&&s[n].apply(s,o)})):this.each((function(){t(this,e)||s(this,e,new i(n,this))})),this}},pe=[],me={on(e,t){pe[e]=pe[e]||[],pe[e].push(t)},off(e,t){if(pe[e])for(const s in pe[e])if(pe[e][s]===t){pe[e].splice(s);break}},emit(e,...t){if(pe[e])for(const s in pe[e])pe[e][s].apply(null,t)}};function ge(e,t){if(t.length)if(e.includes("%s"))e=e.replace("%s",t[0]);else for(let s=0;s<t.length;s++)e=e.replace("%"+(s+1)+"$s",t[s]);return e}function fe(e,t){const s=e.split(/(%(?:\d\$)?s)/g);if(t.length){const e=s.indexOf("%s");if(-1!==e)s[e]=t[0];else for(let e=0;1<t.length;e++){const n=s.indexOf("%"+(e+1)+"$s");-1!==n&&(s[n]=t[e])}}return s}function be(e){const t=(t,...s)=>{const n=e[t];return n?ge(n,s):t};return t.plural=function(t,s){const n=`${t}:${lichess.quantity(s)}`,i=e[n]||e[t];return i?ge(i,Array.prototype.slice.call(arguments,1)):t},t.noarg=t=>e[t]||t,t.vdom=(t,...s)=>{const n=e[t];return n?fe(n,s):[t]},t.vdomPlural=(t,s,...n)=>{const i=`${t}:${lichess.quantity(s)}`,o=e[i]||e[t];return o?fe(o,n):[t]},t}const ve=new class{constructor(){this.sounds=new Map,this.soundSet=$("body").data("sound-set"),this.speechStorage=F.makeBoolean("speech.enabled"),this.volumeStorage=F.make("sound-volume"),this.baseUrl=H("sound",{version:"_____1"}),this.loadOggOrMp3=(e,t)=>this.sounds.set(e,new window.Howl({src:["ogg","mp3"].map((e=>`${t}.${e}`))})),this.loadStandard=(e,t)=>{if(!this.enabled())return;const s=e[0].toUpperCase()+e.slice(1);this.loadOggOrMp3(e,`${this.baseUrl}/${t||this.soundSet}/${s}`)},this.setVolume=this.volumeStorage.set,this.getVolume=()=>{const e=parseFloat(this.volumeStorage.get()||"");return e>=0?e:.7},this.enabled=()=>"silent"!==this.soundSet,this.speech=e=>(void 0!==e&&this.speechStorage.set(e),this.speechStorage.get()),this.say=(e,t=!1,s=!1,n=!1)=>{if(t&&speechSynthesis.cancel(),!this.speechStorage.get()&&!s)return!1;const i=new SpeechSynthesisUtterance(e);return i.volume=this.getVolume(),i.lang=n?document.documentElement.lang:"en-US",speechSynthesis.speak(i),!0},this.sayOrPlay=(e,t)=>this.say(t)||this.play(e),this.publish=()=>me.emit("sound_set",this.soundSet),this.changeSet=e=>{this.soundSet=e,this.sounds.clear(),this.publish()},this.set=()=>this.soundSet,"music"==this.soundSet&&setTimeout(this.publish,500)}preloadBoardSounds(){"music"!==this.soundSet&&["move","capture","check","genericNotify"].forEach((e=>this.loadStandard(e)))}play(e,t){var s;if(!this.enabled())return;let n=this.soundSet;if("music"===n||this.speechStorage.get()){if(["move","capture","check"].includes(e))return;n="standard"}let i=this.sounds.get(e);i||(this.loadStandard(e,n),i=this.sounds.get(e));const o=()=>i.volume(this.getVolume()*(t||1)).play();"suspended"===(null===(s=window.Howler.ctx)||void 0===s?void 0:s.state)?window.Howler.ctx.resume().then(o):o()}};let we;function ye(e){const t=$(e);if(t.data("watched"))return;t.data("watched",1);const s=$('<div class="chat__members__inner">').appendTo(t),n=$('<div class="chat__members__number" data-icon="r" title="Spectators"></div>').appendTo(s),i=$("<div>").appendTo(s);lichess.pubsub.on("socket.in.crowd",(e=>o(e.watchers||e)));const o=e=>{if(we=e,!e||!e.nb)return t.addClass("none");if(n.text(""+e.nb),e.users){const t=e.users.map((e=>e?`<a class="user-link ulpt" href="/@/${e.includes(" ")?e.split(" ")[1]:e}">${e}</a>`:"Anonymous"));1===e.anons?t.push("Anonymous"):e.anons&&t.push(`Anonymous (${e.anons})`),i.html(t.join(", "))}else i.html("");t.removeClass("none")};we&&o(we)}console.info("Lichess is open source! https://lichess.org/source");const ke=lichess;function $e(){var e;ke.userAnalysis?((e=ke.userAnalysis).$side=$(".analyse__side").clone(),Se(e)):(ke.study||ke.practice||ke.relay)&&Se(ke.study||ke.practice||ke.relay)}function Se(e){lichess.socket=new B(e.socketUrl||"/analysis/socket/v5",e.socketVersion,{receive:(e,s)=>t.socketReceive(e,s)}),e.socketSend=ke.socket.send;const t=window.LichessAnalyse.start(e)}class Ce{constructor(e){this.el=e,this.loaded=!1,this.receive=(e,t)=>{this.users.clear(),e.forEach(this.insert),t.playing.map((e=>this.users.get(e))).filter(k).forEach((e=>e.playing=!0)),t.patrons.map((e=>this.users.get(e))).filter(k).forEach((e=>e.patron=!0)),this.repaint()},this.repaint=()=>{this.loaded&&requestAnimationFrame((()=>{var e;const t=Array.from(this.users.keys()).sort();this.titleEl.innerHTML=this.trans.plural("nbFriendsOnline",t.length,this.loaded?`<strong>${t.length}</strong>`:"-"),null===(e=this.el.querySelector(".nobody"))||void 0===e||e.classList.toggle("none",!!t[0]),this.el.querySelector(".list").innerHTML=t.map((e=>this.renderFriend(this.users.get(e)))).join("")}))},this.renderFriend=e=>{const t=`<i class="line${e.patron?" patron":""}"></i>`,s=e.title?`<span class="utitle"${"BOT"===e.title?" data-bot":""}>${e.title}</span>&nbsp;`:"",n="/@/"+e.name,i=e.playing?`<a data-icon="1" class="tv ulpt" data-pt-pos="nw" href="${n}/tv" data-href="${n}"></a>`:"";return`<div><a class="user-link ulpt" data-pt-pos="nw" href="${n}">${t}${s}${e.name}</a>${i}</div>`},this.enters=(e,t)=>{const s=this.insert(e);s.playing=t.playing,s.patron=t.patron,this.repaint()},this.leaves=e=>{this.users.delete(this.getId(e)),this.repaint()},this.playing=e=>{this.insert(e).playing=!0,this.repaint()},this.stopped_playing=e=>{this.insert(e).playing=!1,this.repaint()},this.insert=e=>{const t=this.getId(e);return this.users.has(t)||this.users.set(t,this.toFriend(e)),this.users.get(t)},this.getId=e=>e.toLowerCase().replace(/^\w+\s/,""),this.toFriend=e=>{const t=e.split(" ");return{id:t[t.length-1].toLowerCase(),name:t[t.length-1],title:t.length>1?t[0]:void 0,playing:!1,patron:!1}},this.titleEl=this.el.querySelector(".friend_box_title"),this.titleEl.addEventListener("click",(()=>{var e;null===(e=this.el.querySelector(".content_wrap"))||void 0===e||e.classList.toggle("none"),this.loaded||(this.loaded=!0,me.emit("socket.send","following_onlines"))})),this.trans=be(JSON.parse(this.el.getAttribute("data-i18n"))),this.users=new Map,me.on("socket.in.following_onlines",this.receive),["enters","leaves","playing","stopped_playing"].forEach((e=>me.on("socket.in.following_"+e,this[e])))}}!function(){const e=window.lichess;e.StrongSocket=B,e.requestIdleCallback=L,e.sri=q,e.storage=F,e.tempStorage=V,e.once=se,e.powertip=de,e.widget=ue,e.spinnerHtml=ne,e.assetUrl=H,e.loadCss=z,e.loadCssPath=G,e.jsModule=X,e.loadScript=Z,e.loadModule=Q,e.hopscotch=ee,e.userComplete=Y,e.makeChat=te,e.idleTimer=I,e.pubsub=me,e.unload=U,e.redirect=P,e.reload=j,e.watchers=ye,e.escapeHtml=E,e.announce=x,e.trans=be,e.sound=ve,e.miniBoard=a,e.miniGame=u,e.timeago=v,e.contentLoaded=e=>me.emit("content-loaded",e)}(),lichess.info={date:"2021-05-28T14:04:09+00:00"},ue("clock",{_create:function(){this.target=1e3*this.options.time+Date.now(),this.options.pause||(this.interval=setInterval(this.render.bind(this),1e3)),this.render()},set:function(e){this.options=e,this.target=1e3*this.options.time+Date.now(),this.render(),clearInterval(this.interval),e.pause||(this.interval=setInterval(this.render.bind(this),1e3))},render:function(){document.body.contains(this.element[0])?(this.element.text(this.formatMs(this.target-Date.now())),this.element.toggleClass("clock--run",!this.options.pause)):clearInterval(this.interval)},pad:e=>(e<10?"0":"")+e,formatMs:function(e){const t=new Date(Math.max(0,e+500)),s=t.getUTCHours(),n=t.getUTCMinutes(),i=t.getUTCSeconds();return s>0?s+":"+this.pad(n)+":"+this.pad(i):n+":"+this.pad(i)}}),lichess.load.then((()=>{$e(),requestAnimationFrame((()=>{o(),l(),me.on("content-loaded",o),me.on("content-loaded",l),y(1e3),me.on("content-loaded",w)})),L((()=>{const e=document.getElementById("friend_box");e&&new Ce(e);const t=document.querySelector(".chat__members");if(t&&ye(t),$("#main-wrap").on("click",".autoselect",(function(){this.select()})).on("click","button.copy",(function(){$("#"+$(this).data("rel")).each((function(){this.select()})),document.execCommand("copy"),$(this).attr("data-icon","E")})),$("body").on("click","a.relation-button",(function(){const e=$(this).addClass("processing").css("opacity",.3);return _(this.href,{method:"post"}).then((t=>{t.includes("relation-actions")?e.parent().replaceWith(t):e.replaceWith(t)})),!1})),$(".mselect .button").on("click",(function(){const e=$(this).parent();e.toggleClass("shown"),L((()=>{const t=s=>{e[0].contains(s.target)||(e.removeClass("shown"),$("html").off("click",t))};$("html").on("click",t)}),200)})),de.watchMouse(),setTimeout((()=>{lichess.socket||(lichess.socket=new B("/socket/v5",!1))}),300),function(){const e=`<div class="initiating">${ne}</div>`,t=e=>{const t=document.querySelector(e),s=t&&window.getComputedStyle(t).display;return s&&"none"!=s};"ontouchstart"in window&&!window.matchMedia("(max-width: 979px)").matches&&$("#topnav > section > a").removeAttr("href"),$("#topnav-toggle").on("change",(e=>document.body.classList.toggle("masked",e.target.checked))),$("#top").on("click","a.toggle",(function(){const e=$(this).parent().toggleClass("shown");return e.siblings(".shown").removeClass("shown"),me.emit("top.toggle."+this.id),setTimeout((()=>{const t=s=>{var n;(null===(n=e[0])||void 0===n?void 0:n.contains(s.target))||(e.removeClass("shown"),$("html").off("click",t))};$("html").on("click",t)}),10),!1}));{let s,n;const i=$("#challenge-toggle");i.one("mouseover click",(()=>o()));const o=function(o){if(n)return;n=!0;const a=$("#challenge-app").html(e);G("challenge"),Q("challenge").then((()=>s=window.LichessChallenge(a[0],{data:o,show(){t("#challenge-app")||i.trigger("click")},setCount(e){i.find("span").data("count",e)},pulse(){i.addClass("pulse")}})))};me.on("socket.in.challenges",(e=>{s?s.update(e):o(e)})),me.on("challenge-app.open",(()=>i.trigger("click")))}{let s,n;const i=$("#notify-toggle"),o="#notify-app",a=(a,c=!1)=>{if(n)return;n=!0;const r=$("#notify-app").html(e);G("notify"),Q("notify").then((()=>s=window.LichessNotify(r.empty()[0],{data:a,incoming:c,isVisible:()=>t(o),setCount(e){i.find("span").data("count",e)},show(){t(o)||i.trigger("click")},setNotified(){lichess.socket.send("notified")},pulse(){i.addClass("pulse")}})))};i.one("mouseover click",(()=>a())).on("click",(()=>{"Notification"in window&&Notification.requestPermission(),setTimeout((()=>{s&&t(o)&&s.setVisible()}),200)})),me.on("socket.in.notifications",(e=>{s?s.update(e,!0):a(e,!0)})),me.on("notify-app.set-read",(e=>{s?s.setMsgRead(e):a()}))}{let t;$("#top .dasher .toggle").one("mouseover click",(function(){if(t)return;t=!0,$(this).removeAttr("href");const s=$("#dasher_app").html(e),n=$("body").hasClass("playing");G("dasher"),Q("dasher").then((()=>window.LichessDasher(s.empty()[0],{playing:n})))}))}{const e=$("#clinput");if(!e.length)return;const t=e.find("input");let s=!1;const n=()=>{s||(s=!0,Q("cli").then((()=>window.LichessCli.app(t[0])),(()=>s=!1)))};t.on({blur(){t.val(""),$("body").removeClass("clinput")},focus(){n(),$("body").addClass("clinput")}}),e.find("a").on({mouseover:n,click(){$("body").hasClass("clinput")?t[0].blur():t[0].focus()}}),window.Mousetrap.bind("/",(()=>{t.val("/"),t[0].focus()})).bind("s",(()=>t[0].focus()))}}(),window.addEventListener("resize",(()=>document.body.dispatchEvent(new Event("chessground.resize")))),$(".user-autocomplete").each((function(){const e=!!this.autofocus,t=()=>Y().then((t=>t({input:this,friend:$(this).data("friend"),tag:$(this).data("tag"),focus:e})));e?t():$(this).one("focus",t)})),window.InfiniteScroll&&window.InfiniteScroll(".infinite-scroll"),$("input.confirm, button.confirm").on("click",(function(){return confirm(this.title||"Confirm this action?")})),$("#main-wrap").on("click","a.bookmark",(function(){const e=$(this).toggleClass("bookmarked");_(this.href,{method:"post"});const t=(parseInt(e.text(),10)||0)+(e.hasClass("bookmarked")?1:-1);return e.find("span").html(""+(t>0?t:"")),!1})),window.Mousetrap.bind("esc",(()=>{const e=$("#modal-wrap .close");if(e.length)e.trigger("click");else{const e=$(":focus");e.length&&e.trigger("blur")}})),navigator.userAgent.includes("Edge/")&&setTimeout((()=>{const e=document.getElementById("piece-sprite");e.href=e.href.replace(".css",".external.css")}),1e3),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){const e=document.querySelector("meta[name=viewport]");e.setAttribute("content",e.getAttribute("content")+",maximum-scale=1.0")}"#blind"!==location.hash||$("body").hasClass("blind-mode")||_("/toggle-blind-mode",{method:"post",body:T({enable:1,redirect:"/"})}).then(j);const s=document.body.getAttribute("data-announce");s&&x(JSON.parse(s)),function(){if("serviceWorker"in navigator&&"Notification"in window&&"PushManager"in window){const e=new URL(H(X("serviceWorker"),{sameDomain:!0}),self.location.href);e.searchParams.set("asset-url",document.body.getAttribute("data-asset-url")),document.body.getAttribute("data-dev")&&e.searchParams.set("dev","1");const t=document.body.getAttribute("data-dev")?"none":"all";navigator.serviceWorker.register(e.href,{scope:"/",updateViaCache:t}).then((e=>{const t=F.make("push-subscribed"),s=document.body.getAttribute("data-vapid");if(s&&"granted"==Notification.permission)return e.pushManager.getSubscription().then((n=>{const i=parseInt(t.get()||"0",10)+432e5<Date.now(),o=Uint8Array.from(atob(s),(e=>e.charCodeAt(0)));if(!n||i)return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:o}).then((e=>fetch("/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{e.ok?t.set(""+Date.now()):console.log("submitting push subscription failed",e.statusText)}))),(e=>{console.log("push subscribe failed",e.message),n&&n.unsubscribe()}))}));t.remove()}))}}(),me.on("socket.in.redirect",(e=>{lichess.unload.expected=!0,lichess.redirect(e)})),me.on("socket.in.fen",(e=>document.querySelectorAll(".mini-game-"+e.id).forEach((t=>h(t,e))))),me.on("socket.in.finish",(e=>document.querySelectorAll(".mini-game-"+e.id).forEach((t=>d(t,e.win))))),me.on("socket.in.announce",x),me.on("socket.in.tournamentReminder",(e=>{if($("#announce").length||$("body").data("tournament-id")==e.id)return;const t="/tournament/"+e.id;$("body").append(`<div id="announce"><a data-icon="g" class="text" href="${t}">${e.name}</a><div class="actions"><a class="withdraw text" href="${t}/withdraw" data-icon="Z">Pause</a><a class="text" href="${t}" data-icon="G">Resume</a></div></div>`).find("#announce .withdraw").on("click",(function(){return _(this.href,{method:"post"}),$("#announce").remove(),!1}))}))}),800)}))}();
