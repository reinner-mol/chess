var LichessNotify=function(){"use strict";const t={createElement:function(t,e){return document.createElement(t,e)},createElementNS:function(t,e,n){return document.createElementNS(t,e,n)},createTextNode:function(t){return document.createTextNode(t)},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,n){t.insertBefore(e,n)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){t.appendChild(e)},parentNode:function(t){return t.parentNode},nextSibling:function(t){return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},getTextContent:function(t){return t.textContent},isElement:function(t){return 1===t.nodeType},isText:function(t){return 3===t.nodeType},isComment:function(t){return 8===t.nodeType}};function e(t,e,n,o,i){return{sel:t,data:e,children:n,text:o,elm:i,key:void 0===e?void 0:e.key}}const n=Array.isArray;function o(t){return"string"==typeof t||"number"==typeof t}function i(t){return void 0===t}function r(t){return void 0!==t}const a=e("",{},[],void 0,void 0);function s(t,e){var n,o;const i=t.key===e.key,r=(null===(n=t.data)||void 0===n?void 0:n.is)===(null===(o=e.data)||void 0===o?void 0:o.is);return t.sel===e.sel&&i&&r}function c(t,e,n){var o;const i={};for(let r=e;r<=n;++r){const e=null===(o=t[r])||void 0===o?void 0:o.key;void 0!==e&&(i[e]=r)}return i}const l=["create","update","remove","destroy","pre","post"];function d(t,e,n){if(t.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==e)for(let t=0;t<e.length;++t){const n=e[t].data;void 0!==n&&d(n,e[t].children,e[t].sel)}}function u(t,i,r){let a,s,c,l={};if(void 0!==r?(null!==i&&(l=i),n(r)?a=r:o(r)?s=r:r&&r.sel&&(a=[r])):null!=i&&(n(i)?a=i:o(i)?s=i:i&&i.sel?a=[i]:l=i),void 0!==a)for(c=0;c<a.length;++c)o(a[c])&&(a[c]=e(void 0,void 0,void 0,a[c],void 0));return"s"!==t[0]||"v"!==t[1]||"g"!==t[2]||3!==t.length&&"."!==t[3]&&"#"!==t[3]||d(l,a,t),e(t,l,a,s,void 0)}function p(t,e){let n;const o=e.elm;let i=t.data.attrs,r=e.data.attrs;if((i||r)&&i!==r){for(n in i=i||{},r=r||{},r){const t=r[n];i[n]!==t&&(!0===t?o.setAttribute(n,""):!1===t?o.removeAttribute(n):120!==n.charCodeAt(0)?o.setAttribute(n,t):58===n.charCodeAt(3)?o.setAttributeNS("http://www.w3.org/XML/1998/namespace",n,t):58===n.charCodeAt(5)?o.setAttributeNS("http://www.w3.org/1999/xlink",n,t):o.setAttribute(n,t))}for(n in i)n in r||o.removeAttribute(n)}}function f(t,e){let n,o;const i=e.elm;let r=t.data.class,a=e.data.class;if((r||a)&&r!==a){for(o in r=r||{},a=a||{},r)r[o]&&!Object.prototype.hasOwnProperty.call(a,o)&&i.classList.remove(o);for(o in a)n=a[o],n!==r[o]&&i.classList[n?"add":"remove"](o)}}const g={Accept:"application/vnd.lichess.v5+json"},m={cache:"no-cache",credentials:"same-origin"},h={"X-Requested-With":"XMLHttpRequest"};let v=[],x=!1;function w(t){const e=lichess.storage.make("just-notified");if(document.hasFocus()||Date.now()-parseInt(e.get(),10)<1e3)return;e.set(""+Date.now()),$.isFunction(t)&&(t=t());const n=new Notification("lichess.org",{icon:lichess.assetUrl("logo/lichess-favicon-256.png",{noVersion:!0}),body:t});n.onclick=()=>window.focus(),v.push(n),x||(x=!0,window.addEventListener("focus",(()=>{v.forEach((t=>t.close())),v=[]})))}function y(t){return{genericLink:{html:t=>b(t,t.content.url,t.content.icon,[u("span",[u("strong",t.content.title),k(t)]),u("span",t.content.text)]),text:t=>t.content.title||t.content.text},mention:{html:e=>b(e,"/forum/redirect/post/"+e.content.postId,"d",[u("span",[u("strong",N(e.content.mentionedBy)),k(e)]),u("span",t("mentionedYouInX",e.content.topic))]),text:e=>t("xMentionedYouInY",N(e.content.mentionedBy),e.content.topic)},invitedStudy:{html:e=>b(e,"/study/"+e.content.studyId,"4",[u("span",[u("strong",N(e.content.invitedBy)),k(e)]),u("span",t("invitedYouToX",e.content.studyName))]),text:e=>t("xInvitedYouToY",N(e.content.invitedBy),e.content.studyName)},privateMessage:{html:t=>b(t,"/inbox/"+t.content.user.name,"c",[u("span",[u("strong",N(t.content.user)),k(t)]),u("span",t.content.text)]),text:t=>N(t.content.sender)+": "+t.content.text},teamJoined:{html:e=>b(e,"/team/"+e.content.id,"f",[u("span",[u("strong",e.content.name),k(e)]),u("span",t.noarg("youAreNowPartOfTeam"))]),text:e=>t("youHaveJoinedTeamX",e.content.name)},titledTourney:{html:t=>b(t,"/tournament/"+t.content.id,"g",[u("span",[u("strong","Lichess Titled Arena"),k(t)]),u("span",t.content.text)]),text:t=>"Lichess Titled Arena"},reportedBanned:{html:e=>b(e,void 0,"",[u("span",[u("strong",t.noarg("someoneYouReportedWasBanned"))]),u("span",t.noarg("thankYou"))]),text:e=>t.noarg("someoneYouReportedWasBanned")},gameEnd:{html:e=>{let n;switch(e.content.win){case!0:n=t.noarg("congratsYouWon");break;case!1:n=t.noarg("defeat");break;default:n=t.noarg("draw")}return b(e,"/"+e.content.id,";",[u("span",[u("strong",t("gameVsX",N(e.content.opponent))),k(e)]),u("span",n)])},text:e=>{let n;switch(e.content.win){case!0:n=t.noarg("victory");break;case!1:n=t.noarg("defeat");break;default:n=t.noarg("draw")}return t("resVsX",n,N(e.content.opponent))}},planStart:{html:e=>b(e,"/patron","",[u("span",[u("strong",t.noarg("thankYou")),k(e)]),u("span",t.noarg("youJustBecamePatron"))]),text:e=>t.noarg("youJustBecamePatron")},planExpire:{html:e=>b(e,"/patron","",[u("span",[u("strong",t.noarg("patronAccountExpired")),k(e)]),u("span",t.noarg("pleaseReconsiderRenewIt"))]),text:e=>t.noarg("patronAccountExpired")},coachReview:{html:e=>b(e,"/coach/edit",":",[u("span",[u("strong","New pending review"),k(e)]),u("span",t.noarg("someoneReviewedYourCoachProfile"))]),text:e=>t.noarg("newPendingReview")},ratingRefund:{html:e=>b(e,"/player/myself","",[u("span",[u("strong",t.noarg("lostAgainstTOSViolator")),k(e)]),u("span",t("refundXpointsTimeControlY",e.content.points,e.content.perf))]),text:e=>t("refundXpointsTimeControlY",e.content.points,e.content.perf)},corresAlarm:{html:e=>b(e,"/"+e.content.id,";",[u("span",[u("strong",t.noarg("timeAlmostUp")),k(e)]),u("span",t("gameVsX",e.content.op))]),text:e=>t.noarg("timeAlmostUp")},irwinDone:{html:t=>b(t,"/@/"+t.content.user.name+"?mod","",[u("span",[u("strong",N(t.content.user)),k(t)]),u("span","Irwin job complete!")]),text:t=>t.content.user.name+": Irwin job complete!"}}}function b(t,e,n,o){return u(e?"a":"span",{class:{site_notification:!0,[t.type]:!0,new:!t.read},attrs:e?{href:e}:void 0},[u("i",{attrs:{"data-icon":n}}),u("span.content",o)])}function k(t){const e=new Date(t.date);return u("time.timeago",{attrs:{title:e.toLocaleString(),datetime:t.date}},lichess.timeago(e))}function N(t){return t?t.title?t.title+" "+t.name:t.name:"Anonymous"}function C(t){const e=t.data();return u("div#notify-app.links.dropdown",e&&!t.initiating()?function(t,e){const n=e.pager,o=n.currentPageResults.length,i=[];n.previousPage?i.push(u("div.pager.prev",{attrs:{"data-icon":"S"},hook:P(t.previousPage)})):n.nextPage&&i.push(u("div.pager.prev.disabled",{attrs:{"data-icon":"S"}}));i.push(o?function(t,e){const n=lichess.trans(t.i18n);return u("div",{class:{notifications:!0,scrolling:e},hook:{insert:A,postpatch:A}},t.pager.currentPageResults.map((t=>function(t,e){const n=y(e);return n[t.type]?n[t.type].html(t):void 0}(t,n))))}(e,t.scrolling()):function(){return u("div.empty.text",{attrs:{"data-icon":""}},"No notifications.")}()),n.nextPage&&i.push(u("div.pager.next",{attrs:{"data-icon":"R"},hook:P(t.nextPage)}));"Notification"in window?"denied"==Notification.permission&&i.push(u("a.browser-notification.denied",{attrs:{href:"/faq#browser-notifications",target:"_blank"}},"Notification popups disabled by browser setting")):i.push(u("div.browser-notification","Browser does not support notification popups"));return i}(t,e):[u("div.initiating",u("div.spinner",[u("svg",{attrs:{viewBox:"0 0 40 40"}},[u("circle",{attrs:{cx:20,cy:20,r:18,fill:"none"}})])]))])}function P(t){return{insert:e=>{e.elm.addEventListener("click",t)}}}const A=t=>lichess.contentLoaded(t.elm);function T(t,e){let n,o=!0,i=!1;const r=lichess.storage.make("notify-read-all");function a(a,s){n=a,1===n.pager.currentPage&&n.unread&&t.isVisible()&&(t.setNotified(),n.unread=0,r.fire()),o=!1,i=!1,t.setCount(n.unread),s&&function(){if(!n||1!==n.pager.currentPage)return;const e=n.pager.currentPageResults.find((t=>!t.read));if(!e)return;t.pulse(),lichess.quietMode&&"lichess"!=e.content.user.id||lichess.sound.play("newPM");const o=function(t,e){const n=y(e);return n[t.type]?n[t.type].text(t):void 0}(e,lichess.trans(n.i18n));parseInt(lichess.storage.get("push-subscribed")||"0",10)+864e5>=Date.now()||!o||(i=o,!document.hasFocus()&&"Notification"in window&&"granted"===Notification.permission&&setTimeout(w,10+500*Math.random(),i));var i}(),e()}r.listen((o=>{n&&(n.unread=0,t.setCount(0),e())}));const s=t=>((t,e={})=>fetch(t,Object.assign(Object.assign(Object.assign({},m),{headers:Object.assign(Object.assign({},g),h)}),e)).then((t=>{if(t.ok)return t.json();throw t.statusText})))(((t,e)=>{const n=new URLSearchParams;for(const t of Object.keys(e))void 0!==e[t]&&n.append(t,e[t]);const o=n.toString();return o?`${t}?${o}`:t})("/notify",{page:t||1})).then((t=>a(t,!1)),(t=>lichess.announce({msg:"Failed to load notifications"})));return{data:()=>n,initiating:()=>o,scrolling:()=>i,update:a,nextPage:function(){n&&n.pager.nextPage&&(i=!0,s(n.pager.nextPage),e())},previousPage:function(){n&&n.pager.previousPage&&(i=!0,s(n.pager.previousPage),e())},loadPage:s,setVisible:function(){n&&1!==n.pager.currentPage||s(1)},setMsgRead:function(e){n&&n.pager.currentPageResults.forEach((o=>{"privateMessage"!=o.type||o.content.user.id!=e||o.read||(o.read=!0,n.unread=Math.max(0,n.unread-1),t.setCount(n.unread))}))}}}const B=function(d,u){let p,f;const g={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},m=void 0!==u?u:t;for(p=0;p<l.length;++p)for(g[l[p]]=[],f=0;f<d.length;++f){const t=d[f][l[p]];void 0!==t&&g[l[p]].push(t)}function h(t){const n=t.id?"#"+t.id:"",o=t.className?"."+t.className.split(" ").join("."):"";return e(m.tagName(t).toLowerCase()+n+o,{},[],void 0,t)}function v(t,e){return function(){if(0==--e){const e=m.parentNode(t);m.removeChild(e,t)}}}function x(t,e){var s,c;let l,d=t.data;if(void 0!==d){const e=null===(s=d.hook)||void 0===s?void 0:s.init;r(e)&&(e(t),d=t.data)}const u=t.children,p=t.sel;if("!"===p)i(t.text)&&(t.text=""),t.elm=m.createComment(t.text);else if(void 0!==p){const i=p.indexOf("#"),s=p.indexOf(".",i),f=i>0?i:p.length,h=s>0?s:p.length,v=-1!==i||-1!==s?p.slice(0,Math.min(f,h)):p,w=t.elm=r(d)&&r(l=d.ns)?m.createElementNS(l,v,d):m.createElement(v,d);for(f<h&&w.setAttribute("id",p.slice(f+1,h)),s>0&&w.setAttribute("class",p.slice(h+1).replace(/\./g," ")),l=0;l<g.create.length;++l)g.create[l](a,t);if(n(u))for(l=0;l<u.length;++l){const t=u[l];null!=t&&m.appendChild(w,x(t,e))}else o(t.text)&&m.appendChild(w,m.createTextNode(t.text));const y=t.data.hook;r(y)&&(null===(c=y.create)||void 0===c||c.call(y,a,t),y.insert&&e.push(t))}else t.elm=m.createTextNode(t.text);return t.elm}function w(t,e,n,o,i,r){for(;o<=i;++o){const i=n[o];null!=i&&m.insertBefore(t,x(i,r),e)}}function y(t){var e,n;const o=t.data;if(void 0!==o){null===(n=null===(e=null==o?void 0:o.hook)||void 0===e?void 0:e.destroy)||void 0===n||n.call(e,t);for(let e=0;e<g.destroy.length;++e)g.destroy[e](t);if(void 0!==t.children)for(let e=0;e<t.children.length;++e){const n=t.children[e];null!=n&&"string"!=typeof n&&y(n)}}}function b(t,e,n,o){for(var i,a;n<=o;++n){let o,s;const c=e[n];if(null!=c)if(r(c.sel)){y(c),o=g.remove.length+1,s=v(c.elm,o);for(let t=0;t<g.remove.length;++t)g.remove[t](c,s);const t=null===(a=null===(i=null==c?void 0:c.data)||void 0===i?void 0:i.hook)||void 0===a?void 0:a.remove;r(t)?t(c,s):s()}else m.removeChild(t,c.elm)}}function k(t,e,n){var o,a,l,d,u;const p=null===(o=e.data)||void 0===o?void 0:o.hook;null===(a=null==p?void 0:p.prepatch)||void 0===a||a.call(p,t,e);const f=e.elm=t.elm,h=t.children,v=e.children;if(t!==e){if(void 0!==e.data){for(let n=0;n<g.update.length;++n)g.update[n](t,e);null===(d=null===(l=e.data.hook)||void 0===l?void 0:l.update)||void 0===d||d.call(l,t,e)}i(e.text)?r(h)&&r(v)?h!==v&&function(t,e,n,o){let r,a,l,d,u=0,p=0,f=e.length-1,g=e[0],h=e[f],v=n.length-1,y=n[0],N=n[v];for(;u<=f&&p<=v;)null==g?g=e[++u]:null==h?h=e[--f]:null==y?y=n[++p]:null==N?N=n[--v]:s(g,y)?(k(g,y,o),g=e[++u],y=n[++p]):s(h,N)?(k(h,N,o),h=e[--f],N=n[--v]):s(g,N)?(k(g,N,o),m.insertBefore(t,g.elm,m.nextSibling(h.elm)),g=e[++u],N=n[--v]):s(h,y)?(k(h,y,o),m.insertBefore(t,h.elm,g.elm),h=e[--f],y=n[++p]):(void 0===r&&(r=c(e,u,f)),a=r[y.key],i(a)?m.insertBefore(t,x(y,o),g.elm):(l=e[a],l.sel!==y.sel?m.insertBefore(t,x(y,o),g.elm):(k(l,y,o),e[a]=void 0,m.insertBefore(t,l.elm,g.elm))),y=n[++p]);(u<=f||p<=v)&&(u>f?(d=null==n[v+1]?null:n[v+1].elm,w(t,d,n,p,v,o)):b(t,e,u,f))}(f,h,v,n):r(v)?(r(t.text)&&m.setTextContent(f,""),w(f,null,v,0,v.length-1,n)):r(h)?b(f,h,0,h.length-1):r(t.text)&&m.setTextContent(f,""):t.text!==e.text&&(r(h)&&b(f,h,0,h.length-1),m.setTextContent(f,e.text)),null===(u=null==p?void 0:p.postpatch)||void 0===u||u.call(p,t,e)}}return function(t,e){let n,o,i;const r=[];for(n=0;n<g.pre.length;++n)g.pre[n]();for(function(t){return void 0!==t.sel}(t)||(t=h(t)),s(t,e)?k(t,e,r):(o=t.elm,i=m.parentNode(o),x(e,r),null!==i&&(m.insertBefore(i,e.elm,m.nextSibling(o)),b(i,[t],0,0))),n=0;n<r.length;++n)r[n].data.hook.insert(r[n]);for(n=0;n<g.post.length;++n)g.post[n]();return e}}([{create:f,update:f},{create:p,update:p}]);return function(t,e){const n=T(e,i);let o=B(t,C(n));function i(){o=B(o,C(n))}return e.data?n.update(e.data,e.incoming):n.loadPage(1),{update:n.update,setVisible:n.setVisible,setMsgRead:n.setMsgRead,redraw:i}}}();
