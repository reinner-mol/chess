!function(){"use strict";const t={Accept:"application/vnd.lichess.v5+json"},e={cache:"no-cache",credentials:"same-origin"},o={"X-Requested-With":"XMLHttpRequest"},n=(n,s={})=>fetch(n,Object.assign(Object.assign(Object.assign({},e),{headers:Object.assign(Object.assign({},t),o)}),s)).then((t=>{if(t.ok)return t.json();throw t.statusText})),s=(t,e={})=>a(t,e).then((t=>{if(t.ok)return t.text();throw t.statusText})),a=(t,n={})=>fetch(t,Object.assign(Object.assign(Object.assign({},e),{headers:Object.assign({},o)}),n));function c(t,e,o){c.close();const n=$('<div id="modal-wrap"><span class="close" data-icon="L"></span></div>'),s=$(`<div id="modal-overlay" class="${e}">`).on("click",c.close);return n.appendTo(s),t.clone().removeClass("none").appendTo(n),c.onClose=o,n.find(".close").on("click",c.close),n.on("click",(t=>t.stopPropagation())),$("body").addClass("overlayed").prepend(s),n}c.close=()=>{$("body").removeClass("overlayed"),$("#modal-overlay").each((function(){c.onClose&&c.onClose(),$(this).remove()})),delete c.onClose},c.onClose=void 0,lichess.load.then((()=>{$(".forum").on("click","a.delete",(function(){const t=this;return c($(".forum-delete-modal")).find("form").attr("action",t.href).on("submit",(function(e){e.preventDefault(),(t=>{const e=t.getAttribute("action");e?s(e,{method:t.method,body:new FormData(t)}):Promise.reject(`Form has no action: ${t}`)})(this),c.close(),$(t).closest(".forum-post").hide()})),!1})).on("click","form.unsub button",(function(){const t=$(this).parent().toggleClass("on off")[0];return s(`${t.action}?unsub=${$(this).data("unsub")}`,{method:"post"}),!1})),$(".edit.button").add(".edit-post-cancel").on("click",(function(t){t.preventDefault();const e=$(this).closest(".forum-post"),o=e.find(".message").toggle(),n=e.find("form.edit-post-form").toggle();n[0].reset(),n.find("textarea").height(o.height())})),$(".post-text-area").one("focus",(function(){const t=this,e=$(this).attr("data-topic");e&&lichess.loadScript("vendor/textcomplete.min.js").then((function(){const o=function(t,e){return e.filter((e=>e.toLowerCase().startsWith(t.toLowerCase())))},s=n("/forum/participants/"+e);new window.Textcomplete(new window.Textcomplete.editors.Textarea(t)).register([{match:/(^|\s)@(|[a-zA-Z_-][\w-]{0,19})$/,search:function(t,e){s.then((function(s){const a=o(t,s);0!=a.length?e(a):t.length>=3?n(((t,e)=>{const o=new URLSearchParams;for(const t of Object.keys(e))void 0!==e[t]&&o.append(t,e[t]);const n=o.toString();return n?`${t}?${n}`:t})("/player/autocomplete",{term:t}),{cache:"default"}).then((n=>e(o(t,n)))):e([])}))},replace:t=>"$1@"+t+" "}],{placement:"top",appendTo:"#lichess_forum"})}))})),$(".forum").on("click",".reactions-auth button",(t=>{const e=t.target.getAttribute("data-href");if(e){const o=$(t.target).parent();if(o.hasClass("loading"))return;o.addClass("loading"),s(e,{method:"post"}).then((t=>{o.replaceWith(t),o.removeClass("loading")}),(t=>{lichess.announce({msg:"Failed to send forum post reaction"})}))}}))}))}();
