var LichessLearn=function(){"use strict";function e(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}function t(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var n=e((function(e){var t=function e(t,n){function r(e){return"function"==typeof e}function o(e){return"[object Object]"===f.call(e)}function a(e){return"[object String]"===f.call(e)}var i,s,l,c,u=Array.isArray||function(e){return"[object Array]"===f.call(e)},f={}.toString,p=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,d=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,h=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/,g=function(){};function v(e){i=e.document,s=e.location,c=e.cancelAnimationFrame||e.clearTimeout,l=e.requestAnimationFrame||e.setTimeout}function m(e,t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(o(e))return V(e,n);var i,s=null!=t&&o(t)&&!("tag"in t||"view"in t||"subtree"in t),l=s?t:{},c="class"in l?"class":"className",f={tag:"div",attrs:{}},h=[];if(!a(e))throw new Error("selector in m(selector, attrs, children) should be a string");for(;null!=(i=p.exec(e));)if(""===i[1]&&i[2])f.tag=i[2];else if("#"===i[1])f.attrs.id=i[2];else if("."===i[1])h.push(i[2]);else if("["===i[3][0]){var g=d.exec(i[3]);f.attrs[g[1]]=g[3]||!g[2]||""}var v=s?n.slice(1):n;for(var m in 1===v.length&&u(v[0])?f.children=v[0]:f.children=v,l)l.hasOwnProperty(m)&&(m===c&&null!=l[m]&&""!==l[m]?(h.push(l[m]),f.attrs[m]=""):f.attrs[m]=l[m]);return h.length&&(f.attrs[c]=h.join(" ")),f}function b(e,t){for(var n=0;n<e.length&&!t(e[n],n++););}function w(e,t){b(e,(function(e,n){return(e=e&&e.attrs)&&null!=e.key&&t(e,n)}))}function y(e,t,n){e.insertBefore(t,e.childNodes[n]||null)}v(t),m.version=function(){return"v0.2.1-lila"};function k(e,t,n,r){var o=e.length!==t.length;return o||w(e,(function(e,n){var r=t[n];return o=r&&r.attrs&&r.attrs.key!==e.key})),o?function(e,t,n,r){w(e,(function(e,r){t[e=e.key]=t[e]?{action:3,index:r,from:t[e].index,element:n.nodes[t[e].index]||i.createElement("div")}:{action:2,index:r}}));var o=[];for(var a in t)o.push(t[a]);var s=o.sort(R),l=new Array(n.length);return l.nodes=n.nodes.slice(),b(s,(function(t){var o=t.index;if(1===t.action&&(x(n[o].nodes,n[o]),l.splice(o,1)),2===t.action){var a=i.createElement("div");a.key=e[o].attrs.key,y(r,a,o),l.splice(o,0,{attrs:{key:e[o].attrs.key},nodes:[a]}),l.nodes[o]=a}if(3===t.action){var s=t.element,c=r.childNodes[o];c!==s&&null!==s&&r.insertBefore(s,c||null),l[o]=n[t.from],l.nodes[o]=s}})),l}(e,n,t,r):t}function P(e,t,n,r,o,a){var s=t.nodes;return r&&r===i.activeElement||(e.$trusted?(x(s,t),s=q(n,o,e)):"textarea"===a?n.value=e:r?r.innerHTML=e:((1===s[0].nodeType||s.length>1)&&(x(t.nodes,t),s=[i.createTextNode(e)]),function(e,t,n,r){try{y(e,t,n),t.nodeValue=r}catch(e){}}(n,s[0],o,e))),(t=new e.constructor(e)).nodes=s,t}function C(e,t,n,r,o,a,s){return 0===e.nodes.length?function(e,t,n){var r;e.$trusted?r=q(t,n,e):(r=[i.createTextNode(e)],t.nodeName.match(h)||y(t,r[0],n));var o="string"==typeof e||"number"==typeof e||"boolean"==typeof e?new e.constructor(e):e;return o.nodes=r,o}(t,r,n):e.valueOf()!==t.valueOf()||!0===o?P(t,e,r,a,n,s):(e.nodes.intact=!0,e)}function E(e){if(e.$trusted){var t=e.match(/<[^\/]|\>\s*[^<]/g);if(null!=t)return t.length}else if(u(e))return e.length;return 1}function S(e,t,r,o,a,i,s,l,c){e=function(e){for(var t=0;t<e.length;t++)u(e[t])&&(e=e.concat.apply([],e),t--);return e}(e);var f=t.length===e.length,p=0,d={},h=!1;w(t,(function(e,n){h=!0,d[t[n].attrs.key]={action:1,index:n}})),function(e){var t=0;w(e,(function(){return b(e,(function(e){(e=e&&e.attrs)&&null==e.key&&(e.key="__mithril__"+t++)})),1}))}(e),h&&(t=k(e,t,d,r));for(var g=0,v=0,m=e.length;v<m;v++){var y=O(r,a,t,o,e[v],t[g],i,o+p||p,s,l,c);y!==n&&(f=f&&y.nodes.intact,p+=E(y),t[g++]=y)}return f||function(e,t,n){b(e,(function(e,r){null!=t[r]&&n.push.apply(n,t[r].nodes)})),b(t.nodes,(function(e,r){null!=e.parentNode&&n.indexOf(e)<0&&x([e],[t[r]])})),e.length<t.length&&(t.length=e.length),t.nodes=n}(e,t,[]),t}function T(e,t,n,r,o,a,i){var s={tag:e.tag,attrs:t,children:n,nodes:[r]};return function(e,t,n){n.length&&(e.views=t,e.controllers=n,b(n,(function(e){if(e.onunload&&e.onunload.$old&&(e.onunload=e.onunload.$old),ne&&e.onunload){var t=e.onunload;e.onunload=g,e.onunload.$old=t}})))}(s,a,i),s.children&&!s.children.nodes&&(s.children.nodes=[]),"select"===e.tag&&"value"in e.attrs&&A(r,e.tag,{value:e.attrs.value},{},o),s}function M(e,t,n,r,o,a){var i=function(e,t,n,r){var o="diff"===m.redraw.strategy()&&e?e.indexOf(t):-1;return o>-1?n[o]:"function"==typeof r?new r:{}}(n.views,t,r,e.controller),s=+(e&&e.attrs&&e.attrs.key);return"retain"===(e=0===ne||ee||r&&r.indexOf(i)>-1?e.view(i):{tag:"placeholder"}).subtree?n:(s==s&&((e.attrs=e.attrs||{}).key=s),function(e,t,n,r){null!=r.onunload&&J.push({controller:r,handler:r.onunload}),e.push(n),t.push(r)}(a,o,t,i),e)}function N(e,t,o,s,l,c,u,f){var p=[],d=[];if(!(e=function(e,t,n,r){for(var o=t&&t.controllers;null!=e.view;)e=M(e,e.view.$original||e.view,t,o,r,n);return e}(e,t,p,d)).tag&&d.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");e.attrs=e.attrs||{},t.attrs=t.attrs||{};var h=Object.keys(e.attrs),v=h.length>("key"in e.attrs?1:0);if(function(e,t,n){(e.tag!==t.tag||n.sort().join()!==Object.keys(t.attrs).sort().join()||e.attrs.id!==t.attrs.id||e.attrs.key!==t.attrs.key||"all"===m.redraw.strategy()&&(!t.configContext||!0!==t.configContext.retain)||"diff"===m.redraw.strategy()&&t.configContext&&!1===t.configContext.retain)&&(t.nodes.length&&x(t.nodes),t.configContext&&r(t.configContext.onunload)&&t.configContext.onunload(),t.controllers&&b(t.controllers,(function(e){e.unload&&e.onunload({preventDefault:g})})))}(e,t,h),a(e.tag)){var w,k=0===t.nodes.length;if(u=function(e,t){return e.attrs.xmlns?e.attrs.xmlns:"svg"===e.tag?"http://www.w3.org/2000/svg":"math"===e.tag?"http://www.w3.org/1998/Math/MathML":t}(e,u),k)t=T(e,function(e,t,n,r){return r?A(t,e.tag,e.attrs,{},n):e.attrs}(e,w=function(e,t){return t===n?e.attrs.is?i.createElement(e.tag,e.attrs.is):i.createElement(e.tag):e.attrs.is?i.createElementNS(t,e.tag,e.attrs.is):i.createElementNS(t,e.tag)}(e,u),u,v),function(e,t,r,o,a,i){return null!=e.children&&e.children.length>0?O(t,e.tag,n,n,e.children,r.children,!0,0,e.attrs.contenteditable?t:o,a,i):e.children}(e,w,t,o,u,f),w,u,p,d);else w=function(e,t,r,o,a,i,s,l){var c=e.nodes[0];return o&&A(c,t.tag,t.attrs,e.attrs,a),e.children=O(c,t.tag,n,n,t.children,e.children,!1,0,t.attrs.contenteditable?c:r,a,s),e.nodes.intact=!0,l.length&&(e.views=i,e.controllers=l),c}(t,e,o,v,u,p,f,d);return(k||!0===c&&null!=w)&&y(s,w,l),function(e,t,n,o,a){if(r(t.attrs.config)){var i=a.configContext=a.configContext||{};e.push((function(){return t.attrs.config.call(t,n,!o,i,a)}))}}(f,e,w,k,t),t}}function O(e,t,n,a,i,s,l,c,p,d,h){return"retain"===(i=function(e){return null==e?"":"object"==typeof e?e:null==e.toString()?"":e}(i)).subtree?s:(s=function(e,t,n,r,o){if(null!=t){if(f.call(t)===f.call(e))return t;if(o&&o.nodes){var a=n-r,i=a+(u(e)?e:t.nodes).length;x(o.nodes.slice(a,i),o.slice(a,i))}else t.nodes&&x(t.nodes,t)}return(t=new e.constructor).tag&&(t={}),t.nodes=[],t}(i,s,c,a,n),u(i)?S(i,s,e,c,t,l,p,d,h):null!=i&&o(i)?N(i,s,p,e,c,l,d,h):r(i)?s:C(s,i,c,e,l,p,t))}function R(e,t){return e.action-t.action||e.index-t.index}function A(e,t,n,a,i){for(var s in n){var l=n[s],c=a[s];if(s in a&&c===l)"value"===s&&"input"===t&&e.value!=l&&(e.value=l);else{if(a[s]=l,"config"===s||"key"===s)continue;if(r(l)&&"on"===s.slice(0,2))e[s]=_(l,e);else if("style"===s&&null!=l&&o(l)){for(var u in l)null!=c&&c[u]===l[u]||(e.style[u]=l[u]);for(var u in c)u in l||(e.style[u]="")}else null!=i?"href"===s?e.setAttributeNS("http://www.w3.org/1999/xlink","href",l):e.setAttribute("className"===s?"class":s,l):s in e&&"list"!==s&&"style"!==s&&"form"!==s&&"type"!==s&&"width"!==s&&"height"!==s?"input"===t&&e[s]===l||(e[s]=l):e.setAttribute(s,l)}}return a}function x(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(e){}(t=[].concat(t))[n]&&I(t[n])}e.length&&(e.length=0)}function I(e){e.configContext&&r(e.configContext.onunload)&&(e.configContext.onunload(),e.configContext.onunload=null),e.controllers&&b(e.controllers,(function(e){r(e.onunload)&&e.onunload({preventDefault:g})})),e.children&&(u(e.children)?b(e.children,I):e.children.tag&&I(e.children))}var K,B=function(){try{return i.createRange().createContextualFragment("x"),function(e,t){e.appendChild(i.createRange().createContextualFragment(t))}}catch(e){return function(e,t){e.insertAdjacentHTML("beforeend",t)}}}();function q(e,t,n){var r=e.childNodes[t];if(r){var o=1!==r.nodeType,a=i.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else B(e,n);for(var s=[];e.childNodes[t]!==r;)s.push(e.childNodes[t]),t++;return s}function _(e,t){return function(n){n=n||event,m.redraw.strategy("diff"),m.startComputation();try{return e.call(t,n)}finally{re()}}}var L={appendChild:function(e){K===n&&(K=i.createElement("html")),i.documentElement&&i.documentElement!==e?i.replaceChild(e,i.documentElement):i.appendChild(e),this.childNodes=i.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},D=[],j={};function F(e){var t=D.indexOf(e);return t<0?D.push(e)-1:t}m.render=function(e,t,r){var o=[];if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var a=F(e),s=e===i,l=s||e===i.documentElement?L:e;s&&"html"!==t.tag&&(t={tag:"html",attrs:{},children:t}),j[a]===n&&x(l.childNodes),!0===r&&ge(e),j[a]=O(l,null,n,n,t,j[a],!1,0,null,n,o),b(o,(function(e){e()}))},m.trust=function(e){return(e=new String(e)).$trusted=!0,e},m.prop=function(e){return(null!=e&&o(e)||r(e))&&r(e.then)?ve(e):function(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}(e)};var Q,U=[],G=[],$=[],W=null,z=0,Y=null,H=null,J=[];function V(e,t){var n=function(){return(e.controller||g).apply(this,t)||this};e.controller&&(n.prototype=e.controller.prototype);var r=function(n){var r=arguments.length>1?t.concat([].slice.call(arguments,1)):t;return e.view.apply(e,r?[n].concat(r):[n])};r.$original=e.view;var o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o}function X(e,t){U.splice(t,1),$.splice(t,1),G.splice(t,1),ge(e),D.splice(F(e),1)}m.component=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);return V(e,t)},m.mount=m.module=function(e,t){if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var n=U.indexOf(e);n<0&&(n=U.length);var o=!1,a={preventDefault:function(){o=!0,Y=H=null}};b(J,(function(e){e.handler.call(e.controller,a),e.controller.onunload=null})),o?b(J,(function(e){e.controller.onunload=e.handler})):J=[],$[n]&&r($[n].onunload)&&$[n].onunload(a);var i=null===t;if(!o){m.redraw.strategy("all"),m.startComputation(),U[n]=e;var s=Q=t||(t={controller:g}),l=new(t.controller||g);return s===Q&&($[n]=l,G[n]=t),re(),i&&X(e,n),$[n]}i&&X(e,n)};var Z=!1,ee=!1;function te(){Y&&(Y(),Y=null),b(U,(function(e,t){var n=G[t];if($[t]){var r=[$[t]];m.render(e,n.view?n.view($[t],r):"")}})),H&&(H(),H=null),W=null,z=new Date,m.redraw.strategy("diff")}m.redraw=function(e){if(!Z){Z=!0,e&&(ee=!0);try{W&&!e?(l===t.requestAnimationFrame||new Date-z>16)&&(W>0&&c(W),W=l(te,16)):(te(),W=l((function(){W=null}),16))}finally{Z=ee=!1}}},m.redraw.strategy=m.prop();var ne=0;function re(){"none"===m.redraw.strategy()?(ne--,m.redraw.strategy("diff")):m.endComputation()}m.startComputation=function(){ne++},m.endComputation=function(){ne>1?ne--:(ne=0,m.redraw())},m.withAttr=function(e,t,n){return function(r){var o=(r=r||event).currentTarget||this,a=n||this;t.call(a,e in o?o[e]:o.getAttribute(e))}};var oe,ae,ie={pathname:"",hash:"#",search:"?"},se=g,le=!1;function ce(e){return e.slice(ie[m.route.mode].length)}function ue(e,t,n){oe={};var r=n.indexOf("?");-1!==r&&(oe=he(n.substr(r+1,n.length)),n=n.substr(0,r));var o=Object.keys(t),a=o.indexOf(n);if(-1!==a)return m.mount(e,t[o[a]]),!0;for(var i in t){if(i===n)return m.mount(e,t[i]),!0;var s=new RegExp("^"+i.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(s.test(n))return n.replace(s,(function(){var n=i.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2);b(n,(function(e,t){oe[e.replace(/:|\./g,"")]=decodeURIComponent(r[t])})),m.mount(e,t[i])})),!0}}function fe(e){if(!(e=e||event).ctrlKey&&!e.metaKey&&2!==e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;for(var t=e.currentTarget||e.srcElement,n="pathname"===m.route.mode&&t.search?he(t.search.slice(1)):{};t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;m.route(t[m.route.mode].slice(ie[m.route.mode].length),n)}}function pe(){"hash"!==m.route.mode&&s.hash?s.hash=s.hash:t.scrollTo(0,0)}function de(e,t){var r={},a=[];for(var i in e){var s=t?t+"["+i+"]":i,l=e[i];if(null===l)a.push(encodeURIComponent(s));else if(o(l))a.push(de(l,s));else if(u(l)){var c=[];r[s]=r[s]||{},b(l,(function(e){r[s][e]||(r[s][e]=!0,c.push(encodeURIComponent(s)+"="+encodeURIComponent(e)))})),a.push(c.join("&"))}else l!==n&&a.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}return a.join("&")}function he(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));var t=e.split("&"),n={};return b(t,(function(e){var t=e.split("="),r=decodeURIComponent(t[0]),o=2===t.length?decodeURIComponent(t[1]):null;null!=n[r]?(u(n[r])||(n[r]=[n[r]]),n[r].push(o)):n[r]=o})),n}function ge(e){var t=F(e);x(e.childNodes,j[t]),j[t]=n}function ve(e,t){var n=m.prop(t);return e.then(n),n.then=function(n,r){return ve(e.then(n,r),t)},n.catch=n.then.bind(null,null),n.finally=function(e){var r=function(){return m.deferred().resolve(e()).promise};return n.then((function(e){return ve(r().then((function(){return e})),t)}),(function(e){return ve(r().then((function(){throw new Error(e)})),t)}))},n}function me(e,t){var n=this,a=0,i=0,s=[];function l(e){a=e||4,s.map((function(e){3===a?e.resolve(i):e.reject(i)}))}function c(e,t,n,a){if((null!=i&&o(i)||r(i))&&r(e))try{var s=0;e.call(i,(function(e){s++||(i=e,t())}),(function(e){s++||(i=e,n())}))}catch(e){m.deferred.onerror(e),i=e,n()}else a()}function u(){var o;try{o=i&&i.then}catch(e){return m.deferred.onerror(e),i=e,a=2,u()}c(o,(function(){a=1,u()}),(function(){a=2,u()}),(function(){try{1===a&&r(e)?i=e(i):2===a&&r(t)&&(i=t(i),a=1)}catch(e){return m.deferred.onerror(e),i=e,l()}i===n?(i=TypeError(),l()):c(o,(function(){l(3)}),l,(function(){l(1===a&&3)}))}))}n.promise={},n.resolve=function(e){return a||(i=e,a=1,u()),this},n.reject=function(e){return a||(i=e,a=2,u()),this},n.promise.then=function(e,t){var n=new me(e,t);return 3===a?n.resolve(i):4===a?n.reject(i):s.push(n),n.promise}}function be(e){return e}return m.route=function(e,n,r,o){if(0===arguments.length)return ae;if(3===arguments.length&&a(n)){se=function(t){var o=ae=ce(t);if(!ue(e,r,o)){if(le)throw new Error("Ensure the default route matches one of the routes defined in m.route");le=!0,m.route(n,!0),le=!1}};var l="hash"===m.route.mode?"onhashchange":"onpopstate";t[l]=function(){var e=s[m.route.mode];"pathname"===m.route.mode&&(e+=s.search),ae!==ce(e)&&se(e)},Y=pe,t[l]()}else if(e.addEventListener||e.attachEvent)e.href=("pathname"!==m.route.mode?s.pathname:"")+ie[m.route.mode]+o.attrs.href,e.addEventListener?(e.removeEventListener("click",fe),e.addEventListener("click",fe)):(e.detachEvent("onclick",fe),e.attachEvent("onclick",fe));else if(a(e)){var c=ae,u=n||{},f=(ae=e).indexOf("?"),p=f>-1?he(ae.slice(f+1)):{};for(var d in u)p[d]=u[d];var h=de(p),g=f>-1?ae.slice(0,f):ae;h&&(ae=g+(-1===g.indexOf("?")?"?":"&")+h);var v=!0===(3===arguments.length?r:n)||c===e;t.history.pushState?(Y=pe,H=function(){t.history[v?"replaceState":"pushState"](null,i.title,ie[m.route.mode]+ae)},se(ie[m.route.mode]+ae)):(s[m.route.mode]=ae,se(ie[m.route.mode]+ae))}},m.route.param=function(e){if(!oe)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return e?oe[e]:oe},m.route.mode="search",m.route.buildQueryString=de,m.route.parseQueryString=he,m.deferred=function(){var e=new me;return e.promise=ve(e.promise),e},m.deferred.onerror=function(e){if("[object Error]"===f.call(e)&&!e.constructor.toString().match(/ Error/))throw ne=0,e},m.sync=function(e){var t="resolve";function n(e,n){return function(i){return a[e]=i,n||(t="reject"),0==--o&&(r.promise(a),r[t](a)),i}}var r=m.deferred(),o=e.length,a=new Array(o);return e.length>0?b(e,(function(e,t){e.then(n(t,!0),n(t,!1))})):r.resolve([]),r.promise},m.request=function(e){!0!==e.background&&m.startComputation();var o=new me,s=e.dataType&&"jsonp"===e.dataType.toLowerCase(),l=e.serialize=s?be:e.serialize||JSON.stringify,c=e.deserialize=s?be:e.deserialize||JSON.parse,f=s?function(e){return e.responseText}:e.extract||function(e){return 0===e.responseText.length&&c===JSON.parse?null:e.responseText};return e.method=(e.method||"GET").toUpperCase(),e.url=function(e,t){var n=e.match(/:[a-z]\w+/gi);return n&&t&&b(n,(function(n){var r=n.slice(1);e=e.replace(n,t[r]),delete t[r]})),e}(e.url,e.data),(e=function(e,t,n){if("GET"===e.method&&"jsonp"!==e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=de(t);e.url=e.url+(o?r+o:"")}else e.data=n(t);return e}(e,e.data,l)).onload=e.onerror=function(t){try{var n=(("load"===(t=t||event).type?e.unwrapSuccess:e.unwrapError)||be)(c(f(t.target,e)),t.target);"load"===t.type&&(u(n)&&e.type?b(n,(function(t,r){n[r]=new e.type(t)})):e.type&&(n=new e.type(n))),o["load"===t.type?"resolve":"reject"](n)}catch(t){m.deferred.onerror(t),o.reject(t)}!0!==e.background&&m.endComputation()},function(e){if(!e.dataType||"jsonp"!==e.dataType.toLowerCase()){var o=new t.XMLHttpRequest;if(o.open(e.method,e.url,!0,e.user,e.password),o.onreadystatechange=function(){4===o.readyState&&(o.status>=200&&o.status<300?e.onload({type:"load",target:o}):e.onerror({type:"error",target:o}))},e.serialize===JSON.stringify&&e.data&&"GET"!==e.method&&o.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.deserialize===JSON.parse&&o.setRequestHeader("Accept","application/json, text/*"),r(e.config)){var s=e.config(o,e);null!=s&&(o=s)}var l="GET"!==e.method&&e.data?e.data:"";if(l&&!a(l)&&l.constructor!==t.FormData)throw new Error("Request data should be either be a string or FormData. Check the `serialize` option in `m.request`");return o.send(l),o}var c="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),u=i.createElement("script");t[c]=function(r){u.parentNode.removeChild(u),e.onload({type:"load",target:{responseText:r}}),t[c]=n},u.onerror=function(){return u.parentNode.removeChild(u),e.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),t[c]=n,!1},u.onload=function(){return!1},u.src=e.url+(e.url.indexOf("?")>0?"&":"?")+(e.callbackKey?e.callbackKey:"callback")+"="+c+"&"+de(e.data||{}),i.body.appendChild(u)}(e),o.promise=ve(o.promise,e.initialValue),o.promise},m.deps=function(e){return v(t=e||t),t},m.deps.factory=e,m}("undefined"!=typeof window?window:{});null!=e&&e.exports&&(e.exports=t)})),r={toLevel:function(e,t){return e.id=t+1,e.color||(e.color=/ w /.test(e.fen)?"white":"black"),e.apples?e.detectCapture=!1:e.apples=[],void 0===e.detectCapture&&(e.detectCapture="unprotected"),4===e.fen.split(" ").length&&(e.fen+=" 0 1"),e},assetUrl:$("body").data("asset-url")+"/assets/",roleToSan:{pawn:"P",knight:"N",bishop:"B",rook:"R",queen:"Q"},arrow:function(e,t){return{brush:t||"paleGreen",orig:e.slice(0,2),dest:e.slice(2,4)}},circle:function(e,t){return{brush:t||"green",orig:e}},readKeys:function(e){return"string"==typeof e?e.split(" "):e},setFenTurn:function(e,t){return e.replace(/ (w|b) /," "+t+" ")},pieceImg:function(e){return n("div.is2d.no-square",n("piece.white."+e))},roundSvg:function(e){return n("div.round-svg",n("img",{src:e}))},withLinebreaks:function(e){return n.trust(lichess.escapeHtml(e).replace(/\n/g,"<br>"))},decomposeUci:function(e){return[e.slice(0,2),e.slice(2,4),e.slice(4,5)]}},o=500,a=300,s=100;function l(e){var t=50*r.readKeys(e.apples).length;return e.pointsForCapture&&(t+=50*(e.captures||0)),t+o}var c={q:90,r:50,b:30,n:30,p:10},u={apple:50,capture:50,scenario:50,getLevelRank:function(e,t){var n=l(e);return t>=n?1:t>=n-200?2:3},getLevelBonus:function(e,t){var n=t-e.nbMoves;return n<=0?o:n<=Math.max(1,e.nbMoves/8)?a:s},getStageRank:function(e,t){var n=function(e){return e.levels.reduce((function(e,t){return e+l(t)}),0)}(e);return"number"!=typeof t&&(t=t.reduce(((e,t)=>e+t),0)),t>=n?1:t>=n-Math.max(200,150*e.levels.length)?2:3},pieceValue:function(e){return c[e]||0},gtz:function(e){return e>0}},f=r.arrow,p={key:"rook",title:"theRook",subtitle:"itMovesInStraightLines",image:r.assetUrl+"images/learn/pieces/R.svg",intro:"rookIntro",illustration:r.pieceImg("rook"),levels:[{goal:"rookGoal",fen:"8/8/8/8/8/8/4R3/8 w - -",apples:"e7",nbMoves:1,shapes:[f("e2e7")]},{goal:"grabAllTheStars",fen:"8/2R5/8/8/8/8/8/8 w - -",apples:"c5 g5",nbMoves:2,shapes:[f("c7c5"),f("c5g5")]},{goal:"theFewerMoves",fen:"8/8/8/8/3R4/8/8/8 w - -",apples:"a4 g3 g4",nbMoves:3},{goal:"theFewerMoves",fen:"7R/8/8/8/8/8/8/8 w - -",apples:"f8 g1 g7 g8 h7",nbMoves:5},{goal:"useTwoRooks",fen:"8/1R6/8/8/3R4/8/8/8 w - -",apples:"a4 g3 g7 h4",nbMoves:4},{goal:"useTwoRooks",fen:"8/8/8/8/8/5R2/8/R7 w - -",apples:"b7 d1 d5 f2 f7 g4 g7",nbMoves:7}].map(r.toLevel),complete:"rookComplete"},d=r.arrow,h={key:"bishop",title:"theBishop",subtitle:"itMovesDiagonally",image:r.assetUrl+"images/learn/pieces/B.svg",intro:"bishopIntro",illustration:r.pieceImg("bishop"),levels:[{goal:"grabAllTheStars",fen:"8/8/8/8/8/5B2/8/8 w - -",apples:"d5 g8",nbMoves:2,shapes:[d("f3d5"),d("d5g8")]},{goal:"theFewerMoves",fen:"8/8/8/8/8/1B6/8/8 w - -",apples:"a2 b1 b5 d1 d3 e2",nbMoves:6},{goal:"grabAllTheStars",fen:"8/8/8/8/3B4/8/8/8 w - -",apples:"a1 b6 c1 e3 g7 h6",nbMoves:6},{goal:"grabAllTheStars",fen:"8/8/8/8/2B5/8/8/8 w - -",apples:"a4 b1 b3 c2 d3 e2",nbMoves:6},{goal:"youNeedBothBishops",fen:"8/8/8/8/8/8/8/2B2B2 w - -",apples:"d3 d4 d5 e3 e4 e5",nbMoves:6},{goal:"youNeedBothBishops",fen:"8/3B4/8/8/8/2B5/8/8 w - -",apples:"a3 c2 e7 f5 f6 g8 h4 h7",nbMoves:11}].map(r.toLevel),complete:"bishopComplete"},g=r.arrow,v={key:"queen",title:"theQueen",subtitle:"queenCombinesRookAndBishop",image:r.assetUrl+"images/learn/pieces/Q.svg",intro:"queenIntro",illustration:r.pieceImg("queen"),levels:[{goal:"grabAllTheStars",fen:"8/8/8/8/8/8/4Q3/8 w - -",apples:"e5 b8",nbMoves:2,shapes:[g("e2e5"),g("e5b8")]},{goal:"grabAllTheStars",fen:"8/8/8/8/3Q4/8/8/8 w - -",apples:"a3 f2 f8 h3",nbMoves:4},{goal:"grabAllTheStars",fen:"8/8/8/8/2Q5/8/8/8 w - -",apples:"a3 d6 f1 f8 g3 h6",nbMoves:6},{goal:"grabAllTheStars",fen:"8/6Q1/8/8/8/8/8/8 w - -",apples:"a2 b5 d3 g1 g8 h2 h5",nbMoves:7},{goal:"grabAllTheStars",fen:"8/8/8/8/8/8/8/4Q3 w - -",apples:"a6 d1 f2 f6 g6 g8 h1 h4",nbMoves:9}].map(r.toLevel),complete:"queenComplete"},m=r.arrow,b={key:"king",title:"theKing",subtitle:"theMostImportantPiece",image:r.assetUrl+"images/learn/pieces/K.svg",intro:"kingIntro",illustration:r.pieceImg("king"),levels:[{goal:"theKingIsSlow",fen:"8/8/8/8/8/3K4/8/8 w - -",apples:"e6",nbMoves:3,shapes:[m("d3d4"),m("d4d5"),m("d5e6")]},{goal:"grabAllTheStars",fen:"8/8/8/8/8/8/8/4K3 w - -",apples:"c2 d3 e2 e3",nbMoves:4},{goal:"lastOne",fen:"8/8/8/4K3/8/8/8/8 w - -",apples:"b5 c5 d6 e3 f3 g4",nbMoves:8}].map((function(e,t){return(e=r.toLevel(e,t)).emptyApples=!0,e})),complete:"kingComplete"},w=r.arrow,y={key:"knight",title:"theKnight",subtitle:"itMovesInAnLShape",image:r.assetUrl+"images/learn/pieces/N.svg",intro:"knightIntro",illustration:r.pieceImg("knight"),levels:[{goal:"knightsHaveAFancyWay",fen:"8/8/8/8/4N3/8/8/8 w - -",apples:"c5 d7",nbMoves:2,shapes:[w("e4c5"),w("c5d7")]},{goal:"grabAllTheStars",fen:"8/8/8/8/8/8/8/1N6 w - -",apples:"c3 d4 e2 f3 f7 g5 h8",nbMoves:8},{goal:"grabAllTheStars",fen:"8/2N5/8/8/8/8/8/8 w - -",apples:"b6 d5 d7 e6 f4",nbMoves:5},{goal:"knightsCanJumpOverObstacles",fen:"8/8/8/8/5N2/8/8/8 w - -",apples:"e3 e4 e5 f3 f5 g3 g4 g5",nbMoves:9},{goal:"grabAllTheStars",fen:"8/8/8/8/8/3N4/8/8 w - -",apples:"c3 e2 e4 f2 f4 g6",nbMoves:6},{goal:"grabAllTheStars",fen:"8/2N5/8/8/8/8/8/8 w - -",apples:"b4 b5 c6 c8 d4 d5 e3 e7 f5",nbMoves:9}].map(r.toLevel),complete:"knightComplete"},k=r.readKeys;function P(e,t){if(!e)return!1;for(var n in t)if(e[n]!==t[n])return!1;return!0}function C(e){return{type:e.toLowerCase(),color:e.toLowerCase()===e?"b":"w"}}var E={pieceOn:function(e,t){return function(n){return P(n.chess.get(t),C(e))}},pieceNotOn:function(e,t){return function(n){return!P(n.chess.get(t),C(e))}},noPieceOn:function(e){return e=k(e),function(t){for(var n in t.chess.occupation())if(!e.includes(n))return!0;return!1}},whitePawnOnAnyOf:function(e){return function(e,t){return function(n){for(var r in t)if(P(n.chess.get(t[r]),e))return!0;return!1}}(C("P"),k(e))},extinct:function(e){return function(t){var n=t.chess.fen().split(" ")[0].replace(/\//g,"");return n===("white"===e?n.toLowerCase():n.toUpperCase())}},check:function(e){return e.chess.instance.in_check()},mate:function(e){return e.chess.instance.in_checkmate()},lastMoveSan:function(e){return function(t){var n=t.chess.instance.history();return n[n.length-1]===e}},checkIn:function(e){return function(t){return t.vm.nbMoves<=e&&t.chess.instance.in_check()}},noCheckIn:function(e){return function(t){return t.vm.nbMoves>=e&&!t.chess.instance.in_check()}},not:function(e){return function(t){return!e(t)}},and:function(){var e=[].slice.call(arguments);return function(t){return e.every((function(e){return e(t)}))}},or:function(){var e=[].slice.call(arguments);return function(t){return e.some((function(e){return e(t)}))}},scenarioComplete:function(e){return e.scenario.isComplete()},scenarioFailed:function(e){return e.scenario.isFailed()}},S=r.arrow,T={key:"pawn",title:"thePawn",subtitle:"itMovesForwardOnly",image:r.assetUrl+"images/learn/pieces/P.svg",intro:"pawnIntro",illustration:r.pieceImg("pawn"),levels:[{goal:"pawnsMoveOneSquareOnly",fen:"8/8/8/P7/8/8/8/8 w - -",apples:"f3",nbMoves:4,shapes:[S("a5a6"),S("a6a7"),S("a7a8"),S("a8f3")],explainPromotion:!0},{goal:"mostOfTheTimePromotingToAQueenIsBest",fen:"8/8/8/5P2/8/8/8/8 w - -",apples:"b6 c4 d7 e5 a8",nbMoves:8},{goal:"pawnsMoveForward",fen:"8/8/8/8/8/4P3/8/8 w - -",apples:"c6 d5 d7",nbMoves:4,shapes:[S("e3e4"),S("e4d5"),S("d5c6"),S("c6d7")],failure:E.noPieceOn("e3 e4 c6 d5 d7")},{goal:"captureThenPromote",fen:"8/8/8/8/8/1P6/8/8 w - -",apples:"b4 b6 c4 c6 c7 d6",nbMoves:8},{goal:"captureThenPromote",fen:"8/8/8/8/8/3P4/8/8 w - -",apples:"c4 b5 b6 d5 d7 e6 c8",failure:E.whitePawnOnAnyOf("b5 d4 d6 c7"),nbMoves:8},{goal:"useAllThePawns",fen:"8/8/8/8/8/P1PP3P/8/8 w - -",apples:"b5 c5 d4 e5 g4",nbMoves:7},{goal:"aPawnOnTheSecondRank",fen:"8/8/8/8/8/8/4P3/8 w - -",apples:"d6",nbMoves:3,shapes:[S("e2e4")],failure:E.whitePawnOnAnyOf("e3"),cssClass:"highlight-2nd-rank"},{goal:"grabAllTheStarsNoNeedToPromote",fen:"8/8/8/8/8/8/2PPPP2/8 w - -",apples:"c5 d5 e5 f5 d3 e4",nbMoves:9}].map(r.toLevel),complete:"pawnComplete"},M=r.arrow,N=r.assetUrl+"images/learn/bowman.svg",O={key:"capture",title:"capture",subtitle:"takeTheEnemyPieces",image:N,intro:"captureIntro",illustration:r.roundSvg(N),levels:[{goal:"takeTheBlackPieces",fen:"8/2p2p2/8/8/8/2R5/8/8 w - -",nbMoves:2,captures:2,shapes:[M("c3c7"),M("c7f7")],success:E.extinct("black")},{goal:"takeTheBlackPiecesAndDontLoseYours",fen:"8/2r2p2/8/8/5Q2/8/8/8 w - -",nbMoves:2,captures:2,shapes:[M("f4c7"),M("f4f7","red"),M("c7f7","yellow")],success:E.extinct("black")},{goal:"takeTheBlackPiecesAndDontLoseYours",fen:"8/5r2/8/1r3p2/8/3B4/8/8 w - -",nbMoves:5,captures:3,success:E.extinct("black")},{goal:"takeTheBlackPiecesAndDontLoseYours",fen:"8/5b2/5p2/3n2p1/8/6Q1/8/8 w - -",nbMoves:7,captures:4,success:E.extinct("black")},{goal:"takeTheBlackPiecesAndDontLoseYours",fen:"8/3b4/2p2q2/8/3p1N2/8/8/8 w - -",nbMoves:6,captures:4,success:E.extinct("black")}].map((function(e,t){return e.pointsForCapture=!0,r.toLevel(e,t)})),complete:"captureComplete"},R=r.arrow,A=r.assetUrl+"images/learn/bolt-shield.svg",x={key:"protection",title:"protection",subtitle:"keepYourPiecesSafe",image:A,intro:"protectionIntro",illustration:r.roundSvg(A),levels:[{goal:"escape",fen:"8/8/8/4bb2/8/8/P2P4/R2K4 w - -",shapes:[R("e5a1","red"),R("a1c1")]},{goal:"escape",fen:"8/8/2q2N2/8/8/8/8/8 w - -"},{goal:"noEscape",fen:"8/N2q4/8/8/8/8/6R1/8 w - -",scenario:[{move:"g2a2",shapes:[R("a2a7","green")]}]},{goal:"noEscape",fen:"8/8/1Bq5/8/2P5/8/8/8 w - -"},{goal:"noEscape",fen:"1r6/8/5b2/8/8/5N2/P2P4/R1B5 w - -",shapes:[R("f6a1","red"),R("d2d4")]},{goal:"dontLetThemTakeAnyUndefendedPiece",fen:"8/1b6/8/8/8/3P2P1/5NRP/r7 w - -"},{goal:"dontLetThemTakeAnyUndefendedPiece",fen:"rr6/3q4/4n3/4P1B1/7P/P7/1B1N1PP1/R5K1 w - -"},{goal:"dontLetThemTakeAnyUndefendedPiece",fen:"8/3q4/8/1N3R2/8/2PB4/8/8 w - -"}].map((function(e,t){return e.nbMoves=1,r.toLevel(e,t)})),complete:"protectionComplete"},I=r.arrow,K=r.assetUrl+"images/learn/battle-gear.svg",B={key:"combat",title:"combat",subtitle:"captureAndDefendPieces",image:K,intro:"combatIntro",illustration:r.roundSvg(K),levels:[{goal:"takeTheBlackPiecesAndDontLoseYours",fen:"8/8/8/8/P2r4/6B1/8/8 w - -",nbMoves:3,captures:1,shapes:[I("a4a5"),I("g3f2"),I("f2d4"),I("d4a4","yellow")],success:E.extinct("black")},{goal:"takeTheBlackPiecesAndDontLoseYours",fen:"2r5/8/3b4/2P5/8/1P6/2B5/8 w - -",nbMoves:4,captures:2,success:E.extinct("black")},{goal:"takeTheBlackPiecesAndDontLoseYours",fen:"1r6/8/5n2/3P4/4P1P1/1Q6/8/8 w - -",nbMoves:4,captures:2,success:E.extinct("black")},{goal:"takeTheBlackPiecesAndDontLoseYours",fen:"2r5/8/3N4/5b2/8/8/PPP5/8 w - -",nbMoves:4,captures:2,success:E.extinct("black")},{goal:"takeTheBlackPiecesAndDontLoseYours",fen:"8/6q1/8/4P1P1/8/4B3/r2P2N1/8 w - -",nbMoves:8,captures:2,success:E.extinct("black")}].map((function(e,t){return e.pointsForCapture=!0,r.toLevel(e,t)})),complete:"combatComplete"},q=r.arrow,_=r.assetUrl+"images/learn/winged-sword.svg",L={key:"check1",title:"checkInOne",subtitle:"attackTheOpponentsKing",image:_,intro:"checkInOneIntro",illustration:r.roundSvg(_),levels:[{goal:"checkInOneGoal",fen:"4k3/8/2b5/8/8/8/8/R7 w - -",shapes:[q("a1e1")]},{goal:"checkInOneGoal",fen:"8/8/4k3/3n4/8/1Q6/8/8 w - -"},{goal:"checkInOneGoal",fen:"3qk3/1pp5/3p4/4p3/8/3B4/6r1/8 w - -"},{goal:"checkInOneGoal",fen:"2r2q2/2n5/8/4k3/8/2N1P3/3P2B1/8 w - -"},{goal:"checkInOneGoal",fen:"8/2b1q2n/1ppk4/2N5/8/8/8/8 w - -"},{goal:"checkInOneGoal",fen:"6R1/1k3r2/8/4Q3/8/2n5/8/8 w - -"},{goal:"checkInOneGoal",fen:"7r/4k3/8/3n4/4N3/8/2R5/4Q3 w - -"}].map((function(e,t){return e.nbMoves=1,e.failure=E.not(E.check),e.success=E.check,r.toLevel(e,t)})),complete:"checkInOneComplete"},D=r.arrow,j=r.assetUrl+"images/learn/guards.svg",F={key:"outOfCheck",title:"outOfCheck",subtitle:"defendYourKing",image:j,intro:"outOfCheckIntro",illustration:r.roundSvg(j),levels:[{goal:"escapeWithTheKing",fen:"8/8/8/4q3/8/8/8/4K3 w - -",shapes:[D("e5e1","red"),D("e1f1")]},{goal:"escapeWithTheKing",fen:"8/2n5/5b2/8/2K5/8/2q5/8 w - -"},{goal:"theKingCannotEscapeButBlock",fen:"8/7r/6r1/8/R7/7K/8/8 w - -"},{goal:"youCanGetOutOfCheckByTaking",fen:"8/8/8/3b4/8/4N3/KBn5/1R6 w - -"},{goal:"thisKnightIsCheckingThroughYourDefenses",fen:"4q3/8/8/8/8/5nb1/3PPP2/3QKBNr w - -"},{goal:"escapeOrBlock",fen:"8/8/7p/2q5/5n2/1N1KP2r/3R4/8 w - -"},{goal:"escapeOrBlock",fen:"8/6b1/8/8/q4P2/2KN4/3P4/8 w - -"}].map((function(e,t){return e.detectCapture=!1,e.offerIllegalMove=!0,e.nbMoves=1,r.toLevel(e,t)})),complete:"outOfCheckComplete"},Q=r.arrow,U=r.assetUrl+"images/learn/guillotine.svg",G={key:"checkmate1",title:"mateInOne",subtitle:"defeatTheOpponentsKing",image:U,intro:"mateInOneIntro",illustration:r.roundSvg(U),levels:[{goal:"attackYourOpponentsKing",fen:"3qk3/3ppp2/8/8/2B5/5Q2/8/8 w - -",shapes:[Q("f3f7")]},{goal:"attackYourOpponentsKing",fen:"6rk/6pp/7P/6N1/8/8/8/8 w - -"},{goal:"attackYourOpponentsKing",fen:"R7/8/7k/2r5/5n2/8/6Q1/8 w - -"},{goal:"attackYourOpponentsKing",fen:"2rb4/2k5/5N2/1Q6/8/8/8/8 w - -"},{goal:"attackYourOpponentsKing",fen:"1r2kb2/ppB1p3/2P2p2/2p1N3/B7/8/8/3R4 w - -"},{goal:"attackYourOpponentsKing",fen:"8/pk1N4/n7/b7/6B1/1r3b2/8/1RR5 w - -",scenario:[{move:"g4f3",shapes:[Q("b1b7","yellow"),Q("f3b7","yellow")]}]},{goal:"attackYourOpponentsKing",fen:"r1b5/ppp5/2N2kpN/5q2/8/Q7/8/4B3 w - -"}].map((function(e,t){return e.nbMoves=1,e.failure=E.not(E.mate),e.success=E.mate,e.showFailureFollowUp=!0,r.toLevel(e,t)})),complete:"mateInOneComplete"},W=E.and,z=r.arrow,Y=r.assetUrl+"images/learn/rally-the-troops.svg",H={key:"setup",title:"boardSetup",subtitle:"howTheGameStarts",image:Y,intro:"boardSetupIntro",illustration:r.roundSvg(Y),levels:[{goal:"thisIsTheInitialPosition",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - -",nbMoves:1},{goal:"firstPlaceTheRooks",fen:"r6r/pppppppp/8/8/8/8/8/2RR4 w - -",apples:"a1 h1",nbMoves:2,shapes:[z("c1a1"),z("d1h1")],success:W(E.pieceOn("R","a1"),E.pieceOn("R","h1"))},{goal:"thenPlaceTheKnights",fen:"rn4nr/pppppppp/8/8/8/8/2NN4/R6R w - -",apples:"b1 g1",nbMoves:4,success:W(E.pieceOn("N","b1"),E.pieceOn("N","g1"))},{goal:"placeTheBishops",fen:"rnb2bnr/pppppppp/8/8/4BB2/8/8/RN4NR w - -",apples:"c1 f1",nbMoves:4,success:W(E.pieceOn("B","c1"),E.pieceOn("B","f1"))},{goal:"placeTheQueen",fen:"rnbq1bnr/pppppppp/8/8/5Q2/8/8/RNB2BNR w - -",apples:"d1",nbMoves:2,success:E.pieceOn("Q","d1")},{goal:"placeTheKing",fen:"rnbqkbnr/pppppppp/8/8/5K2/8/8/RNBQ1BNR w - -",apples:"e1",nbMoves:3,success:E.pieceOn("K","e1")},{goal:"pawnsFormTheFrontLine",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - -",nbMoves:1,cssClass:"highlight-2nd-rank highlight-7th-rank"}].map((function(e,t){return r.toLevel(e,t)})),complete:"boardSetupComplete",cssClass:"no-go-home"},J=r.arrow,V=r.circle,X=r.assetUrl+"images/learn/castle.svg",Z=E.lastMoveSan("O-O"),ee=E.lastMoveSan("O-O-O"),te=E.and(E.not(Z),E.or(E.pieceNotOn("K","e1"),E.pieceNotOn("R","h1"))),ne=E.and(E.not(ee),E.or(E.pieceNotOn("K","e1"),E.pieceNotOn("R","a1"))),re={key:"castling",title:"castling",subtitle:"theSpecialKingMove",image:X,intro:"castlingIntro",illustration:r.roundSvg(X),levels:[{goal:"castleKingSide",fen:"rnbqkbnr/pppppppp/8/8/2B5/4PN2/PPPP1PPP/RNBQK2R w KQkq -",nbMoves:1,shapes:[J("e1g1")],success:Z,failure:te},{goal:"castleQueenSide",fen:"rnbqkbnr/pppppppp/8/8/4P3/1PN5/PBPPQPPP/R3KBNR w KQkq -",nbMoves:1,shapes:[J("e1c1")],success:ee,failure:ne},{goal:"theKnightIsInTheWay",fen:"rnbqkbnr/pppppppp/8/8/8/4P3/PPPPBPPP/RNBQK1NR w KQkq -",nbMoves:2,shapes:[J("e1g1"),J("g1f3")],success:Z,failure:te},{goal:"castleKingSideMovePiecesFirst",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq -",nbMoves:4,shapes:[J("e1g1")],success:Z,failure:te},{goal:"castleQueenSideMovePiecesFirst",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq -",nbMoves:6,shapes:[J("e1c1")],success:ee,failure:ne},{goal:"youCannotCastleIfMoved",fen:"rnbqkbnr/pppppppp/8/8/3P4/1PN1PN2/PBPQBPPP/R3K1R1 w Qkq -",nbMoves:1,shapes:[J("e1g1","red"),J("e1c1")],success:ee,failure:ne},{goal:"youCannotCastleIfAttacked",fen:"rn1qkbnr/ppp1pppp/3p4/8/2b5/4PN2/PPPP1PPP/RNBQK2R w KQkq -",nbMoves:2,shapes:[J("c4f1","red"),V("e1"),V("f1"),V("g1")],success:Z,failure:te,detectCapture:!1},{goal:"findAWayToCastleKingSide",fen:"rnb2rk1/pppppppp/8/8/8/4Nb1n/PPPP1P1P/RNB1KB1R w KQkq -",nbMoves:2,shapes:[J("e1g1")],success:Z,failure:te,detectCapture:!1},{goal:"findAWayToCastleQueenSide",fen:"1r1k2nr/p2ppppp/7b/7b/4P3/2nP4/P1P2P2/RN2K3 w Q -",nbMoves:4,shapes:[J("e1c1")],success:ee,failure:ne,detectCapture:!1}].map((function(e,t){return e.autoCastle=!0,r.toLevel(e,t)})),complete:"castlingComplete"},oe=r.arrow,ae=r.assetUrl+"images/learn/spinning-blades.svg",ie={key:"enpassant",title:"enPassant",subtitle:"theSpecialPawnMove",image:ae,intro:"enPassantIntro",illustration:r.roundSvg(ae),levels:[{goal:"blackJustMovedThePawnByTwoSquares",fen:"rnbqkbnr/pppppppp/8/2P5/8/8/PP1PPPPP/RNBQKBNR b KQkq -",color:"white",nbMoves:1,success:E.scenarioComplete,failure:E.scenarioFailed,detectCapture:!1,scenario:[{move:"d7d5",shapes:[oe("c5d6")]},"c5d6"],captures:1},{goal:"enPassantOnlyWorksImmediately",fen:"rnbqkbnr/ppp1pppp/8/2Pp3P/8/8/PP1PPPP1/RNBQKBNR b KQkq -",color:"white",nbMoves:1,success:E.scenarioComplete,failure:E.scenarioFailed,detectCapture:!1,scenario:[{move:"g7g5",shapes:[oe("h5g6"),oe("c5d6","red")]},"h5g6"],captures:1},{goal:"enPassantOnlyWorksOnFifthRank",fen:"rnbqkbnr/pppppppp/P7/2P5/8/8/PP1PPPP1/RNBQKBNR b KQkq -",color:"white",nbMoves:1,success:E.scenarioComplete,failure:E.scenarioFailed,detectCapture:!1,scenario:[{move:"b7b5",shapes:[oe("c5b6"),oe("a6b7","red")]},"c5b6"],captures:1,cssClass:"highlight-5th-rank"},{goal:"takeAllThePawnsEnPassant",fen:"rnbqkbnr/pppppppp/8/2PPP2P/8/8/PP1P1PP1/RNBQKBNR b KQkq -",color:"white",nbMoves:4,detectCapture:!1,success:E.scenarioComplete,failure:E.scenarioFailed,scenario:["b7b5","c5b6","f7f5","e5f6","c7c5","d5c6","g7g5","h5g6"],captures:4}].map(r.toLevel),complete:"enPassantComplete"},se=r.arrow,le=r.circle,ce=r.assetUrl+"images/learn/scales.svg",ue={key:"stalemate",title:"stalemate",subtitle:"theGameIsADraw",image:ce,intro:"stalemateIntro",illustration:r.roundSvg(ce),levels:[{goal:"stalemateGoal",fen:"k7/8/8/6B1/8/1R6/8/8 w - -",shapes:[se("g5e3")],success:E.scenarioComplete,failure:E.scenarioFailed,scenario:[{move:"g5e3",shapes:[se("e3a7","blue"),se("b3b7","blue"),se("b3b8","blue"),le("a7","blue"),le("b7","blue"),le("b8","blue")]}],nextButton:!0,showFailureFollowUp:!0},{goal:"stalemateGoal",fen:"8/7p/4N2k/8/8/3N4/8/1K6 w - -",success:E.scenarioComplete,failure:E.scenarioFailed,scenario:[{move:"d3f4",shapes:[se("e6g7","blue"),se("e6g5","blue"),se("f4g6","blue"),se("f4h5","blue"),le("g7","blue"),le("g5","blue"),le("g6","blue"),le("h5","blue")]}],nextButton:!0,showFailureFollowUp:!0},{goal:"stalemateGoal",fen:"4k3/6p1/5p2/p4P2/PpB2N2/1K6/8/3R4 w - -",success:E.scenarioComplete,failure:E.scenarioFailed,scenario:[{move:"f4g6",shapes:[se("c4f7","blue"),se("d1d8","blue"),se("g6e7","blue"),se("g6f8","blue")]}],nextButton:!0,showFailureFollowUp:!0},{goal:"stalemateGoal",fen:"8/6pk/6np/7K/8/3B4/8/1R6 w - -",success:E.scenarioComplete,failure:E.scenarioFailed,scenario:[{move:"b1b8",shapes:[se("b8g8","blue"),se("b8h8","blue"),se("d3h7","red"),se("g6e7","red")]}],nextButton:!0,showFailureFollowUp:!0},{goal:"stalemateGoal",fen:"7R/pk6/p1pP4/K7/3BB2p/7p/1r5P/8 w - -",success:E.scenarioComplete,failure:E.scenarioFailed,scenario:[{move:"d4b2",shapes:[se("h8a8","blue"),se("a5b6","blue"),se("d6c7","blue"),se("e4b7","red"),se("c6c5","red")]}],nextButton:!0,showFailureFollowUp:!0}].map((function(e,t){return e.detectCapture=!1,e.nbMoves=1,r.toLevel(e,t)})),complete:"stalemateComplete"},fe=r.arrow,pe=r.assetUrl+"images/learn/sprint.svg",de={key:"value",title:"pieceValue",subtitle:"evaluatePieceStrength",image:pe,intro:"pieceValueIntro",illustration:r.roundSvg(pe),levels:[{goal:"queenOverBishop",fen:"8/8/2qrbnp1/3P4/8/8/8/8 w - -",scenario:["d5c6"],nbMoves:1,captures:1,shapes:[fe("d5c6")],success:E.scenarioComplete,failure:E.scenarioFailed,detectCapture:!1},{goal:"pieceValueExchange",fen:"8/8/4b3/1p6/6r1/8/4Q3/8 w - -",scenario:["e2e6"],nbMoves:1,captures:1,success:E.scenarioComplete,failure:E.scenarioFailed,detectCapture:!0},{goal:"pieceValueLegal",fen:"5b2/8/6N1/2q5/3Kn3/2rp4/3B4/8 w - -",scenario:["d4e4"],nbMoves:1,captures:1,offerIllegalMove:!0,success:E.scenarioComplete,failure:E.scenarioFailed},{goal:"takeThePieceWithTheHighestValue",fen:"1k4q1/pp6/8/3B4/2P5/1P1p2P1/P3Kr1P/3n4 w - -",scenario:["e2d1"],nbMoves:1,captures:1,offerIllegalMove:!0,success:E.scenarioComplete,failure:E.scenarioFailed,detectCapture:!1},{goal:"takeThePieceWithTheHighestValue",fen:"7k/3bqp1p/7r/5N2/6K1/6n1/PPP5/R1B5 w - -",scenario:["c1h6"],nbMoves:1,captures:1,offerIllegalMove:!0,success:E.scenarioComplete,failure:E.scenarioFailed}].map((function(e,t){return e.pointsForCapture=!0,e.showPieceValues=!0,r.toLevel(e,t)})),complete:"pieceValueComplete"},he=r.arrow,ge=r.assetUrl+"images/learn/crossed-swords.svg",ve=[{key:"chess-pieces",name:"chessPieces",stages:[p,h,v,b,y,T]},{key:"fundamentals",name:"fundamentals",stages:[O,x,B,L,F,G]},{key:"intermediate",name:"intermediate",stages:[H,re,ie,ue]},{key:"advanced",name:"advanced",stages:[de,{key:"check2",title:"checkInTwo",subtitle:"twoMovesToGiveCheck",image:ge,intro:"checkInTwoIntro",illustration:r.roundSvg(ge),levels:[{goal:"checkInTwoGoal",fen:"2k5/2pb4/8/2R5/8/8/8/8 w - -",shapes:[he("c5a5"),he("a5a8")]},{goal:"checkInTwoGoal",fen:"8/8/5k2/8/8/1N6/5b2/8 w - -"},{goal:"checkInTwoGoal",fen:"6k1/2r3pp/8/1N6/8/8/4B3/8 w - -"},{goal:"checkInTwoGoal",fen:"r3k3/7b/8/4B3/8/8/4N3/4R3 w - -"},{goal:"checkInTwoGoal",fen:"r1bqkb1r/pppp1p1p/2n2np1/4p3/2B5/4PN2/PPPP1PPP/RNBQK2R w KQkq -"},{goal:"checkInTwoGoal",fen:"8/8/8/2k5/q7/4N3/3B4/8 w - -"},{goal:"checkInTwoGoal",fen:"r6r/1Q2nk2/1B3p2/8/8/8/8/8 w - -"}].map((function(e,t){return e.nbMoves=2,e.failure=E.noCheckIn(2),e.success=E.checkIn(2),r.toLevel(e,t)})),complete:"checkInTwoComplete"}]}],me=1,be=[];ve=ve.map((function(e){return e.stages=e.stages.map((function(e){return e.id=me++,be.push(e),e})),e}));var we={};be.forEach((function(e){we[e.key]=e}));var ye={};be.forEach((function(e){ye[e.id]=e}));var ke={list:be,byId:ye,byKey:we,categs:ve,stageIdToCategId:function(e){var t=ye[e];for(var n in ve)if(ve[n].stages.some((function(e){return e.key===t.key})))return n}};function Pe(e,t,r,o){if("future"!==r){var a;if("ongoing"===r){var i=e.stageProgress(t);a=i[0]?i.join(" / "):e.trans.noarg("play")}else a=function(e){for(var t=[],r=0;r<4-e;r++)t.push(n("i",{"data-icon":"t"}));return t}(u.getStageRank(t,o.scores));return"future"!==r?n("span.ribbon-wrapper",n("span.ribbon",{class:r},a)):void 0}}function Ce(e){return e.length>13?e.length>18?" vvv":" vv":""}var Ee=function(e){return n("div.learn.learn--map",[n("div.learn__side",e.opts.side.view()),n("div.learn__main.learn-stages",[ke.categs.map((function(t){return n("div.categ",[n("h2",e.trans.noarg(t.name)),n("div.categ_stages",t.stages.map((function(t){var r=e.data.stages[t.key],o=e.isStageIdComplete(t.id),a=e.isStageIdComplete(t.id-1),i="future";o?i="done":(a||r)&&(i="ongoing");var s=e.trans.noarg(t.title);return n("a",{class:"stage "+i+Ce(s),href:"/"+t.id,config:n.route},[Pe(e,t,i,r),n("img",{src:t.image}),n("div.text",[n("h3",s),n("p.subtitle",e.trans.noarg(t.subtitle))])])})))])}))])])};const Se=[];var Te=t(Object.freeze({__proto__:null,setTimeout:function(e,t){Se.push(window.setTimeout(e,t))},clearTimeouts:function(){Se.forEach((e=>clearTimeout(e))),Se.length=0}})),Me=function(e,t){return{controller:function(){return Te.clearTimeouts(),e.stageId=null,e.route="map",{opts:e,data:e.storage.data,trans:t,isStageIdComplete:function(t){var n=ke.byId[t];if(!n)return!0;var r=e.storage.data.stages[n.key];return!!r&&r.scores.filter(u.gtz).length>=n.levels.length},stageProgress:function(t){var n=e.storage.data.stages[t.key];return[n?n.scores.filter(u.gtz).length:0,t.levels.length]}}},view:Ee}};var Ne=function(e,t){return{controller:function(){var r=n.prop(0);return n.redraw.strategy("diff"),{data:e.storage.data,categId:r,active:function(){return e.stageId},inStage:function(){return"run"===e.route},setStage:function(e){r(ke.stageIdToCategId(e.id))},progress:function(){var t=10*ke.list.length,n=e.storage.data.stages,r=Object.keys(n).reduce((function(e,t){var r=u.getStageRank(ke.byKey[t],n[t].scores);return 1===r?e+10:2===r?e+8:e+5}),0);return Math.round(r/t*100)},reset:e.storage.reset,trans:t}},view:function(e){return e.inStage()?function(e){return n("div.learn__side-map",[n("div.stages",[n("a.back",{href:"/",config:n.route},[n("img",{src:r.assetUrl+"images/learn/brutal-helm.svg"}),e.trans.noarg("menu")])])])}(e):function(e){var t=e.progress();return n("div.learn__side-home",[n("h1",e.trans.noarg("learnChess")),n("h2",e.trans.noarg("byPlaying")),n("div.progress",[n("div.text",e.trans("progressX",t+"%")),n("div.bar",{style:{width:t+"%"}})]),n("div.actions",[t>0?n("a.confirm",{onclick:function(){confirm(e.trans.noarg("youWillLoseAllYourProgress"))&&e.reset()}},e.trans.noarg("resetMyProgress")):null])])}(e)}}},Oe=function(e){var t={};r.readKeys(e.apples).forEach((function(e){t[e]="apple"}));var n=function(e){return t[e]};return{get:n,withItem:function(e,n){if(t[e])return n(t[e])},remove:function(e){delete t[e]},hasItem:function(e){return Object.keys(t).map(n).includes(e)},appleKeys:function(){var e=[];for(var n in t)"apple"===t[n]&&e.push(n);return e}}},Re=function(e){return n("item."+e)},Ae=e((function(e){var t=function e(t,n){function r(e){return"function"==typeof e}function o(e){return"[object Object]"===f.call(e)}function a(e){return"[object String]"===f.call(e)}var i,s,l,c,u=Array.isArray||function(e){return"[object Array]"===f.call(e)},f={}.toString,p=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,d=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,h=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/,g=function(){};function v(e){i=e.document,s=e.location,c=e.cancelAnimationFrame||e.clearTimeout,l=e.requestAnimationFrame||e.setTimeout}function m(e,t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(o(e))return V(e,n);var i,s=null!=t&&o(t)&&!("tag"in t||"view"in t||"subtree"in t),l=s?t:{},c="class"in l?"class":"className",f={tag:"div",attrs:{}},h=[];if(!a(e))throw new Error("selector in m(selector, attrs, children) should be a string");for(;null!=(i=p.exec(e));)if(""===i[1]&&i[2])f.tag=i[2];else if("#"===i[1])f.attrs.id=i[2];else if("."===i[1])h.push(i[2]);else if("["===i[3][0]){var g=d.exec(i[3]);f.attrs[g[1]]=g[3]||!g[2]||""}var v=s?n.slice(1):n;for(var m in 1===v.length&&u(v[0])?f.children=v[0]:f.children=v,l)l.hasOwnProperty(m)&&(m===c&&null!=l[m]&&""!==l[m]?(h.push(l[m]),f.attrs[m]=""):f.attrs[m]=l[m]);return h.length&&(f.attrs[c]=h.join(" ")),f}function b(e,t){for(var n=0;n<e.length&&!t(e[n],n++););}function w(e,t){b(e,(function(e,n){return(e=e&&e.attrs)&&null!=e.key&&t(e,n)}))}function y(e,t,n){e.insertBefore(t,e.childNodes[n]||null)}v(t),m.version=function(){return"v0.2.1"};function k(e,t,n,r){var o=e.length!==t.length;return o||w(e,(function(e,n){var r=t[n];return o=r&&r.attrs&&r.attrs.key!==e.key})),o?function(e,t,n,r){w(e,(function(e,r){t[e=e.key]=t[e]?{action:3,index:r,from:t[e].index,element:n.nodes[t[e].index]||i.createElement("div")}:{action:2,index:r}}));var o=[];for(var a in t)o.push(t[a]);var s=o.sort(R),l=new Array(n.length);return l.nodes=n.nodes.slice(),b(s,(function(t){var o=t.index;if(1===t.action&&(x(n[o].nodes,n[o]),l.splice(o,1)),2===t.action){var a=i.createElement("div");a.key=e[o].attrs.key,y(r,a,o),l.splice(o,0,{attrs:{key:e[o].attrs.key},nodes:[a]}),l.nodes[o]=a}if(3===t.action){var s=t.element,c=r.childNodes[o];c!==s&&null!==s&&r.insertBefore(s,c||null),l[o]=n[t.from],l.nodes[o]=s}})),l}(e,n,t,r):t}function P(e,t,n,r,o,a){var s=t.nodes;return r&&r===i.activeElement||(e.$trusted?(x(s,t),s=q(n,o,e)):"textarea"===a?n.value=e:r?r.innerHTML=e:((1===s[0].nodeType||s.length>1)&&(x(t.nodes,t),s=[i.createTextNode(e)]),function(e,t,n,r){try{y(e,t,n),t.nodeValue=r}catch(e){}}(n,s[0],o,e))),(t=new e.constructor(e)).nodes=s,t}function C(e,t,n,r,o,a,s){return 0===e.nodes.length?function(e,t,n){var r;e.$trusted?r=q(t,n,e):(r=[i.createTextNode(e)],t.nodeName.match(h)||y(t,r[0],n));var o="string"==typeof e||"number"==typeof e||"boolean"==typeof e?new e.constructor(e):e;return o.nodes=r,o}(t,r,n):e.valueOf()!==t.valueOf()||!0===o?P(t,e,r,a,n,s):(e.nodes.intact=!0,e)}function E(e){if(e.$trusted){var t=e.match(/<[^\/]|\>\s*[^<]/g);if(null!=t)return t.length}else if(u(e))return e.length;return 1}function S(e,t,r,o,a,i,s,l,c){e=function(e){for(var t=0;t<e.length;t++)u(e[t])&&(e=e.concat.apply([],e),t--);return e}(e);var f=t.length===e.length,p=0,d={},h=!1;w(t,(function(e,n){h=!0,d[t[n].attrs.key]={action:1,index:n}})),function(e){var t=0;w(e,(function(){return b(e,(function(e){(e=e&&e.attrs)&&null==e.key&&(e.key="__mithril__"+t++)})),1}))}(e),h&&(t=k(e,t,d,r));for(var g=0,v=0,m=e.length;v<m;v++){var y=O(r,a,t,o,e[v],t[g],i,o+p||p,s,l,c);y!==n&&(f=f&&y.nodes.intact,p+=E(y),t[g++]=y)}return f||function(e,t,n){b(e,(function(e,r){null!=t[r]&&n.push.apply(n,t[r].nodes)})),b(t.nodes,(function(e,r){null!=e.parentNode&&n.indexOf(e)<0&&x([e],[t[r]])})),e.length<t.length&&(t.length=e.length),t.nodes=n}(e,t,[]),t}function T(e,t,n,r,o,a,i){var s={tag:e.tag,attrs:t,children:n,nodes:[r]};return function(e,t,n){n.length&&(e.views=t,e.controllers=n,b(n,(function(e){if(e.onunload&&e.onunload.$old&&(e.onunload=e.onunload.$old),ne&&e.onunload){var t=e.onunload;e.onunload=g,e.onunload.$old=t}})))}(s,a,i),s.children&&!s.children.nodes&&(s.children.nodes=[]),"select"===e.tag&&"value"in e.attrs&&A(r,e.tag,{value:e.attrs.value},{},o),s}function M(e,t,n,r,o,a){var i=function(e,t,n,r){var o="diff"===m.redraw.strategy()&&e?e.indexOf(t):-1;return o>-1?n[o]:"function"==typeof r?new r:{}}(n.views,t,r,e.controller),s=+(e&&e.attrs&&e.attrs.key);return"retain"===(e=0===ne||ee||r&&r.indexOf(i)>-1?e.view(i):{tag:"placeholder"}).subtree?n:(s==s&&((e.attrs=e.attrs||{}).key=s),function(e,t,n,r){null!=r.onunload&&J.push({controller:r,handler:r.onunload}),e.push(n),t.push(r)}(a,o,t,i),e)}function N(e,t,o,s,l,c,u,f){var p=[],d=[];if(!(e=function(e,t,n,r){for(var o=t&&t.controllers;null!=e.view;)e=M(e,e.view.$original||e.view,t,o,r,n);return e}(e,t,p,d)).tag&&d.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");e.attrs=e.attrs||{},t.attrs=t.attrs||{};var h=Object.keys(e.attrs),v=h.length>("key"in e.attrs?1:0);if(function(e,t,n){(e.tag!==t.tag||n.sort().join()!==Object.keys(t.attrs).sort().join()||e.attrs.id!==t.attrs.id||e.attrs.key!==t.attrs.key||"all"===m.redraw.strategy()&&(!t.configContext||!0!==t.configContext.retain)||"diff"===m.redraw.strategy()&&t.configContext&&!1===t.configContext.retain)&&(t.nodes.length&&x(t.nodes),t.configContext&&r(t.configContext.onunload)&&t.configContext.onunload(),t.controllers&&b(t.controllers,(function(e){e.unload&&e.onunload({preventDefault:g})})))}(e,t,h),a(e.tag)){var w,k=0===t.nodes.length;if(u=function(e,t){return e.attrs.xmlns?e.attrs.xmlns:"svg"===e.tag?"http://www.w3.org/2000/svg":"math"===e.tag?"http://www.w3.org/1998/Math/MathML":t}(e,u),k)t=T(e,function(e,t,n,r){return r?A(t,e.tag,e.attrs,{},n):e.attrs}(e,w=function(e,t){return t===n?e.attrs.is?i.createElement(e.tag,e.attrs.is):i.createElement(e.tag):e.attrs.is?i.createElementNS(t,e.tag,e.attrs.is):i.createElementNS(t,e.tag)}(e,u),u,v),function(e,t,r,o,a,i){return null!=e.children&&e.children.length>0?O(t,e.tag,n,n,e.children,r.children,!0,0,e.attrs.contenteditable?t:o,a,i):e.children}(e,w,t,o,u,f),w,u,p,d);else w=function(e,t,r,o,a,i,s,l){var c=e.nodes[0];return o&&A(c,t.tag,t.attrs,e.attrs,a),e.children=O(c,t.tag,n,n,t.children,e.children,!1,0,t.attrs.contenteditable?c:r,a,s),e.nodes.intact=!0,l.length&&(e.views=i,e.controllers=l),c}(t,e,o,v,u,p,f,d);return(k||!0===c&&null!=w)&&y(s,w,l),function(e,t,n,o,a){if(r(t.attrs.config)){var i=a.configContext=a.configContext||{};e.push((function(){return t.attrs.config.call(t,n,!o,i,a)}))}}(f,e,w,k,t),t}}function O(e,t,n,a,i,s,l,c,p,d,h){return"retain"===(i=function(e){return null==e?"":"object"==typeof e?e:null==e.toString()?"":e}(i)).subtree?s:(s=function(e,t,n,r,o){if(null!=t){if(f.call(t)===f.call(e))return t;if(o&&o.nodes){var a=n-r,i=a+(u(e)?e:t.nodes).length;x(o.nodes.slice(a,i),o.slice(a,i))}else t.nodes&&x(t.nodes,t)}return(t=new e.constructor).tag&&(t={}),t.nodes=[],t}(i,s,c,a,n),u(i)?S(i,s,e,c,t,l,p,d,h):null!=i&&o(i)?N(i,s,p,e,c,l,d,h):r(i)?s:C(s,i,c,e,l,p,t))}function R(e,t){return e.action-t.action||e.index-t.index}function A(e,t,n,a,i){for(var s in n){var l=n[s],c=a[s];if(s in a&&c===l)"value"===s&&"input"===t&&e.value!=l&&(e.value=l);else{if(a[s]=l,"config"===s||"key"===s)continue;if(r(l)&&"on"===s.slice(0,2))e[s]=_(l,e);else if("style"===s&&null!=l&&o(l)){for(var u in l)null!=c&&c[u]===l[u]||(e.style[u]=l[u]);for(var u in c)u in l||(e.style[u]="")}else null!=i?"href"===s?e.setAttributeNS("http://www.w3.org/1999/xlink","href",l):e.setAttribute("className"===s?"class":s,l):s in e&&"list"!==s&&"style"!==s&&"form"!==s&&"type"!==s&&"width"!==s&&"height"!==s?"input"===t&&e[s]===l||(e[s]=l):e.setAttribute(s,l)}}return a}function x(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(e){}(t=[].concat(t))[n]&&I(t[n])}e.length&&(e.length=0)}function I(e){e.configContext&&r(e.configContext.onunload)&&(e.configContext.onunload(),e.configContext.onunload=null),e.controllers&&b(e.controllers,(function(e){r(e.onunload)&&e.onunload({preventDefault:g})})),e.children&&(u(e.children)?b(e.children,I):e.children.tag&&I(e.children))}var K,B=function(){try{return i.createRange().createContextualFragment("x"),function(e,t){e.appendChild(i.createRange().createContextualFragment(t))}}catch(e){return function(e,t){e.insertAdjacentHTML("beforeend",t)}}}();function q(e,t,n){var r=e.childNodes[t];if(r){var o=1!==r.nodeType,a=i.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else B(e,n);for(var s=[];e.childNodes[t]!==r;)s.push(e.childNodes[t]),t++;return s}function _(e,t){return function(n){n=n||event,m.redraw.strategy("diff"),m.startComputation();try{return e.call(t,n)}finally{re()}}}var L={appendChild:function(e){K===n&&(K=i.createElement("html")),i.documentElement&&i.documentElement!==e?i.replaceChild(e,i.documentElement):i.appendChild(e),this.childNodes=i.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},D=[],j={};function F(e){var t=D.indexOf(e);return t<0?D.push(e)-1:t}m.render=function(e,t,r){var o=[];if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var a=F(e),s=e===i,l=s||e===i.documentElement?L:e;s&&"html"!==t.tag&&(t={tag:"html",attrs:{},children:t}),j[a]===n&&x(l.childNodes),!0===r&&ge(e),j[a]=O(l,null,n,n,t,j[a],!1,0,null,n,o),b(o,(function(e){e()}))},m.trust=function(e){return(e=new String(e)).$trusted=!0,e},m.prop=function(e){return(null!=e&&o(e)||r(e))&&r(e.then)?ve(e):function(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}(e)};var Q,U=[],G=[],$=[],W=null,z=0,Y=null,H=null,J=[];function V(e,t){var n=function(){return(e.controller||g).apply(this,t)||this};e.controller&&(n.prototype=e.controller.prototype);var r=function(n){var r=arguments.length>1?t.concat([].slice.call(arguments,1)):t;return e.view.apply(e,r?[n].concat(r):[n])};r.$original=e.view;var o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o}function X(e,t){U.splice(t,1),$.splice(t,1),G.splice(t,1),ge(e),D.splice(F(e),1)}m.component=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);return V(e,t)},m.mount=m.module=function(e,t){if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var n=U.indexOf(e);n<0&&(n=U.length);var o=!1,a={preventDefault:function(){o=!0,Y=H=null}};b(J,(function(e){e.handler.call(e.controller,a),e.controller.onunload=null})),o?b(J,(function(e){e.controller.onunload=e.handler})):J=[],$[n]&&r($[n].onunload)&&$[n].onunload(a);var i=null===t;if(!o){m.redraw.strategy("all"),m.startComputation(),U[n]=e;var s=Q=t||(t={controller:g}),l=new(t.controller||g);return s===Q&&($[n]=l,G[n]=t),re(),i&&X(e,n),$[n]}i&&X(e,n)};var Z=!1,ee=!1;function te(){Y&&(Y(),Y=null),b(U,(function(e,t){var n=G[t];if($[t]){var r=[$[t]];m.render(e,n.view?n.view($[t],r):"")}})),H&&(H(),H=null),W=null,z=new Date,m.redraw.strategy("diff")}m.redraw=function(e){if(!Z){Z=!0,e&&(ee=!0);try{W&&!e?(l===t.requestAnimationFrame||new Date-z>16)&&(W>0&&c(W),W=l(te,16)):(te(),W=l((function(){W=null}),16))}finally{Z=ee=!1}}},m.redraw.strategy=m.prop();var ne=0;function re(){"none"===m.redraw.strategy()?(ne--,m.redraw.strategy("diff")):m.endComputation()}m.startComputation=function(){ne++},m.endComputation=function(){ne>1?ne--:(ne=0,m.redraw())},m.withAttr=function(e,t,n){return function(r){var o=(r=r||event).currentTarget||this,a=n||this;t.call(a,e in o?o[e]:o.getAttribute(e))}};var oe,ae,ie={pathname:"",hash:"#",search:"?"},se=g,le=!1;function ce(e){return e.slice(ie[m.route.mode].length)}function ue(e,t,n){oe={};var r=n.indexOf("?");-1!==r&&(oe=he(n.substr(r+1,n.length)),n=n.substr(0,r));var o=Object.keys(t),a=o.indexOf(n);if(-1!==a)return m.mount(e,t[o[a]]),!0;for(var i in t){if(i===n)return m.mount(e,t[i]),!0;var s=new RegExp("^"+i.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(s.test(n))return n.replace(s,(function(){var n=i.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2);b(n,(function(e,t){oe[e.replace(/:|\./g,"")]=decodeURIComponent(r[t])})),m.mount(e,t[i])})),!0}}function fe(e){if(!(e=e||event).ctrlKey&&!e.metaKey&&2!==e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;for(var t=e.currentTarget||e.srcElement,n="pathname"===m.route.mode&&t.search?he(t.search.slice(1)):{};t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;m.route(t[m.route.mode].slice(ie[m.route.mode].length),n)}}function pe(){"hash"!==m.route.mode&&s.hash?s.hash=s.hash:t.scrollTo(0,0)}function de(e,t){var r={},a=[];for(var i in e){var s=t?t+"["+i+"]":i,l=e[i];if(null===l)a.push(encodeURIComponent(s));else if(o(l))a.push(de(l,s));else if(u(l)){var c=[];r[s]=r[s]||{},b(l,(function(e){r[s][e]||(r[s][e]=!0,c.push(encodeURIComponent(s)+"="+encodeURIComponent(e)))})),a.push(c.join("&"))}else l!==n&&a.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}return a.join("&")}function he(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));var t=e.split("&"),n={};return b(t,(function(e){var t=e.split("="),r=decodeURIComponent(t[0]),o=2===t.length?decodeURIComponent(t[1]):null;null!=n[r]?(u(n[r])||(n[r]=[n[r]]),n[r].push(o)):n[r]=o})),n}function ge(e){var t=F(e);x(e.childNodes,j[t]),j[t]=n}function ve(e,t){var n=m.prop(t);return e.then(n),n.then=function(n,r){return ve(e.then(n,r),t)},n.catch=n.then.bind(null,null),n.finally=function(e){var r=function(){return m.deferred().resolve(e()).promise};return n.then((function(e){return ve(r().then((function(){return e})),t)}),(function(e){return ve(r().then((function(){throw new Error(e)})),t)}))},n}function me(e,t){var n=this,a=0,i=0,s=[];function l(e){a=e||4,s.map((function(e){3===a?e.resolve(i):e.reject(i)}))}function c(e,t,n,a){if((null!=i&&o(i)||r(i))&&r(e))try{var s=0;e.call(i,(function(e){s++||(i=e,t())}),(function(e){s++||(i=e,n())}))}catch(e){m.deferred.onerror(e),i=e,n()}else a()}function u(){var o;try{o=i&&i.then}catch(e){return m.deferred.onerror(e),i=e,a=2,u()}c(o,(function(){a=1,u()}),(function(){a=2,u()}),(function(){try{1===a&&r(e)?i=e(i):2===a&&r(t)&&(i=t(i),a=1)}catch(e){return m.deferred.onerror(e),i=e,l()}i===n?(i=TypeError(),l()):c(o,(function(){l(3)}),l,(function(){l(1===a&&3)}))}))}n.promise={},n.resolve=function(e){return a||(i=e,a=1,u()),this},n.reject=function(e){return a||(i=e,a=2,u()),this},n.promise.then=function(e,t){var n=new me(e,t);return 3===a?n.resolve(i):4===a?n.reject(i):s.push(n),n.promise}}function be(e){return e}return m.route=function(e,n,r,o){if(0===arguments.length)return ae;if(3===arguments.length&&a(n)){se=function(t){var o=ae=ce(t);if(!ue(e,r,o)){if(le)throw new Error("Ensure the default route matches one of the routes defined in m.route");le=!0,m.route(n,!0),le=!1}};var l="hash"===m.route.mode?"onhashchange":"onpopstate";t[l]=function(){var e=s[m.route.mode];"pathname"===m.route.mode&&(e+=s.search),ae!==ce(e)&&se(e)},Y=pe,t[l]()}else if(e.addEventListener||e.attachEvent)e.href=("pathname"!==m.route.mode?s.pathname:"")+ie[m.route.mode]+o.attrs.href,e.addEventListener?(e.removeEventListener("click",fe),e.addEventListener("click",fe)):(e.detachEvent("onclick",fe),e.attachEvent("onclick",fe));else if(a(e)){var c=ae,u=n||{},f=(ae=e).indexOf("?"),p=f>-1?he(ae.slice(f+1)):{};for(var d in u)p[d]=u[d];var h=de(p),g=f>-1?ae.slice(0,f):ae;h&&(ae=g+(-1===g.indexOf("?")?"?":"&")+h);var v=!0===(3===arguments.length?r:n)||c===e;t.history.pushState?(Y=pe,H=function(){t.history[v?"replaceState":"pushState"](null,i.title,ie[m.route.mode]+ae)},se(ie[m.route.mode]+ae)):(s[m.route.mode]=ae,se(ie[m.route.mode]+ae))}},m.route.param=function(e){if(!oe)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return e?oe[e]:oe},m.route.mode="search",m.route.buildQueryString=de,m.route.parseQueryString=he,m.deferred=function(){var e=new me;return e.promise=ve(e.promise),e},m.deferred.onerror=function(e){if("[object Error]"===f.call(e)&&!e.constructor.toString().match(/ Error/))throw ne=0,e},m.sync=function(e){var t="resolve";function n(e,n){return function(i){return a[e]=i,n||(t="reject"),0==--o&&(r.promise(a),r[t](a)),i}}var r=m.deferred(),o=e.length,a=new Array(o);return e.length>0?b(e,(function(e,t){e.then(n(t,!0),n(t,!1))})):r.resolve([]),r.promise},m.request=function(e){!0!==e.background&&m.startComputation();var o=new me,s=e.dataType&&"jsonp"===e.dataType.toLowerCase(),l=e.serialize=s?be:e.serialize||JSON.stringify,c=e.deserialize=s?be:e.deserialize||JSON.parse,f=s?function(e){return e.responseText}:e.extract||function(e){return 0===e.responseText.length&&c===JSON.parse?null:e.responseText};return e.method=(e.method||"GET").toUpperCase(),e.url=function(e,t){var n=e.match(/:[a-z]\w+/gi);return n&&t&&b(n,(function(n){var r=n.slice(1);e=e.replace(n,t[r]),delete t[r]})),e}(e.url,e.data),(e=function(e,t,n){if("GET"===e.method&&"jsonp"!==e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=de(t);e.url=e.url+(o?r+o:"")}else e.data=n(t);return e}(e,e.data,l)).onload=e.onerror=function(t){try{var n=(("load"===(t=t||event).type?e.unwrapSuccess:e.unwrapError)||be)(c(f(t.target,e)),t.target);"load"===t.type&&(u(n)&&e.type?b(n,(function(t,r){n[r]=new e.type(t)})):e.type&&(n=new e.type(n))),o["load"===t.type?"resolve":"reject"](n)}catch(t){m.deferred.onerror(t),o.reject(t)}!0!==e.background&&m.endComputation()},function(e){if(!e.dataType||"jsonp"!==e.dataType.toLowerCase()){var o=new t.XMLHttpRequest;if(o.open(e.method,e.url,!0,e.user,e.password),o.onreadystatechange=function(){4===o.readyState&&(o.status>=200&&o.status<300?e.onload({type:"load",target:o}):e.onerror({type:"error",target:o}))},e.serialize===JSON.stringify&&e.data&&"GET"!==e.method&&o.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.deserialize===JSON.parse&&o.setRequestHeader("Accept","application/json, text/*"),r(e.config)){var s=e.config(o,e);null!=s&&(o=s)}var l="GET"!==e.method&&e.data?e.data:"";if(l&&!a(l)&&l.constructor!==t.FormData)throw new Error("Request data should be either be a string or FormData. Check the `serialize` option in `m.request`");return o.send(l),o}var c="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),u=i.createElement("script");t[c]=function(r){u.parentNode.removeChild(u),e.onload({type:"load",target:{responseText:r}}),t[c]=n},u.onerror=function(){return u.parentNode.removeChild(u),e.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),t[c]=n,!1},u.onload=function(){return!1},u.src=e.url+(e.url.indexOf("?")>0?"&":"?")+(e.callbackKey?e.callbackKey:"callback")+"="+c+"&"+de(e.data||{}),i.body.appendChild(u)}(e),o.promise=ve(o.promise,e.initialValue),o.promise},m.deps=function(e){return v(t=e||t),t},m.deps.factory=e,m}("undefined"!=typeof window?window:{});null!=e&&e.exports&&(e.exports=t)})),xe="abcdefgh".split(""),Ie=[1,2,3,4,5,6,7,8],Ke=[8,7,6,5,4,3,2,1],Be={a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8};function qe(e){return xe[e[0]-1]+e[1]}var _e,Le,De=(_e=[],Ke.forEach((function(e){Ie.forEach((function(t){_e.push([t,e])}))})),_e),je=De.map(qe),Fe=je.slice(0).reverse();var Qe=null;function Ue(e,t){return e.bind.apply(e,[null].concat(t))}var Ge={files:xe,ranks:Ie,invRanks:Ke,allPos:De,allKeys:je,invKeys:Fe,pos2key:qe,key2pos:function(e){return[Be[e[0]],parseInt(e[1])]},invertKey:function(e){return xe[8-Be[e[0]]]+(9-parseInt(e[1]))},opposite:function(e){return"white"===e?"black":"white"},translate:function(e){return"translate("+e[0]+"px,"+e[1]+"px)"},containsX:function(e,t){return e&&-1!==e.indexOf(t)},distance:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},eventPosition:function(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},partialApply:Ue,partial:function(){return Ue(arguments[0],Array.prototype.slice.call(arguments,1))},transformProp:function(){return Le||(Le="transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"),Le},isTrident:function(){return null===Qe&&(Qe=window.navigator.userAgent.indexOf("Trident/")>-1),Qe},requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),isRightButton:function(e){return 2===e.buttons||2===e.button},memo:function(e){var t,n=function(){return void 0===t&&(t=e()),t};return n.clear=function(){t=void 0},n}};function $e(e,t){return Math.abs(e-t)}function We(e,t,n,r,o){return $e(t,r)<2&&("white"===e?o===n+1||n<=2&&o===n+2&&t===r:o===n-1||n>=7&&o===n-2&&t===r)}function ze(e,t,n,r){var o=$e(e,n),a=$e(t,r);return 1===o&&2===a||2===o&&1===a}function Ye(e,t,n,r){return $e(e,n)===$e(t,r)}function He(e,t,n,r){return e===n||t===r}function Je(e,t,n,r){return Ye(e,t,n,r)||He(e,t,n,r)}function Ve(e,t,n,r,o,a,i){return $e(r,a)<2&&$e(o,i)<2||n&&o===i&&o===("white"===e?1:8)&&(5===r&&(3===a||7===a)||Ge.containsX(t,a))}var Xe=function(e,t,n){var r,o=e[t],a=Ge.key2pos(t);switch(o.role){case"pawn":r=We.bind(null,o.color);break;case"knight":r=ze;break;case"bishop":r=Ye;break;case"rook":r=He;break;case"queen":r=Je;break;case"king":r=Ve.bind(null,o.color,function(e,t){return Object.keys(e).filter((function(n){var r=e[n];return r&&r.color===t&&"rook"===r.role})).map((function(e){return Ge.key2pos(e)[0]}))}(e,o.color),n)}return Ge.allPos.filter((function(e){return(a[0]!==e[0]||a[1]!==e[1])&&r(a[0],a[1],e[0],e[1])})).map(Ge.pos2key)},Ze=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1};function et(e,t,n){var r=n?Ge.invertKey(e):e;return{key:r,pos:Ge.key2pos(r),role:t.role,color:t.color}}function tt(e,t){return e.role===t.role&&e.color===t.color}function nt(e,t){var n=t.bounds(),r=n.width/8,o=n.height/8,a={},i=[],s=[],l=[],c=[],u=e.orientation!==t.orientation,f={},p="white"===t.orientation;for(var d in e.pieces){var h=et(d,e.pieces[d],u);f[h.key]=h}for(var g=0;g<Ge.allKeys.length;g++){var v=Ge.allKeys[g];if(v!==t.movable.dropped[1]){var m=t.pieces[v],b=f[v];m?b?tt(m,b)||(l.push(b),c.push(et(v,m,!1))):c.push(et(v,m,!1)):b&&l.push(b)}}return c.forEach((function(e){var t=function(e,t){return t.sort((function(t,n){return Ge.distance(e.pos,t.pos)-Ge.distance(e.pos,n.pos)}))[0]}(e,l.filter(Ge.partial(tt,e)));if(t){var n=p?t.pos:e.pos,s=p?e.pos:t.pos,c=[(n[0]-s[0])*r,(s[1]-n[1])*o];a[e.key]=[c,c],i.push(t.key)}})),l.forEach((function(e){e.key===t.movable.dropped[0]||Ge.containsX(i,e.key)||t.items&&t.items.render(e.pos,e.key)||s.push({piece:e,opacity:1})})),{anims:a,fadings:s}}function rt(e,t){return Math.round(e*t)/t}function ot(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(t<=0)e.animation.current={},e.render();else{var n=Ze(t);for(var r in e.animation.current.anims){var o=e.animation.current.anims[r];o[1]=[rt(o[0][0]*n,10),rt(o[0][1]*n,10)]}for(var a in e.animation.current.fadings)e.animation.current.fadings[a].opacity=rt(n,100);e.render(),Ge.requestAnimationFrame((function(){ot(e)}))}}}function at(e,t){var n={orientation:t.orientation,pieces:{}};for(var r in t.pieces)n.pieces[r]={role:t.pieces[r].role,color:t.pieces[r].color};var o=e();if(t.animation.enabled){var a=nt(n,t);if(Object.keys(a.anims).length>0||a.fadings.length>0){var i=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:a.anims,fadings:a.fadings},i||ot(t)}else t.renderRAF()}else t.renderRAF();return o}var it,st=function(e,t,n){return function(){var r=[t].concat(Array.prototype.slice.call(arguments,0));if(t.render){if(t.animation.enabled&&!n)return at(Ge.partialApply(e,r),t);var o=e.apply(null,r);return t.renderRAF(),o}return e.apply(null,r)}},lt=function(){it=new Date},ct=function(){it=null},ut=function(){if(!it)return 0;var e=new Date-it;return it=null,e};function ft(e){setTimeout(e,1)}function pt(e){e.premovable.current&&(e.premovable.current=null,ft(e.premovable.events.unset))}function dt(e){e.predroppable.current.key&&(e.predroppable.current={},ft(e.predroppable.events.unset))}function ht(e,t,n){var r=st((function(){if(t===n||!e.pieces[t])return!1;var r=e.pieces[n]&&e.pieces[n].color!==e.pieces[t].color?e.pieces[n]:null;return ft(Ge.partial(e.events.move,t,n,r)),e.pieces[n]=e.pieces[t],delete e.pieces[t],e.lastMove=[t,n],e.check=null,function(e,t,n){if(e.autoCastle){var r=e.pieces[n];if("king"===r.role){var o=Ge.key2pos(t);if(5===o[0]&&(1===o[1]||8===o[1])){var a,i,s,l=Ge.key2pos(n);if(7===l[0]||8===l[0])a=Ge.pos2key([8,o[1]]),i=Ge.pos2key([6,o[1]]),s=Ge.pos2key([7,o[1]]);else{if(3!==l[0]&&1!==l[0])return;a=Ge.pos2key([1,o[1]]),i=Ge.pos2key([4,o[1]]),s=Ge.pos2key([3,o[1]])}delete e.pieces[t],delete e.pieces[n],delete e.pieces[a],e.pieces[s]={role:"king",color:r.color},e.pieces[i]={role:"rook",color:r.color}}}}}(e,t,n),ft(e.events.change),!0}),e)();return r&&(e.movable.dropped=[]),r}function gt(e,t,n){return!e.pieces[n]&&(ft(Ge.partial(e.events.dropNewPiece,t,n)),e.pieces[n]=t,e.lastMove=[n,n],e.check=null,ft(e.events.change),e.movable.dropped=[],e.movable.dests={},e.turnColor=Ge.opposite(e.turnColor),e.renderRAF(),!0)}function vt(e,t,n){var r=ht(e,t,n);return r&&(e.movable.dests={},e.turnColor=Ge.opposite(e.turnColor)),r}function mt(e,t,n){if(n)if(kt(e,t,n)){if(vt(e,t,n)){var r=ut();return wt(e,null),ft(Ge.partial(e.movable.events.after,t,n,{premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:r})),!0}}else!function(e,t,n){return t!==n&&Pt(e,t)&&Ge.containsX(Xe(e.pieces,t,e.premovable.castle),n)}(e,t,n)?yt(e,n)||Pt(e,n)?(wt(e,n),lt()):wt(e,null):(!function(e,t,n,r){dt(e),e.premovable.current=[t,n],ft(Ge.partial(e.premovable.events.set,t,n,r))}(e,t,n,{ctrlKey:e.stats.ctrlKey}),wt(e,null));else ct(),wt(e,null),"trash"===e.movable.dropOff&&(delete e.pieces[t],ft(e.events.change))}function bt(e,t,n){e.selected?t&&(e.selected!==t||e.draggable.enabled)?(e.selectable.enabled||n)&&e.selected!==t?mt(e,e.selected,t)&&(e.stats.dragged=!1):lt():(wt(e,null),ct()):(yt(e,t)||Pt(e,t))&&(wt(e,t),lt()),t&&ft(Ge.partial(e.events.select,t))}function wt(e,t){e.selected=t,t&&Pt(e,t)?e.premovable.dests=Xe(e.pieces,t,e.premovable.castle):e.premovable.dests=null}function yt(e,t){var n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function kt(e,t,n){return t!==n&&yt(e,t)&&(e.movable.free||Ge.containsX(e.movable.dests[t],n))}function Pt(e,t){var n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function Ct(e){pt(e),dt(e),bt(e,null)}var Et={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0};var St={reset:function(e){e.lastMove=null,wt(e,null),pt(e),dt(e)},toggleOrientation:function(e){e.orientation=Ge.opposite(e.orientation)},setPieces:function(e,t){Object.keys(t).forEach((function(n){t[n]?e.pieces[n]=t[n]:delete e.pieces[n]})),e.movable.dropped=[]},setCheck:function(e,t){var n=t||e.turnColor;Object.keys(e.pieces).forEach((function(t){e.pieces[t].color===n&&"king"===e.pieces[t].role&&(e.check=t)}))},selectSquare:bt,setSelected:wt,isDraggable:function(e,t){var n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))},canMove:kt,userMove:mt,dropNewPiece:function(e,t,n){if(function(e,t,n){var r=e.pieces[t];return r&&n&&(t===n||!e.pieces[n])&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}(e,t,n)){var r=e.pieces[t];delete e.pieces[t],gt(e,r,n),e.movable.dropped=[],ft(Ge.partial(e.movable.events.afterNewPiece,r.role,n,{predrop:!1}))}else!function(e,t,n){var r=e.pieces[t];return r&&n&&(!e.pieces[n]||e.pieces[n].color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===r.color&&e.turnColor!==r.color}(e,t,n)?(pt(e),dt(e)):function(e,t,n){pt(e),e.predroppable.current={role:t,key:n},ft(Ge.partial(e.predroppable.events.set,t,n))}(e,e.pieces[t].role,n);delete e.pieces[t],wt(e,null)},apiMove:function(e,t,n){return ht(e,t,n)},apiNewPiece:function(e,t,n){return gt(e,t,n)},playPremove:function(e){var t=e.premovable.current;if(t){var n=t[0],r=t[1],o=!1;return kt(e,n,r)&&vt(e,n,r)&&(ft(Ge.partial(e.movable.events.after,n,r,{premove:!0})),o=!0),pt(e),o}},playPredrop:function(e,t){var n=e.predroppable.current,r=!1;if(n.key){if(t(n))gt(e,{role:n.role,color:e.movable.color},n.key)&&(ft(Ge.partial(e.movable.events.afterNewPiece,n.role,n.key,{predrop:!0})),r=!0);return dt(e),r}},unsetPremove:pt,unsetPredrop:dt,cancelMove:Ct,stop:function(e){e.movable.color=null,e.movable.dests={},Ct(e)},getKeyAtDomPos:function(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.ceil((t[0]-n.left)/n.width*8);r="white"===e.orientation?r:9-r;var o=Math.ceil(8-(t[1]-n.top)/n.height*8);return o="white"===e.orientation?o:9-o,r>0&&r<9&&o>0&&o<9?Ge.pos2key([r,o]):void 0}},getMaterialDiff:function(e){var t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var n in e.pieces){var r=e.pieces[n];t[r.role]+="white"===r.color?1:-1}var o={white:{},black:{}};for(var a in t){var i=t[a];i>0?o.white[a]=i:i<0&&(o.black[a]=-i)}return o},getScore:function(e){var t=0;for(var n in e.pieces)t+=Et[e.pieces[n].role]*("white"===e.pieces[n].color?1:-1);return t}},Tt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Mt={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Nt={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};var Ot={initial:Tt,read:function(e){"start"===e&&(e=Tt);var t={};return e.replace(/ .+$/,"").replace(/~/g,"").split("/").forEach((function(e,n){var r=0;e.split("").forEach((function(e){var o=parseInt(e);o?r+=o:(r++,t[Ge.pos2key([r,8-n])]={role:Mt[e.toLowerCase()],color:e===e.toLowerCase()?"black":"white"})}))})),t},write:function(e){return[8,7,6,5,4,3,2].reduce((function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),t)}),Ge.invRanks.map((function(t){return Ge.ranks.map((function(n){var r=e[Ge.pos2key([n,t])];if(r){var o=Nt[r.role];return"white"===r.color?o.toUpperCase():o}return"1"})).join("")})).join("/"))}},Rt=e((function(e){!function(t){var n=function(e){return o(!0===e,!1,arguments)};function r(e,t){if("object"!==a(e))return t;for(var n in t)"object"===a(e[n])&&"object"===a(t[n])?e[n]=r(e[n],t[n]):e[n]=t[n];return e}function o(e,t,o){var i=o[0],s=o.length;(e||"object"!==a(i))&&(i={});for(var l=0;l<s;++l){var c=o[l];if("object"===a(c))for(var u in c){var f=e?n.clone(c[u]):c[u];i[u]=t?r(i[u],f):f}}return i}function a(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}n.recursive=function(e){return o(!0===e,!0,arguments)},n.clone=function(e){var t,r,o=e,i=a(e);if("array"===i)for(o=[],r=e.length,t=0;t<r;++t)o[t]=n.clone(e[t]);else if("object"===i)for(t in o={},e)o[t]=n.clone(e[t]);return o},t?e.exports=n:window.merge=n}(e&&e.exports)})),At=function(e,t){if(t&&(t.movable&&t.movable.dests&&delete e.movable.dests,Rt.recursive(e,t),e.fen&&(e.pieces=Ot.read(e.fen),e.check=t.check,e.drawable.shapes=[],delete e.fen),!0===e.check&&St.setCheck(e),e.movable.dropped=[],e.selected&&St.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<40)&&(e.animation.enabled=!1),!e.movable.rookCastle)){var n="white"===e.movable.color?1:8,r="e"+n;if(e.movable.dests){var o=e.movable.dests[r];if(!o||"king"!==e.pieces[r].role)return;e.movable.dests[r]=o.filter((function(e){return(e!=="a"+n||-1===o.indexOf("c"+n))&&(e!=="h"+n||-1===o.indexOf("g"+n))}))}}},xt=["green","red","blue","yellow"];function It(e){Ge.requestAnimationFrame((function(){var t=e.drawable.current;if(t.orig){var n=St.getKeyAtDomPos(e,t.epos,t.bounds);t.orig===n?t.dest=void 0:t.dest=n}e.render(),t.orig&&It(e)}))}function Kt(e){return function(t){return!e(t)}}function Bt(e){e.onChange(e.shapes)}var qt,_t={start:function(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),St.cancelMove(e);var n=Ge.eventPosition(t),r=e.bounds(),o=St.getKeyAtDomPos(e,n,r);e.drawable.current={orig:o,epos:n,bounds:r,brush:xt[(t.shiftKey&Ge.isRightButton(t))+(t.altKey?2:0)]},It(e)}},move:function(e,t){e.drawable.current.orig&&(e.drawable.current.epos=Ge.eventPosition(t))},end:function(e,t){var n=e.drawable,r=n.current.orig,o=n.current.dest;r&&o?function(e,t,n){var r=e.current.brush,o=function(e){return e.orig&&e.dest&&(e.orig===t&&e.dest===n||e.dest===t&&e.orig===n)};e.shapes.filter(o).length>0?e.shapes=e.shapes.filter(Kt(o)):e.shapes.push({brush:r,orig:t,dest:n});Bt(e)}(n,r,o):r&&function(e,t){var n=e.current.brush,r=function(e){return e.orig===t&&!e.dest},o=e.shapes.filter(r)[0];o&&(e.shapes=e.shapes.filter(Kt(r)));o&&o.brush===n||e.shapes.push({brush:n,orig:t});Bt(e)}(n,r),n.current={},e.render()},cancel:function(e){e.drawable.current.orig&&(e.drawable.current={})},clear:function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.render(),Bt(e.drawable))},processDraw:It};function Lt(e){return e?e.color+e.role:""}function Dt(e){Ge.requestAnimationFrame((function(){var t=e.draggable.current;t.orig&&(e.animation.current.start&&e.animation.current.anims[t.orig]&&(e.animation.current={}),Lt(e.pieces[t.orig])!==t.piece?jt(e):(!t.started&&Ge.distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=St.getKeyAtDomPos(e,t.epos,t.bounds)))),e.render(),t.orig&&Dt(e)}))}function jt(e){e.draggable.current.orig&&(e.draggable.current={},St.selectSquare(e,null))}var Ft={start:function(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),qt=t.target;var n=e.selected,r=Ge.eventPosition(t),o=e.bounds(),a=St.getKeyAtDomPos(e,r,o),i=e.pieces[a];if(n||!e.drawable.eraseOnClick&&i&&i.color===e.turnColor||_t.clear(e),!e.viewOnly){var s=!!e.premovable.current,l=!!e.predroppable.current.key;e.stats.ctrlKey=t.ctrlKey,St.selectSquare(e,a);var c=e.selected===a;if(i&&c&&St.isDraggable(e,a)){var u=function(e,t,n){var r=Ge.key2pos(n);return"white"!==e.orientation&&(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}(e,o,a);e.draggable.current={previouslySelected:n,orig:a,piece:Lt(i),rel:r,epos:r,pos:[0,0],dec:e.draggable.centerPiece?[r[0]-(u.left+u.width/2),r[1]-(u.top+u.height/2)]:[0,0],bounds:o,started:e.draggable.autoDistance&&e.stats.dragged}}else s&&St.unsetPremove(e),l&&St.unsetPredrop(e);Dt(e)}}},move:function(e,t){t.touches&&t.touches.length>1||e.draggable.current.orig&&(e.draggable.current.epos=Ge.eventPosition(t))},end:function(e,t){var n=e.draggable.current,r=n?n.orig:null;if(r)if("touchend"!==t.type||qt===t.target||n.newPiece){St.unsetPremove(e),St.unsetPredrop(e);var o=Ge.eventPosition(t),a=o?St.getKeyAtDomPos(e,o,n.bounds):n.over;n.started&&(n.newPiece?St.dropNewPiece(e,r,a):(r!==a&&(e.movable.dropped=[r,a]),e.stats.ctrlKey=t.ctrlKey,St.userMove(e,r,a)&&(e.stats.dragged=!0))),(r!==n.previouslySelected||r!==a&&a)&&e.selectable.enabled||St.setSelected(e,null),e.draggable.current={}}else e.draggable.current={}},cancel:jt,processDrag:Dt},Qt=function(e){this.data=function(e){var t={pieces:Ot.read(Ot.initial),orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,render:null,renderRAF:null,element:null,bounds:null,autoCastle:!1,viewOnly:!1,disableContextMenu:!1,resizable:!0,pieceKey:!1,highlight:{lastMove:!0,check:!0,dragOver:!0},animation:{enabled:!0,duration:200,current:{}},movable:{free:!0,color:"both",dests:{},dropOff:"revert",dropped:[],showDests:!0,events:{after:function(e,t,n){},afterNewPiece:function(e,t){}},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,dests:[],current:null,events:{set:function(e,t){},unset:function(){}}},predroppable:{enabled:!1,current:{},events:{set:function(e,t){},unset:function(){}}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,current:{}},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{change:function(){},move:function(e,t,n){},dropNewPiece:function(e,t){},capture:function(e,t){},select:function(e){}},items:null,drawable:{enabled:!1,eraseOnClick:!0,onChange:function(e){},shapes:[],autoShapes:[],current:{},brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"}}};return At(t,e||{}),t}(e),this.vm={exploding:!1},this.getFen=function(){return Ot.write(this.data.pieces)}.bind(this),this.getOrientation=function(){return this.data.orientation}.bind(this),this.set=st(At,this.data),this.toggleOrientation=function(){st(St.toggleOrientation,this.data)(),this.data.redrawCoords&&this.data.redrawCoords(this.data.orientation)}.bind(this),this.setPieces=st(St.setPieces,this.data),this.selectSquare=st(St.selectSquare,this.data,!0),this.apiMove=st(St.apiMove,this.data),this.apiNewPiece=st(St.apiNewPiece,this.data),this.playPremove=st(St.playPremove,this.data),this.playPredrop=st(St.playPredrop,this.data),this.cancelPremove=st(St.unsetPremove,this.data,!0),this.cancelPredrop=st(St.unsetPredrop,this.data,!0),this.setCheck=st(St.setCheck,this.data,!0),this.cancelMove=st(function(e){St.cancelMove(e),Ft.cancel(e)}.bind(this),this.data,!0),this.stop=st(function(e){St.stop(e),Ft.cancel(e)}.bind(this),this.data,!0),this.explode=function(e){this.data.render&&(this.vm.exploding={stage:1,keys:e},this.data.renderRAF(),setTimeout(function(){this.vm.exploding.stage=2,this.data.renderRAF(),setTimeout(function(){this.vm.exploding=!1,this.data.renderRAF()}.bind(this),120)}.bind(this),120))}.bind(this),this.setAutoShapes=function(e){st((function(t){t.drawable.autoShapes=e}),this.data,!1)()}.bind(this),this.setShapes=function(e){st((function(t){t.drawable.shapes=e}),this.data,!1)()}.bind(this)},Ut=Ge.key2pos,Gt=Ge.isTrident;function $t(e,t,n){return(e.lineWidth||10)*(t?.85:1)/512*n.width}function Wt(e,t){return(e.opacity||1)*(t?.9:1)}function zt(e,t){var n=t.width/8;return[(e[0]-.5)*n,(8.5-e[1])*n]}function Yt(e,t,n,r,o){var a=function(e,t){return Gt()?0:(e?10:20)/512*t.width}(r,o),i=zt(t,o),s=zt(n,o),l=s[0]-i[0],c=s[1]-i[1],u=Math.atan2(c,l),f=Math.cos(u)*a,p=Math.sin(u)*a;return{tag:"line",attrs:{stroke:e.color,"stroke-width":$t(e,r,o),"stroke-linecap":"round","marker-end":Gt()?null:"url(#arrowhead-"+e.key+")",opacity:Wt(e,r),x1:i[0],y1:i[1],x2:s[0]-f,y2:s[1]-p}}}function Ht(e){return{tag:"defs",children:[e.map((function(e){return{tag:"marker",attrs:{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01},children:[{tag:"path",attrs:{d:"M0,0 V4 L3,2 Z",fill:e.color}}]}}))]}}function Jt(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function Vt(e,t,n){return function(r,o){if(r.piece)return function(e,t,n,r){var o=zt(t,r),a=r.width/8*(n.scale||1),i="white"===n.color?"w":"b";i+=("knight"===n.role?"n":n.role[0]).toUpperCase();var s=e.baseUrl+i+".svg";return{tag:"image",attrs:{class:n.color+" "+n.role,x:o[0]-a/2,y:o[1]-a/2,width:a,height:a,href:s}}}(e.drawable.pieces,Jt(Ut(r.orig),e.orientation),r.piece,n);if(r.brush){var a=r.brushModifiers?Xt(e.drawable.brushes[r.brush],r.brushModifiers,o):e.drawable.brushes[r.brush],i=Jt(Ut(r.orig),e.orientation);if(r.orig&&r.dest)return Yt(a,i,Jt(Ut(r.dest),e.orientation),t,n);if(r.orig)return function(e,t,n,r){var o=zt(t,r),a=function(e,t){return(e?3:4)/512*t.width}(n,r),i=r.width/16;return{tag:"circle",attrs:{stroke:e.color,"stroke-width":a,fill:"none",opacity:Wt(e,n),cx:o[0],cy:o[1],r:i-a/2}}}(a,i,t,n)}}}function Xt(e,t,n){return{key:"cb_"+n,color:t.color||e.color,opacity:t.opacity||e.opacity,lineWidth:t.lineWidth||e.lineWidth}}var Zt=function(e){if(e.data.bounds){var t=e.data.drawable,n=t.shapes.concat(t.autoShapes);if(n.length||t.current.orig){var r=e.data.bounds();if(r.width===r.height){var o=function(e,t,n){var r=[],o=[],a=n&&n.dest?t.concat(n):t;for(var i in a){var s=a[i];if(s.dest){var l=s.brush;s.brushModifiers?r.push(Xt(e.brushes[l],s.brushModifiers,i)):-1===o.indexOf(l)&&(r.push(e.brushes[l]),o.push(l))}}return r}(t,n,t.current),a=n.map(Vt(e.data,!1,r)),i=Vt(e.data,!0,r)(t.current,9999);return i&&a.push(i),{tag:"svg",attrs:{key:"svg"},children:[Ht(o),a]}}}}};function en(e,t,n){var r=document.createElement("coords");return r.className=t,e.forEach((function(e){var t=document.createElement("coord");t.textContent=e,r.appendChild(t)})),r}var tn="piece";function nn(e){return e.role+" "+e.color}function rn(e,t,n){var r={key:"p"+t,style:{},class:nn(e.pieces[t])},o=an(Ge.key2pos(t),n),a=e.draggable.current;if(a.orig===t&&a.started)o[0]+=a.pos[0]+a.dec[0],o[1]+=a.pos[1]+a.dec[1],r.class+=" dragging";else if(e.animation.current.anims){var i=e.animation.current.anims[t];i&&(o[0]+=i[1][0],o[1]+=i[1][1])}return r.style[n.transformProp]=Ge.translate(o),e.pieceKey&&(r["data-key"]=t),{tag:tn,attrs:r}}function on(e,t,n){var r={key:"s"+e,class:t,style:{}};return r.style[n.transformProp]=Ge.translate(an(Ge.key2pos(e),n)),{tag:"square",attrs:r}}function an(e,t){return[(t.asWhite?e[0]-1:8-e[0])*t.bounds.width/8,(t.asWhite?8-e[1]:e[1]-1)*t.bounds.height/8]}function sn(e,t,n){e[t]?e[t].push(n):e[t]=[n]}function ln(e){var t=e.data;if(t.bounds){var n={asWhite:"white"===t.orientation,bounds:t.bounds(),transformProp:Ge.transformProp()},r=function(e,t){var n=e.data,r={};if(n.lastMove&&n.highlight.lastMove&&n.lastMove.forEach((function(e){sn(r,e,"last-move")})),n.check&&n.highlight.check&&sn(r,n.check,"check"),n.selected){sn(r,n.selected,"selected");var o=n.draggable.current.over,a=n.movable.dests[n.selected];a&&a.forEach((function(e){e===o?sn(r,e,"move-dest drag-over"):n.movable.showDests&&sn(r,e,"move-dest"+(n.pieces[e]?" oc":""))}));var i=n.premovable.dests;i&&i.forEach((function(e){e===o?sn(r,e,"premove-dest drag-over"):n.movable.showDests&&sn(r,e,"premove-dest"+(n.pieces[e]?" oc":""))}))}var s=n.premovable.current;s?s.forEach((function(e){sn(r,e,"current-premove")})):n.predroppable.current.key&&sn(r,n.predroppable.current.key,"current-premove"),e.vm.exploding&&e.vm.exploding.keys.forEach((function(t){sn(r,t,"exploding"+e.vm.exploding.stage)}));var l=[];if(n.items)for(var c=0;c<64;c++){var u=Ge.allKeys[c],f=r[u],p=n.items.render(Ge.key2pos(u),u);if(f||p){var d=on(u,f?f.join(" ")+(p?" has-item":""):"has-item",t);p&&(d.children=[p]),l.push(d)}}else for(var u in r)l.push(on(u,r[u].join(" "),t));return l}(e,n);t.animation.current.fadings&&t.animation.current.fadings.forEach((function(e){r.push(function(e,t){var n={key:"f"+e.piece.key,class:"fading "+nn(e.piece),style:{opacity:e.opacity}};return n.style[t.transformProp]=Ge.translate(an(e.piece.pos,t)),{tag:tn,attrs:n}}(e,n))}));var o=n.asWhite?Ge.allKeys:Ge.invKeys;if(t.items)for(var a=0;a<64;a++)t.pieces[o[a]]&&!t.items.render(Ge.key2pos(o[a]),o[a])&&r.push(rn(t,o[a],n));else{for(a=0;a<64;a++)t.pieces[o[a]]&&r.push(rn(t,o[a],n));t.draggable.current&&t.draggable.current.newPiece&&r.push(rn(t,"a0",n))}if(t.draggable.showGhost){var i=t.draggable.current.orig;i&&!t.draggable.current.newPiece&&r.push(function(e,t,n){if(t){var r={key:"g"+e,style:{},class:nn(t)+" ghost"};return r.style[n.transformProp]=Ge.translate(an(Ge.key2pos(e),n)),{tag:tn,attrs:r}}}(i,t.pieces[i],n))}return t.drawable.enabled&&r.push(Zt(e)),r}}function cn(e,t,n){return function(r){(r.shiftKey||Ge.isRightButton(r))&&e.drawable.enabled?n(e,r):e.viewOnly||t(e,r)}}function un(e,t,n){var r=e.data,o=function(e){return function(t){Ge.isRightButton(t)&&e.draggable.current.orig?(e.draggable.current.newPiece&&delete e.pieces[e.draggable.current.orig],e.draggable.current={},e.selected=null):(t.shiftKey||Ge.isRightButton(t))&&e.drawable.enabled?_t.start(e,t):Ft.start(e,t)}}(r),a=cn(r,Ft.move,_t.move),i=cn(r,Ft.end,_t.end),s=["touchstart","mousedown"],l=["touchmove","mousemove"],c=["touchend","mouseup"];s.forEach((function(e){t.addEventListener(e,o)})),l.forEach((function(e){document.addEventListener(e,a)})),c.forEach((function(e){document.addEventListener(e,i)})),n.onunload=function(){s.forEach((function(e){t.removeEventListener(e,o)})),l.forEach((function(e){document.removeEventListener(e,a)})),c.forEach((function(e){document.removeEventListener(e,i)}))}}function fn(e){var t=e.data;return{tag:"cg-board",attrs:{config:function(n,r,o){r||(t.viewOnly&&!t.drawable.enabled||un(e,n,o),t.render=function(){Ae.render(n,ln(e))},t.renderRAF=function(){Ge.requestAnimationFrame(t.render)},t.bounds=Ge.memo(n.getBoundingClientRect.bind(n)),t.element=n,t.render())}},children:[]}}var pn=function(e){var t=e.data;return{tag:"div",attrs:{config:function(e,n){n?t.redrawCoords&&t.redrawCoords(t.orientation):(t.coordinates&&(t.redrawCoords=function(e,t){return Ge.requestAnimationFrame((function(){var n=document.createDocumentFragment(),r="black"===e?" black":"";n.appendChild(en(Ge.ranks,"ranks"+r)),n.appendChild(en(Ge.files,"files"+r)),t.appendChild(n)})),function(n){if(n!==e){e=n;var r=t.querySelectorAll("coords");for(i=0;i<r.length;++i)r[i].classList.toggle("black","black"===n)}}}(t.orientation,e)),e.addEventListener("contextmenu",(function(e){if(t.disableContextMenu||t.drawable.enabled)return e.preventDefault(),!1})),t.stats.boundWindowEvents||(t.stats.boundWindowEvents=1,t.resizable&&document.body.addEventListener("chessground.resize",(function(e){t.bounds.clear(),t.render()}),!1),["onscroll","onresize"].forEach((function(e){var n=window[e];window[e]=function(){n&&n(),t.bounds.clear()}}))))},class:["cg-wrap","orientation-"+t.orientation,t.viewOnly?"view-only":"manipulable"].join(" ")},children:[{tag:"cg-helper",children:[{tag:"cg-container",children:[fn(e)]}]}]}};var dn=function(e,t){var n=new Qt(t);return Ae.render(e,pn(n)),function(e){return{set:e.set,toggleOrientation:e.toggleOrientation,getOrientation:e.getOrientation,getPieces:function(){return e.data.pieces},getMaterialDiff:function(){return St.getMaterialDiff(e.data)},getFen:e.getFen,move:e.apiMove,newPiece:e.apiNewPiece,setPieces:e.setPieces,setCheck:e.setCheck,playPremove:e.playPremove,playPredrop:e.playPredrop,cancelPremove:e.cancelPremove,cancelPredrop:e.cancelPredrop,cancelMove:e.cancelMove,stop:e.stop,explode:e.explode,setAutoShapes:e.setAutoShapes,setShapes:e.setShapes,data:e.data}}(n)},hn=Qt,gn=pn,vn=Ot,mn=Ge,bn=At,wn=st,yn=St,kn=Ft;dn.controller=hn,dn.view=gn,dn.fen=vn,dn.util=mn,dn.configure=bn,dn.anim=wn,dn.board=yn,dn.drag=kn;var Pn=dn.util.requestAnimationFrame,Cn=new dn.controller,En={instance:Cn,set:function(e){var t=e.chess.instance.in_check();return Cn.set({fen:e.chess.fen(),lastMove:null,selected:null,orientation:e.orientation,coordinates:!0,pieceKey:!0,turnColor:e.chess.color(),check:t,autoCastle:e.autoCastle,movable:{free:!1,color:e.chess.color(),dests:e.chess.dests({illegal:e.offerIllegalMove})},events:{move:e.onMove},items:e.items,premovable:{enabled:!0},drawable:{enabled:!0,eraseOnClick:!0},highlight:{lastMove:!0,dragOver:!0},animation:{enabled:!1,duration:200},disableContextMenu:!0}),setTimeout((function(){Cn.set({animation:{enabled:!0}})}),200),e.shapes&&Cn.setShapes(e.shapes.slice(0)),Cn},stop:Cn.stop,color:function(e,t){Cn.set({turnColor:e,movable:{color:e,dests:t}})},fen:function(e,t,n,r){var o={turnColor:t,fen:e,movable:{color:t,dests:n}};r&&(o.lastMove=r),Cn.set(o)},check:function(e){var t=e.checks();Cn.set({check:t?t[0].dest:null}),t&&Cn.setShapes(t.map((function(e){return r.arrow(e.orig+e.dest,"yellow")})))},promote:function(e,t){var n={},r=Cn.data.pieces[e];r&&"pawn"===r.role&&(n[e]={color:r.color,role:t,promoted:!0},Cn.setPieces(n))},data:function(){return Cn.data},pieces:function(){return Cn.data.pieces},get:function(e){return Cn.data.pieces[e]},showCapture:function(e){Pn((function(){var t=$("#learn-app piece[data-key="+e.orig+"]");t.addClass("wriggle"),Te.setTimeout((function(){t.removeClass("wriggle"),Cn.setShapes([]),Cn.apiMove(e.orig,e.dest)}),600)}))},showCheckmate:function(e){var t="w"===e.instance.turn()?"b":"w",n=[Cn.getFen(),t,"- - 0 1"].join(" ");e.instance.load(n);var o=e.kingKey("w"===t?"black":"white"),a=e.instance.moves({verbose:!0}).filter((function(e){return e.to===o})).map((function(e){return r.arrow(e.from+e.to,"red")}));Cn.set({check:a.length?o:null}),Cn.setShapes(a)},setShapes:function(e){Cn.setShapes(e)},resetShapes:function(){Cn.setShapes([])},select:Cn.selectSquare},Sn=e((function(e,t){t.Chess=function(e){var t="b",n="w",r=-1,o="p",a="b",i="k",s="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",l=["1-0","0-1","1/2-1/2","*"],c={b:[16,32,17,15],w:[-16,-32,-17,-15]},u={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},f=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],p=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],d={p:0,n:1,b:2,r:3,q:4,k:5},h={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},g={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},v={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},m={w:[{square:v.a1,flag:g.QSIDE_CASTLE},{square:v.h1,flag:g.KSIDE_CASTLE}],b:[{square:v.a8,flag:g.QSIDE_CASTLE},{square:v.h8,flag:g.KSIDE_CASTLE}]},b=new Array(128),w={w:r,b:r},y=n,k={w:0,b:0},P=r,C=0,E=1,S=[],T={};function M(){b=new Array(128),w={w:r,b:r},y=n,k={w:0,b:0},P=r,C=0,E=1,S=[],T={},I(A())}function N(){O(s)}function O(e){var o=e.split(/\s+/),a=o[0],i=0;if(!R(e).valid)return!1;M();for(var s=0;s<a.length;s++){var l=a.charAt(s);if("/"===l)i+=8;else if(-1!=="0123456789".indexOf(l))i+=parseInt(l,10);else{var c=l<"a"?n:t;B({type:l.toLowerCase(),color:c},X(i)),i++}}return y=o[1],o[2].indexOf("K")>-1&&(k.w|=g.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(k.w|=g.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(k.b|=g.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(k.b|=g.QSIDE_CASTLE),P="-"===o[3]?r:v[o[3]],C=parseInt(o[4],10),E=parseInt(o[5],10),I(A()),!0}function R(e){var t="No errors.",n="FEN string must contain six space-delimited fields.",r="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",a="4th field (en-passant square) is invalid.",i="3rd field (castling availability) is invalid.",s="2nd field (side to move) is invalid.",l="1st field (piece positions) does not contain 8 '/'-delimited rows.",c="1st field (piece positions) is invalid [consecutive numbers].",u="1st field (piece positions) is invalid [invalid piece].",f="1st field (piece positions) is invalid [row too large].",p="Illegal en-passant square",d=e.split(/\s+/);if(6!==d.length)return{valid:!1,error_number:1,error:n};if(isNaN(d[5])||parseInt(d[5],10)<=0)return{valid:!1,error_number:2,error:r};if(isNaN(d[4])||parseInt(d[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(d[3]))return{valid:!1,error_number:4,error:a};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(d[2]))return{valid:!1,error_number:5,error:i};if(!/^(w|b)$/.test(d[1]))return{valid:!1,error_number:6,error:s};var h=d[0].split("/");if(8!==h.length)return{valid:!1,error_number:7,error:l};for(var g=0;g<h.length;g++){for(var v=0,m=!1,b=0;b<h[g].length;b++)if(isNaN(h[g][b])){if(!/^[prnbqkPRNBQK]$/.test(h[g][b]))return{valid:!1,error_number:9,error:u};v+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:c};v+=parseInt(h[g][b],10),m=!0}if(8!==v)return{valid:!1,error_number:10,error:f}}return"3"==d[3][1]&&"w"==d[1]||"6"==d[3][1]&&"b"==d[1]?{valid:!1,error_number:11,error:p}:{valid:!0,error_number:0,error:t}}function A(){for(var e=0,t="",o=v.a8;o<=v.h1;o++){if(null==b[o])e++;else{e>0&&(t+=e,e=0);var a=b[o].color,i=b[o].type;t+=a===n?i.toUpperCase():i.toLowerCase()}o+1&136&&(e>0&&(t+=e),o!==v.h1&&(t+="/"),e=0,o+=8)}var s="";k.w&g.KSIDE_CASTLE&&(s+="K"),k.w&g.QSIDE_CASTLE&&(s+="Q"),k.b&g.KSIDE_CASTLE&&(s+="k"),k.b&g.QSIDE_CASTLE&&(s+="q"),s=s||"-";var l=P===r?"-":X(P);return[t,y,s,l,C,E].join(" ")}function x(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(T[e[t]]=e[t+1]);return T}function I(e){S.length>0||(e!==s?(T.SetUp="1",T.FEN=e):(delete T.SetUp,delete T.FEN))}function K(e){var t=b[v[e]];return t?{type:t.type,color:t.color}:null}function B(e,t){if(!("type"in e)||!("color"in e))return!1;if(-1==="pnbrqkPNBRQK".indexOf(e.type.toLowerCase()))return!1;if(!(t in v))return!1;var n=v[t];return(e.type!=i||w[e.color]==r||w[e.color]==n)&&(b[n]={type:e.type,color:e.color},e.type===i&&(w[e.color]=n),I(A()),!0)}function q(e,t,n,r,a){var i={color:y,from:t,to:n,flags:r,piece:e[t].type};return a&&(i.flags|=g.PROMOTION,i.promotion=a),e[n]?i.captured=e[n].type:r&g.EP_CAPTURE&&(i.captured=o),i}function _(e){function t(e,t,n,r,i){if(e[n].type!==o||0!==J(r)&&7!==J(r))t.push(q(e,n,r,i));else for(var s=["q","r",a,"n"],l=0,c=s.length;l<c;l++)t.push(q(e,n,r,i,s[l]))}var n=[],r=y,i=Z(r),s={b:1,w:6},l=v.a8,f=v.h1,p=!1,d=void 0===e||!("legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in v))return[];l=f=v[e.square],p=!0}for(var h=l;h<=f;h++)if(136&h)h+=7;else{var m=b[h];if(null!=m&&m.color===r)if(m.type===o){var C=h+c[r][0];if(null==b[C]){t(b,n,h,C,g.NORMAL);C=h+c[r][1];s[r]===J(h)&&null==b[C]&&t(b,n,h,C,g.BIG_PAWN)}for(E=2;E<4;E++){136&(C=h+c[r][E])||(null!=b[C]&&b[C].color===i?t(b,n,h,C,g.CAPTURE):C===P&&t(b,n,h,P,g.EP_CAPTURE))}}else for(var E=0,S=u[m.type].length;E<S;E++){var T=u[m.type][E];for(C=h;!(136&(C+=T));){if(null!=b[C]){if(b[C].color===r)break;t(b,n,h,C,g.CAPTURE);break}if(t(b,n,h,C,g.NORMAL),"n"===m.type||"k"===m.type)break}}}if(!p||f===w[r]){if(k[r]&g.KSIDE_CASTLE){var M=(N=w[r])+2;null!=b[N+1]||null!=b[M]||j(i,w[r])||j(i,N+1)||j(i,M)||t(b,n,w[r],M,g.KSIDE_CASTLE)}if(k[r]&g.QSIDE_CASTLE){var N;M=(N=w[r])-2;null!=b[N-1]||null!=b[N-2]||null!=b[N-3]||j(i,w[r])||j(i,N-1)||j(i,M)||t(b,n,w[r],M,g.QSIDE_CASTLE)}}if(!d)return n;var O=[];for(h=0,S=n.length;h<S;h++)z(n[h]),F(r)||O.push(n[h]),Y();return O}function L(e,t){var n="";if(e.flags&g.KSIDE_CASTLE)n="O-O";else if(e.flags&g.QSIDE_CASTLE)n="O-O-O";else{var r=function(e,t){for(var n=_({legal:!t}),r=e.from,o=e.to,a=e.piece,i=0,s=0,l=0,c=0,u=n.length;c<u;c++){var f=n[c].from,p=n[c].to;a===n[c].piece&&r!==f&&o===p&&(i++,J(r)===J(f)&&s++,V(r)===V(f)&&l++)}if(i>0)return s>0&&l>0?X(r):l>0?X(r).charAt(1):X(r).charAt(0);return""}(e,t);e.piece!==o&&(n+=e.piece.toUpperCase()+r),e.flags&(g.CAPTURE|g.EP_CAPTURE)&&(e.piece===o&&(n+=X(e.from)[0]),n+="x"),n+=X(e.to),e.flags&g.PROMOTION&&(n+="="+e.promotion.toUpperCase())}return z(e),Q()&&(U()?n+="#":n+="+"),Y(),n}function D(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function j(e,r){if(r<0)return!1;for(var a=v.a8;a<=v.h1;a++)if(136&a)a+=7;else if(null!=b[a]&&b[a].color===e){var i=b[a],s=a-r,l=s+119;if(f[l]&1<<d[i.type]){if(i.type===o){if(s>0){if(i.color===n)return!0}else if(i.color===t)return!0;continue}if("n"===i.type||"k"===i.type)return!0;for(var c=p[l],u=a+c,h=!1;u!==r;){if(null!=b[u]){h=!0;break}u+=c}if(!h)return!0}}return!1}function F(e){return j(Z(e),w[e])}function Q(){return F(y)}function U(){return Q()&&0===_().length}function G(){return!Q()&&0===_().length}function $(){for(var e={},t=[],n=0,r=0,o=v.a8;o<=v.h1;o++)if(r=(r+1)%2,136&o)o+=7;else{var i=b[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===a&&t.push(r),n++)}if(2===n)return!0;if(3===n&&(1===e.b||1===e.n))return!0;if(n===e.b+2){var s=0,l=t.length;for(o=0;o<l;o++)s+=t[o];if(0===s||s===l)return!0}return!1}function W(){for(var e=[],t={},n=!1;;){var r=Y();if(!r)break;e.push(r)}for(;;){var o=A().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(n=!0),!e.length)break;z(e.pop())}return n}function z(e){var n=y,a=Z(n);if(function(e){S.push({move:e,kings:{b:w.b,w:w.w},turn:y,castling:{b:k.b,w:k.w},ep_square:P,half_moves:C,move_number:E})}(e),b[e.to]=b[e.from],b[e.from]=null,e.flags&g.EP_CAPTURE&&(y===t?b[e.to-16]=null:b[e.to+16]=null),e.flags&g.PROMOTION&&(b[e.to]={type:e.promotion,color:n}),b[e.to].type===i){if(w[b[e.to].color]=e.to,e.flags&g.KSIDE_CASTLE){var s=e.to-1,l=e.to+1;b[s]=b[l],b[l]=null}else if(e.flags&g.QSIDE_CASTLE){s=e.to+1,l=e.to-2;b[s]=b[l],b[l]=null}k[n]=""}if(k[n])for(var c=0,u=m[n].length;c<u;c++)if(e.from===m[n][c].square&&k[n]&m[n][c].flag){k[n]^=m[n][c].flag;break}if(k[a])for(c=0,u=m[a].length;c<u;c++)if(e.to===m[a][c].square&&k[a]&m[a][c].flag){k[a]^=m[a][c].flag;break}P=e.flags&g.BIG_PAWN?"b"===y?e.to-16:e.to+16:r,e.piece===o||e.flags&(g.CAPTURE|g.EP_CAPTURE)?C=0:C++,y===t&&E++,y=Z(y)}function Y(){var e=S.pop();if(null==e)return null;var n=e.move;w=e.kings,y=e.turn,k=e.castling,P=e.ep_square,C=e.half_moves,E=e.move_number;var r,a,i=y,s=Z(y);if(b[n.from]=b[n.to],b[n.from].type=n.piece,b[n.to]=null,n.flags&g.CAPTURE)b[n.to]={type:n.captured,color:s};else if(n.flags&g.EP_CAPTURE){var l;l=i===t?n.to-16:n.to+16,b[l]={type:o,color:s}}n.flags&(g.KSIDE_CASTLE|g.QSIDE_CASTLE)&&(n.flags&g.KSIDE_CASTLE?(r=n.to+1,a=n.to-1):n.flags&g.QSIDE_CASTLE&&(r=n.to-2,a=n.to+1),b[r]=b[a],b[a]=null);return n}function H(e,t){var n=D(e);if(t){var r=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(r)var o=r[1],a=r[2],i=r[3],s=r[4]}for(var l=_(),c=0,u=l.length;c<u;c++){if(n===D(L(l[c]))||t&&n===D(L(l[c],!0)))return l[c];if(r&&(!o||o.toLowerCase()==l[c].piece)&&v[a]==l[c].from&&v[i]==l[c].to&&(!s||s.toLowerCase()==l[c].promotion))return l[c]}return null}function J(e){return e>>4}function V(e){return 15&e}function X(e){var t=V(e),n=J(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function Z(e){return e===n?t:n}function ee(e){var t=te(e);t.san=L(t,!1),t.to=X(t.to),t.from=X(t.from);var n="";for(var r in g)g[r]&t.flags&&(n+=h[r]);return t.flags=n,t}function te(e){var t=e instanceof Array?[]:{};for(var n in e)t[n]="object"==typeof n?te(e[n]):e[n];return t}function ne(e){return e.replace(/^\s+|\s+$/g,"")}function re(e){for(var t=_({legal:!1}),n=0,r=y,o=0,a=t.length;o<a;o++){if(z(t[o]),!F(r))if(e-1>0)n+=re(e-1);else n++;Y()}return n}return O(void 0===e?s:e),{WHITE:n,BLACK:t,PAWN:o,KNIGHT:"n",BISHOP:a,ROOK:"r",QUEEN:"q",KING:i,SQUARES:function(){for(var e=[],t=v.a8;t<=v.h1;t++)136&t?t+=7:e.push(X(t));return e}(),FLAGS:h,load:function(e){return O(e)},reset:function(){return N()},moves:function(e){for(var t=_(e),n=[],r=0,o=t.length;r<o;r++)void 0!==e&&"verbose"in e&&e.verbose?n.push(ee(t[r])):n.push(L(t[r],!1));return n},in_check:function(){return Q()},in_checkmate:function(){return U()},in_stalemate:function(){return G()},in_draw:function(){return C>=100||G()||$()||W()},insufficient_material:function(){return $()},in_threefold_repetition:function(){return W()},game_over:function(){return C>=100||U()||G()||$()||W()},validate_fen:function(e){return R(e)},fen:function(){return A()},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,r=[],o=!1;for(var a in T)r.push("["+a+' "'+T[a]+'"]'+t),o=!0;o&&S.length&&r.push(t);for(var i=[];S.length>0;)i.push(Y());for(var s=[],l="";i.length>0;){var c=i.pop();S.length||"b"!==c.color?"w"===c.color&&(l.length&&s.push(l),l=E+"."):l=E+". ...",l=l+" "+L(c,!1),z(c)}if(l.length&&s.push(l),void 0!==T.Result&&s.push(T.Result),0===n)return r.join("")+s.join(" ");var u=0;for(a=0;a<s.length;a++)u+s[a].length>n&&0!==a?(" "===r[r.length-1]&&r.pop(),r.push(t),u=0):0!==a&&(r.push(" "),u++),r.push(s[a]),u+=s[a].length;return r.join("")},load_pgn:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy;function r(e){return e.replace(/\\/g,"\\")}var o="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",a=new RegExp("^(\\[(.|"+r(o)+")*\\])("+r(o)+")*1.("+r(o)+"|.)*$","g"),i=e.replace(a,"$1");"["!==i[0]&&(i=""),N();var s=function(e,t){for(var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o={},a=e.split(new RegExp(r(n))),i="",s="",l=0;l<a.length;l++)i=a[l].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=a[l].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),ne(i).length>0&&(o[i]=s);return o}(i,t);for(var c in s)x([c,s[c]]);if(!("1"!==s.SetUp||"FEN"in s&&O(s.FEN)))return!1;var u=e.replace(i,"").replace(new RegExp(r(o),"g")," ");u=u.replace(/(\{[^}]+\})+?/g,"");for(var f=/(\([^\(\)]+\))+?/g;f.test(u);)u=u.replace(f,"");var p=ne(u=(u=(u=u.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));p=p.join(",").replace(/,,+/g,",").split(",");for(var d="",h=0;h<p.length-1;h++){if(null==(d=H(p[h],n)))return!1;z(d)}if(d=p[p.length-1],l.indexOf(d)>-1)(function(e){for(var t in e)return!0;return!1})(T)&&void 0===T.Result&&x(["Result",d]);else{if(null==(d=H(d,n)))return!1;z(d)}return!0},header:function(){return x(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",t=v.a8;t<=v.h1;t++){if(0===V(t)&&(e+=" "+"87654321"[J(t)]+" |"),null==b[t])e+=" . ";else{var r=b[t].type;e+=" "+(b[t].color===n?r.toUpperCase():r.toLowerCase())+" "}t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+"     a  b  c  d  e  f  g  h\n"}()},turn:function(){return y},move:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy,r=null;if("string"==typeof e)r=H(e,n);else if("object"==typeof e)for(var o=_(),a=0,i=o.length;a<i;a++)if(e.from===X(o[a].from)&&e.to===X(o[a].to)&&(!("promotion"in o[a])||e.promotion===o[a].promotion)){r=o[a];break}if(!r)return null;var s=ee(r);return z(r),s},undo:function(){var e=Y();return e?ee(e):null},clear:function(){return M()},put:function(e,t){return B(e,t)},get:function(e){return K(e)},remove:function(e){return function(e){var t=K(e);return b[v[e]]=null,t&&t.type===i&&(w[t.color]=r),I(A()),t}(e)},perft:function(e){return re(e)},square_color:function(e){if(e in v){var t=v[e];return(J(t)+V(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],n=[],r=(void 0!==e&&"verbose"in e&&e.verbose);S.length>0;)t.push(Y());for(;t.length>0;){var o=t.pop();r?n.push(ee(o)):n.push(L(o)),z(o)}return n}}}})).Chess;const Tn=(e,t)=>(lichess.sound.loadOggOrMp3(e,`${lichess.sound.baseUrl}/${e}`),()=>lichess.sound.play(e,t));var Mn={move:()=>lichess.sound.play("move"),take:Tn("sfx/Tournament3rd",.4),levelStart:Tn("other/ping"),levelEnd:Tn("other/energy3"),stageStart:Tn("other/guitar"),stageEnd:Tn("other/gewonnen"),failure:Tn("other/no-go")},Nn=dn.util.opposite,On=dn.util.key2pos,Rn=!1;function An(e,t,r,o,a,i){if(Rn){var s=12.5*(8-On(t)[0]);"white"===a&&(s=87.5-s);var l=o===a?"top":"bottom";return n("div#promotion-choice."+l,[r.map((function(e,t){return n("square",{style:l+": "+12.5*t+"%;left: "+s+"%",onclick:function(t){var n;t.stopPropagation(),n=e,Rn&&En.promote(Rn.dest,n),Rn.callback&&Rn.callback(Rn.orig,Rn.dest,n),Rn=!1}},n("piece."+e+"."+o))})),i?xn(e):null])}}function xn(e){return n("div.explanation",[n("h2",e.trans.noarg("pawnPromotion")),n("p",e.trans.noarg("yourPawnReachedTheEndOfTheBoard")),n("p",e.trans.noarg("itNowPromotesToAStrongerPiece")),n("p",e.trans.noarg("selectThePieceYouWant"))])}var In={start:function(e,t,r){var o=En.pieces()[t];return!(!o||"pawn"!=o.role||!(1==t[1]&&"black"==o.color||8==t[1]&&"white"==o.color))&&(Rn={orig:e,dest:t,callback:r},n.redraw(),!0)},view:function(e,t){if(Rn){return An(e,Rn.dest,["queen","knight","rook","bishop"],Nn(En.data().turnColor),En.data().orientation,t.blueprint.explainPromotion)}},reset:function(){Rn=!1}},Kn=Oe,Bn=Re,qn=function(e,t){var o=Kn({apples:e.apples}),a={lastStep:!1,completed:!1,willComplete:!1,failed:!1,score:0,nbMoves:0},i=function(){return{scenario:f,chess:c,vm:a}},s=function(r,s,p){a.nbMoves++;var d=c.move(r,s,p);if(!d)return a.failed=!0,En.showCheckmate(c),Mn.failure(),n.redraw();En.fen(c.fen(),e.color,{});var h,g,v=!1,m=!1;o.withItem(d.to,(function(e){"apple"===e&&(a.score+=u.apple,o.remove(d.to),v=!0)})),!v&&d.captured&&e.pointsForCapture&&(e.showPieceValues?a.score+=u.pieceValue(d.captured):a.score+=u.capture,v=!0),En.check(c),f.player(d.from+d.to+(d.promotion||""))?(a.score+=u.scenario,h=!0):(m=function(){if(!e.detectCapture)return!1;var t="unprotected"===e.detectCapture?"findUnprotectedCapture":"findCapture",n=c[t]();return n?(a.failed=!0,En.stop(),En.showCapture(n),Mn.failure(),!0):void 0}(),a.failed=a.failed||m||((g=e.failure&&e.failure(i()))&&Mn.failure(),g)),a.failed||(e.success?!e.success(i()):o.hasItem("apple"))||(a.willComplete=!0,Te.setTimeout((function(){a.lastStep=!1,a.completed=!0,Mn.levelEnd(),a.score+=u.getLevelBonus(e,a.nbMoves),En.stop(),n.redraw(),e.nextButton||Te.setTimeout(t.onComplete,1200)}),En.data().stats.dragged?1:250)),a.willComplete||(v||h?Mn.take():Mn.move(),a.failed?e.showFailureFollowUp&&!m&&Te.setTimeout((function(){var t=c.playRandomMove();En.fen(c.fen(),e.color,{},[t.orig,t.dest])}),600):(En.select(s),h||(c.color(e.color),En.color(e.color,l()))),n.redraw())},l=function(){return c.dests({illegal:e.offerIllegalMove})},c=function(e,t){var n=new Sn(e);if(t){var o="w"===n.turn()?"b":"w";t.forEach((function(e){n.put({type:"p",color:o},e)}))}function a(){return"w"==n.turn()?"white":"black"}function i(e){var t="white"===e?"w":"b",o=r.setFenTurn(n.fen(),t);n.load(o),a()!==e&&(o=o.replace(/ (w|b) ([kKqQ-]{1,4}) \w\d /," "+t+" $2 - "),n.load(o))}var s=function(){return n.moves({verbose:!0}).filter((function(e){return e.captured})).map((function(e){return{orig:e.from,dest:e.to}}))};return{dests:function(e){e=e||{};var t={};return n.SQUARES.forEach((function(r){var o=n.moves({square:r,verbose:!0,legal:!e.illegal});o.length&&(t[r]=o.map((function(e){return e.to})))})),t},color:function(e){if(!e)return a();i(e)},fen:n.fen,move:function(e,t,o){return n.move({from:e,to:t,promotion:o?r.roleToSan[o].toLowerCase():null})},occupation:function(){var e={};return n.SQUARES.forEach((function(t){var r=n.get(t);r&&(e[t]=r)})),e},kingKey:function(e){for(var t in n.SQUARES){var r=n.get(n.SQUARES[t]);if(r&&"k"===r.type&&r.color===("white"===e?"w":"b"))return n.SQUARES[t]}},findCapture:function(){return s()[0]},findUnprotectedCapture:function(){return s().find((function(e){var t=new Sn(n.fen());return t.move({from:e.orig,to:e.dest}),!t.moves({verbose:!0}).some((function(t){return t.captured&&t.to===e.dest}))}))},checks:function(){if(!n.in_check())return null;var e=a();i("white"===e?"black":"white");var t=n.moves({verbose:!0}).filter((function(e){return"k"===e.captured})).map((function(e){return{orig:e.from,dest:e.to}}));return i(e),t},playRandomMove:function(){var e=n.moves({verbose:!0});if(e.length){var t=e[Math.floor(Math.random()*e.length)];return n.move(t),{orig:t.from,dest:t.to}}},get:n.get,undo:n.undo,instance:n}}(e.fen,e.emptyApples?[]:o.appleKeys()),f=function(e,t){var n=(e||[]).map((function(e){return e.move?e:{move:e,shapes:[]}})),o=0,a=!1,i=function(){return a=!0,!1},s=function(){var e=n[o];if(e){var a=r.decomposeUci(e.move);if(!t.chess.move(a[0],a[1],a[2]))return i();o++,En.fen(t.chess.fen(),t.chess.color(),t.makeChessDests(),a),e.shapes&&Te.setTimeout((function(){En.setShapes(e.shapes)}),500)}};return{isComplete:function(){return o===n.length},isFailed:function(){return a},opponent:s,player:function(e){var t=n[o];if(t)return t.move!==e?i():(o++,t.shapes&&En.setShapes(t.shapes),Te.setTimeout(s,1e3),!0)}}}(e.scenario,{chess:c,makeChessDests:l});return In.reset(),En.set({chess:c,offerIllegalMove:e.offerIllegalMove,autoCastle:e.autoCastle,orientation:e.color,onMove:function(t,n){var r=En.get(n);r&&r.color===e.color&&(In.start(t,n,s)||s(t,n))},items:{render:function(e,t){return o.withItem(t,Bn)}},shapes:e.shapes}),{blueprint:e,items:o,vm:a,scenario:f,start:function(){Mn.levelStart(),c.color()!==e.color&&Te.setTimeout(f.opponent,1e3)},onComplete:t.onComplete}},_n=n("i[data-icon=t]");function Ln(e,t){for(var r=u.getLevelRank(e,t),o=[],a=3;a>=r;a--)o.push(_n);return n("span.stars.st"+o.length,o)}var Dn=function(e){return n("div.progress",e.stage.levels.map((function(t){var r=e.score(t),o=t.id===e.level.blueprint.id?"active":r?"done":"future",a=r?Ln(t,r):n("span.id",t.id);return n("a",{href:"/"+e.stage.id+"/"+t.id,config:n.route,class:o},a)})))},jn=Ln,Fn=function(e,t,n){return{stage:e,level:t,score:function(t){return n.stages[e.key]?n.stages[e.key].scores[t.id-1]:0}}};var Qn=["awesome","excellent","greatJob","perfect","outstanding","wayToGo","yesYesYes","youreGoodAtThis","nailedIt","rightOn"];!function(e){var t,n,r;for(r=e.length;r;r-=1)t=Math.floor(Math.random()*r),n=e[r-1],e[r-1]=e[t],e[t]=n}(Qn);var Un=0,Gn=function(e){return n("div.learn__screen-overlay",{onclick:e.hideStartingPane},n("div.learn__screen",[n("h1",e.trans("stageX",e.stage.id)+": "+e.trans.noarg(e.stage.title)),e.stage.illustration,n("p",r.withLinebreaks(e.trans.noarg(e.stage.intro))),n("div.buttons",n("a.next",{onclick:e.hideStartingPane},e.trans.noarg("letsGo")))]))};let $n=!1;const Wn=e=>(!1===$n&&($n=window.Intl&&Intl.NumberFormat?new Intl.NumberFormat:null),null===$n?""+e:$n.format(e));var zn=t(Object.freeze({__proto__:null,numberFormat:Wn,numberSpread:(e,t,n,r)=>{let o;const a=(n,r,a)=>{const i=Wn(Math.round((n*(t-1-a)+r*(a+1))/t));i!==o&&(e.textContent=i,o=i)};let i=[];return(o,s)=>{if(!e||!o&&0!==o)return;s&&(t=Math.abs(s)),i.forEach(clearTimeout),i=[];const l=0===r?0:r||o;r=o;const c=Math.abs(n/t);for(let e=0;e<t;e++)i.push(setTimeout(a.bind(null,l,o,e),Math.round(e*c)))}}})).numberSpread;function Yn(e){for(var t=[],r=3;r>0;r--)t.push(n("div.star-wrap",e<=r?n("i.star"):null));return t}var Hn=function(e){var t=e.stage,o=e.getNext(),a=e.stageScore();return n("div.learn__screen-overlay",{onclick:function(e){e.target.classList.contains("learn__screen-overlay")&&n.route("/")}},n("div.learn__screen",[n("div.stars",Yn(u.getStageRank(t,a))),n("h1",e.trans("stageXComplete",t.id)),n("span.score",[e.trans.noarg("yourScore")+": ",n("span",{config:function(e,t){t||setTimeout((function(){zn(e,50,3e3,0)(a)}),300)}},0)]),n("p",r.withLinebreaks(e.trans.noarg(t.complete))),n("div.buttons",[o?n("a.next",{href:"/"+o.id,config:n.route},[e.trans.noarg("next")+": ",e.trans.noarg(o.title)+" ",n("i[data-icon=H]")]):null,n("a.back.text[data-icon=I]",{href:"/",config:n.route},e.trans.noarg("backToMenu"))])]))},Jn=In.view,Vn=Dn,Xn=jn;function Zn(e){return n("div.result.failed",{onclick:e.restart},[n("h2",e.trans.noarg("puzzleFailed")),n("button",e.trans.noarg("retry"))])}function er(e,t){return n("div.result.completed",{class:t.blueprint.nextButton?"next":"",onclick:t.onComplete},[n("h2",e.trans.noarg(Qn[Un++%Qn.length])),t.blueprint.nextButton?n("button",e.trans.noarg("next")):Xn(t.blueprint,t.vm.score)])}var tr=function(e){var t=e.stage,o=e.level;return n("div",{class:"learn learn--run "+t.cssClass+" "+o.blueprint.cssClass+(o.vm.starting?" starting":"")+(o.vm.completed&&!o.blueprint.nextButton?" completed":"")+(o.vm.lastStep?" last-step":"")+(o.blueprint.showPieceValues?" piece-values":"")},[n("div.learn__side",e.opts.side.view()),n("div.learn__main.main-board",[e.vm.stageStarting()?Gn(e):null,e.vm.stageCompleted()?Hn(e):null,dn.view(En.instance),Jn(e,o)]),n("div.learn__table",[n("div.wrap",[n("div.title",[n("img",{src:t.image}),n("div.text",[n("h2",e.trans.noarg(t.title)),n("p.subtitle",e.trans.noarg(t.subtitle))])]),o.vm.failed?Zn(e):o.vm.completed?er(e,o):n("div.goal",r.withLinebreaks(e.trans.noarg(o.blueprint.goal))),Vn(e.progress)])])])},nr=function(e,t){return{controller:function(){return function(e,t){Te.clearTimeouts();var r=ke.byId[n.route.param("stage")];r||n.route("/"),e.side.ctrl.setStage(r);var o=n.route.param("level")||function(){var t=e.storage.data.stages[r.key],n=0;if(t)for(;t.scores[n];)n++;return n>=r.levels.length&&(n=0),n+1}(),a=qn(r.levels[o-1],{stage:r,onComplete:function(){e.storage.saveScore(r,a.blueprint,a.vm.score),a.blueprint.id<r.levels.length?n.route("/"+r.id+"/"+(a.blueprint.id+1)):(s.stageCompleted(!0),Mn.stageEnd()),n.redraw()}}),i=function(){var t=e.storage.data.stages[r.key];return t?t.scores.reduce((function(e,t){return e+t})):0};e.route="run",e.stageId=r.id;var s={stageStarting:n.prop(1===a.blueprint.id&&0===i()),stageCompleted:n.prop(!1)};return s.stageStarting()?Mn.stageStart():a.start(),n.redraw.strategy("diff"),{opts:e,stage:r,level:a,vm:s,progress:Fn(r,a,e.storage.data),stageScore:i,getNext:function(){return ke.byId[r.id+1]},hideStartingPane:function(){s.stageStarting()&&(s.stageStarting(!1),a.start())},restart:function(){n.route("/"+r.id+"/"+a.blueprint.id)},trans:t}}(e,t)},view:tr}},rr="learn.progress",or={stages:{}};var ar=function(e){return{data:e=e||JSON.parse(lichess.storage.get(rr))||or,saveScore:function(t,r,o){e.stages[t.key]||(e.stages[t.key]={scores:[]}),e.stages[t.key].scores[r.id-1]>o||(e.stages[t.key].scores[r.id-1]=o,e._id?function(e,t,r){n.request({method:"POST",url:"/learn/score",data:{stage:e,level:t,score:r}})}(t.key,r.id,o):lichess.storage.set(rr,JSON.stringify(e)))},reset:function(){e.stages={},e._id?n.request({method:"POST",url:"/learn/reset"}).then((function(){location.reload()})):(lichess.storage.remove(rr),location.reload())}}};return function(e,t){t.storage=ar(t.data),delete t.data,n.route.mode="hash";var r=lichess.trans(t.i18n),o=Ne(t,r),a=o.controller();return t.side={ctrl:a,view:function(){return o.view(a)}},n.route(e,"/",{"/":Me(t,r),"/:stage/:level":nr(t,r),"/:stage":nr(t,r)}),{}}}();
