var LichessSwiss=function(e){"use strict";const t={createElement:function(e,t){return document.createElement(e,t)},createElementNS:function(e,t,n){return document.createElementNS(e,t,n)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,n){e.insertBefore(t,n)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},getTextContent:function(e){return e.textContent},isElement:function(e){return 1===e.nodeType},isText:function(e){return 3===e.nodeType},isComment:function(e){return 8===e.nodeType}};function n(e,t,n,o,s){return{sel:e,data:t,children:n,text:o,elm:s,key:void 0===t?void 0:t.key}}const o=Array.isArray;function s(e){return"string"==typeof e||"number"==typeof e}function r(e){return void 0===e}function a(e){return void 0!==e}const i=n("",{},[],void 0,void 0);function c(e,t){var n,o;const s=e.key===t.key,r=(null===(n=e.data)||void 0===n?void 0:n.is)===(null===(o=t.data)||void 0===o?void 0:o.is);return e.sel===t.sel&&s&&r}function l(e,t,n){var o;const s={};for(let r=t;r<=n;++r){const t=null===(o=e[r])||void 0===o?void 0:o.key;void 0!==t&&(s[t]=r)}return s}const d=["create","update","remove","destroy","pre","post"];function u(e,u){let h,p;const f={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},m=void 0!==u?u:t;for(h=0;h<d.length;++h)for(f[d[h]]=[],p=0;p<e.length;++p){const t=e[p][d[h]];void 0!==t&&f[d[h]].push(t)}function g(e){const t=e.id?"#"+e.id:"",o=e.className?"."+e.className.split(" ").join("."):"";return n(m.tagName(e).toLowerCase()+t+o,{},[],void 0,e)}function v(e,t){return function(){if(0==--t){const t=m.parentNode(e);m.removeChild(t,e)}}}function b(e,t){var n,c;let l,d=e.data;if(void 0!==d){const t=null===(n=d.hook)||void 0===n?void 0:n.init;a(t)&&(t(e),d=e.data)}const u=e.children,h=e.sel;if("!"===h)r(e.text)&&(e.text=""),e.elm=m.createComment(e.text);else if(void 0!==h){const n=h.indexOf("#"),r=h.indexOf(".",n),p=n>0?n:h.length,g=r>0?r:h.length,v=-1!==n||-1!==r?h.slice(0,Math.min(p,g)):h,w=e.elm=a(d)&&a(l=d.ns)?m.createElementNS(l,v,d):m.createElement(v,d);for(p<g&&w.setAttribute("id",h.slice(p+1,g)),r>0&&w.setAttribute("class",h.slice(g+1).replace(/\./g," ")),l=0;l<f.create.length;++l)f.create[l](i,e);if(o(u))for(l=0;l<u.length;++l){const e=u[l];null!=e&&m.appendChild(w,b(e,t))}else s(e.text)&&m.appendChild(w,m.createTextNode(e.text));const y=e.data.hook;a(y)&&(null===(c=y.create)||void 0===c||c.call(y,i,e),y.insert&&t.push(e))}else e.elm=m.createTextNode(e.text);return e.elm}function w(e,t,n,o,s,r){for(;o<=s;++o){const s=n[o];null!=s&&m.insertBefore(e,b(s,r),t)}}function y(e){var t,n;const o=e.data;if(void 0!==o){null===(n=null===(t=null==o?void 0:o.hook)||void 0===t?void 0:t.destroy)||void 0===n||n.call(t,e);for(let t=0;t<f.destroy.length;++t)f.destroy[t](e);if(void 0!==e.children)for(let t=0;t<e.children.length;++t){const n=e.children[t];null!=n&&"string"!=typeof n&&y(n)}}}function k(e,t,n,o){for(var s,r;n<=o;++n){let o,i;const c=t[n];if(null!=c)if(a(c.sel)){y(c),o=f.remove.length+1,i=v(c.elm,o);for(let e=0;e<f.remove.length;++e)f.remove[e](c,i);const e=null===(r=null===(s=null==c?void 0:c.data)||void 0===s?void 0:s.hook)||void 0===r?void 0:r.remove;a(e)?e(c,i):i()}else m.removeChild(e,c.elm)}}function x(e,t,n){var o,s,i,d,u;const h=null===(o=t.data)||void 0===o?void 0:o.hook;null===(s=null==h?void 0:h.prepatch)||void 0===s||s.call(h,e,t);const p=t.elm=e.elm,g=e.children,v=t.children;if(e!==t){if(void 0!==t.data){for(let n=0;n<f.update.length;++n)f.update[n](e,t);null===(d=null===(i=t.data.hook)||void 0===i?void 0:i.update)||void 0===d||d.call(i,e,t)}r(t.text)?a(g)&&a(v)?g!==v&&function(e,t,n,o){let s,a,i,d,u=0,h=0,p=t.length-1,f=t[0],g=t[p],v=n.length-1,y=n[0],C=n[v];for(;u<=p&&h<=v;)null==f?f=t[++u]:null==g?g=t[--p]:null==y?y=n[++h]:null==C?C=n[--v]:c(f,y)?(x(f,y,o),f=t[++u],y=n[++h]):c(g,C)?(x(g,C,o),g=t[--p],C=n[--v]):c(f,C)?(x(f,C,o),m.insertBefore(e,f.elm,m.nextSibling(g.elm)),f=t[++u],C=n[--v]):c(g,y)?(x(g,y,o),m.insertBefore(e,g.elm,f.elm),g=t[--p],y=n[++h]):(void 0===s&&(s=l(t,u,p)),a=s[y.key],r(a)?m.insertBefore(e,b(y,o),f.elm):(i=t[a],i.sel!==y.sel?m.insertBefore(e,b(y,o),f.elm):(x(i,y,o),t[a]=void 0,m.insertBefore(e,i.elm,f.elm))),y=n[++h]);(u<=p||h<=v)&&(u>p?(d=null==n[v+1]?null:n[v+1].elm,w(e,d,n,h,v,o)):k(e,t,u,p))}(p,g,v,n):a(v)?(a(e.text)&&m.setTextContent(p,""),w(p,null,v,0,v.length-1,n)):a(g)?k(p,g,0,g.length-1):a(e.text)&&m.setTextContent(p,""):e.text!==t.text&&(a(g)&&k(p,g,0,g.length-1),m.setTextContent(p,t.text)),null===(u=null==h?void 0:h.postpatch)||void 0===u||u.call(h,e,t)}}return function(e,t){let n,o,s;const r=[];for(n=0;n<f.pre.length;++n)f.pre[n]();for(function(e){return void 0!==e.sel}(e)||(e=g(e)),c(e,t)?x(e,t,r):(o=e.elm,s=m.parentNode(o),b(t,r),null!==s&&(m.insertBefore(s,t.elm,m.nextSibling(o)),k(s,[e],0,0))),n=0;n<r.length;++n)r[n].data.hook.insert(r[n]);for(n=0;n<f.post.length;++n)f.post[n]();return t}}function h(e,t,n){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==t)for(let e=0;e<t.length;++e){const n=t[e].data;void 0!==n&&h(n,t[e].children,t[e].sel)}}function p(e,t,r){let a,i,c,l={};if(void 0!==r?(null!==t&&(l=t),o(r)?a=r:s(r)?i=r:r&&r.sel&&(a=[r])):null!=t&&(o(t)?a=t:s(t)?i=t:t&&t.sel?a=[t]:l=t),void 0!==a)for(c=0;c<a.length;++c)s(a[c])&&(a[c]=n(void 0,void 0,void 0,a[c],void 0));return"s"!==e[0]||"v"!==e[1]||"g"!==e[2]||3!==e.length&&"."!==e[3]&&"#"!==e[3]||h(l,a,e),n(e,l,a,i,void 0)}function f(e,t){e.data.fn=t.data.fn,e.data.args=t.data.args,t.data=e.data,t.children=e.children,t.text=e.text,t.elm=e.elm}function m(e){const t=e.data;f(t.fn(...t.args),e)}function g(e,t){let n;const o=e.data,s=t.data,r=o.args,a=s.args;if(o.fn===s.fn&&r.length===a.length){for(n=0;n<a.length;++n)if(r[n]!==a[n])return void f(s.fn(...a),t);f(e,t)}else f(s.fn(...a),t)}function v(e,t){let n;const o=t.elm;let s=e.data.attrs,r=t.data.attrs;if((s||r)&&s!==r){for(n in s=s||{},r=r||{},r){const e=r[n];s[n]!==e&&(!0===e?o.setAttribute(n,""):!1===e?o.removeAttribute(n):120!==n.charCodeAt(0)?o.setAttribute(n,e):58===n.charCodeAt(3)?o.setAttributeNS("http://www.w3.org/XML/1998/namespace",n,e):58===n.charCodeAt(5)?o.setAttributeNS("http://www.w3.org/1999/xlink",n,e):o.setAttribute(n,e))}for(n in s)n in r||o.removeAttribute(n)}}const b={create:v,update:v};function w(e,t){let n,o;const s=t.elm;let r=e.data.class,a=t.data.class;if((r||a)&&r!==a){for(o in r=r||{},a=a||{},r)r[o]&&!Object.prototype.hasOwnProperty.call(a,o)&&s.classList.remove(o);for(o in a)n=a[o],n!==r[o]&&s.classList[n?"add":"remove"](o)}}const y={create:w,update:w},k=["white","black"],x=["a","b","c","d","e","f","g","h"],C=["1","2","3","4","5","6","7","8"],S=[...C].reverse(),P=Array.prototype.concat(...x.map((e=>C.map((t=>e+t))))),M=e=>P[8*e[0]+e[1]],T=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],_=P.map(T);const I=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},O=e=>"white"===e?"black":"white",j=(e,t)=>{const n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o},N=(e,t)=>e.role===t.role&&e.color===t.color,L=(e,t,n,o)=>[(t?e[0]:7-e[0])*n,(t?7-e[1]:e[1])*o],A=e=>{const t=e.width/8,n=e.height/8;return(e,o)=>L(e,o,t,n)},R=(e,t)=>L(e,t,100,100),E=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},q=(e,t)=>{e.style.transform=`translate(${t[0]}%,${t[1]}%)`},B=(e,t)=>{e.style.visibility=t?"visible":"hidden"},K=e=>{var t;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:(null===(t=e.targetTouches)||void 0===t?void 0:t[0])?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},D=e=>2===e.buttons||2===e.button,F=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function W(e,t,n){const o=T(e);return t||(o[0]=7-o[0],o[1]=7-o[1]),[n.left+n.width*o[0]/8+n.width/16,n.top+n.height*(7-o[1])/8+n.height/16]}function G(e,t){return Math.abs(e-t)}const H=(e,t,n,o)=>{const s=G(e,n),r=G(t,o);return 1===s&&2===r||2===s&&1===r},z=(e,t,n,o)=>G(e,n)===G(t,o),V=(e,t,n,o)=>e===n||t===o,X=(e,t,n,o)=>z(e,t,n,o)||V(e,t,n,o);function U(e,t,n){const o=e.get(t);if(!o)return[];const s=T(t),r=o.role,a="pawn"===r?(i=o.color,(e,t,n,o)=>G(e,n)<2&&("white"===i?o===t+1||t<=1&&o===t+2&&e===n:o===t-1||t>=6&&o===t-2&&e===n)):"knight"===r?H:"bishop"===r?z:"rook"===r?V:"queen"===r?X:function(e,t,n){return(o,s,r,a)=>G(o,r)<2&&G(s,a)<2||n&&s===a&&s===("white"===e?0:7)&&(4===o&&(2===r&&t.includes(0)||6===r&&t.includes(7))||t.includes(r))}(o.color,function(e,t){const n="white"===t?"1":"8",o=[];for(const[s,r]of e)s[1]===n&&r.color===t&&"rook"===r.role&&o.push(T(s)[0]);return o}(e,o.color),n);var i;return _.filter((e=>(s[0]!==e[0]||s[1]!==e[1])&&a(s[0],s[1],e[0],e[1]))).map(M)}function Y(e,...t){e&&setTimeout((()=>e(...t)),1)}function Z(e){e.premovable.current&&(e.premovable.current=void 0,Y(e.premovable.events.unset))}function J(e){const t=e.predroppable;t.current&&(t.current=void 0,Y(t.events.unset))}function Q(e,t,n){const o=e.pieces.get(t),s=e.pieces.get(n);if(t===n||!o)return!1;const r=s&&s.color!==o.color?s:void 0;return n===e.selected&&ae(e),Y(e.events.move,t,n,r),function(e,t,n){if(!e.autoCastle)return!1;const o=e.pieces.get(t);if(!o||"king"!==o.role)return!1;const s=T(t),r=T(n);if(0!==s[1]&&7!==s[1]||s[1]!==r[1])return!1;4!==s[0]||e.pieces.has(n)||(6===r[0]?n=M([7,r[1]]):2===r[0]&&(n=M([0,r[1]])));const a=e.pieces.get(n);return!(!a||a.color!==o.color||"rook"!==a.role||(e.pieces.delete(t),e.pieces.delete(n),s[0]<r[0]?(e.pieces.set(M([6,r[1]]),o),e.pieces.set(M([5,r[1]]),a)):(e.pieces.set(M([2,r[1]]),o),e.pieces.set(M([3,r[1]]),a)),0))}(e,t,n)||(e.pieces.set(n,o),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,Y(e.events.change),r||!0}function ee(e,t,n,o){if(e.pieces.has(n)){if(!o)return!1;e.pieces.delete(n)}return Y(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,Y(e.events.change),e.movable.dests=void 0,e.turnColor=O(e.turnColor),!0}function te(e,t,n){const o=Q(e,t,n);return o&&(e.movable.dests=void 0,e.turnColor=O(e.turnColor),e.animation.current=void 0),o}function ne(e,t,n){if(ce(e,t,n)){const o=te(e,t,n);if(o){const s=e.hold.stop();ae(e);const r={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:s};return!0!==o&&(r.captured=o),Y(e.movable.events.after,t,n,r),!0}}else if(function(e,t,n){return t!==n&&le(e,t)&&U(e.pieces,t,e.premovable.castle).includes(n)}(e,t,n))return function(e,t,n,o){J(e),e.premovable.current=[t,n],Y(e.premovable.events.set,t,n,o)}(e,t,n,{ctrlKey:e.stats.ctrlKey}),ae(e),!0;return ae(e),!1}function oe(e,t,n,o){const s=e.pieces.get(t);s&&(function(e,t,n){const o=e.pieces.get(t);return!(!o||t!==n&&e.pieces.has(n)||"both"!==e.movable.color&&(e.movable.color!==o.color||e.turnColor!==o.color))}(e,t,n)||o)?(e.pieces.delete(t),ee(e,s,n,o),Y(e.movable.events.afterNewPiece,s.role,n,{premove:!1,predrop:!1})):s&&function(e,t,n){const o=e.pieces.get(t),s=e.pieces.get(n);return!!o&&(!s||s.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==o.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===o.color&&e.turnColor!==o.color}(e,t,n)?function(e,t,n){Z(e),e.predroppable.current={role:t,key:n},Y(e.predroppable.events.set,t,n)}(e,s.role,n):(Z(e),J(e)),e.pieces.delete(t),ae(e)}function se(e,t,n){if(Y(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled)return ae(e),void e.hold.cancel();if((e.selectable.enabled||n)&&e.selected!==t&&ne(e,e.selected,t))return void(e.stats.dragged=!1)}(ie(e,t)||le(e,t))&&(re(e,t),e.hold.start())}function re(e,t){e.selected=t,le(e,t)?e.premovable.dests=U(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function ae(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function ie(e,t){const n=e.pieces.get(t);return!!n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function ce(e,t,n){var o,s;return t!==n&&ie(e,t)&&(e.movable.free||!!(null===(s=null===(o=e.movable.dests)||void 0===o?void 0:o.get(t))||void 0===s?void 0:s.includes(n)))}function le(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function de(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],o=t[1];let s=!1;if(ce(e,n,o)){const t=te(e,n,o);if(t){const r={premove:!0};!0!==t&&(r.captured=t),Y(e.movable.events.after,n,o,r),s=!0}}return Z(e),s}function ue(e){Z(e),J(e),ae(e)}function he(e){e.movable.color=e.movable.dests=e.animation.current=void 0,ue(e)}function pe(e,t,n){let o=Math.floor(8*(e[0]-n.left)/n.width);t||(o=7-o);let s=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(s=7-s),o>=0&&o<8&&s>=0&&s<8?M([o,s]):void 0}function fe(e){return"white"===e.orientation}const me="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",ge={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},ve={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function be(e){"start"===e&&(e=me);const t=new Map;let n=7,o=0;for(const s of e)switch(s){case" ":return t;case"/":if(--n,n<0)return t;o=0;break;case"~":{const e=t.get(M([o,n]));e&&(e.promoted=!0);break}default:{const e=s.charCodeAt(0);if(e<57)o+=e-48;else{const e=s.toLowerCase();t.set(M([o,n]),{role:ge[e],color:s===e?"black":"white"}),++o}}}return t}function we(e,t){var n,o;if((null===(n=t.movable)||void 0===n?void 0:n.dests)&&(e.movable.dests=void 0),(null===(o=t.drawable)||void 0===o?void 0:o.autoShapes)&&(e.drawable.autoShapes=[]),ye(e,t),t.fen&&(e.pieces=be(t.fen),e.drawable.shapes=[]),"check"in t&&function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(const[n,o]of e.pieces)"king"===o.role&&o.color===t&&(e.check=n)}(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&re(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){const t="white"===e.movable.color?"1":"8",n="e"+t,o=e.movable.dests.get(n),s=e.pieces.get(n);if(!o||!s||"king"!==s.role)return;e.movable.dests.set(n,o.filter((e=>!(e==="a"+t&&o.includes("c"+t)||e==="h"+t&&o.includes("g"+t)))))}}function ye(e,t){for(const n in t)ke(e[n])&&ke(t[n])?ye(e[n],t[n]):e[n]=t[n]}function ke(e){return"object"==typeof e}function xe(e,t){return t.animation.enabled?function(e,t){const n=new Map(t.pieces),o=e(t),s=function(e,t){const n=new Map,o=[],s=new Map,r=[],a=[],i=new Map;let c,l,d;for(const[t,n]of e)i.set(t,Se(t,n));for(const e of P)c=t.pieces.get(e),l=i.get(e),c?l?N(c,l.piece)||(r.push(l),a.push(Se(e,c))):a.push(Se(e,c)):l&&r.push(l);for(const e of a)l=Pe(e,r.filter((t=>N(e.piece,t.piece)))),l&&(d=[l.pos[0]-e.pos[0],l.pos[1]-e.pos[1]],n.set(e.key,d.concat(d)),o.push(l.key));for(const e of r)o.includes(e.key)||s.set(e.key,e.piece);return{anims:n,fadings:s}}(n,t);if(s.anims.size||s.fadings.size){const e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:s},e||Me(t,performance.now())}else t.dom.redraw();return o}(e,t):Ce(e,t)}function Ce(e,t){const n=e(t);return t.dom.redraw(),n}function Se(e,t){return{key:e,pos:T(e),piece:t}}function Pe(e,t){return t.sort(((t,n)=>j(e.pos,t.pos)-j(e.pos,n.pos)))[0]}function Me(e,t){const n=e.animation.current;if(void 0===n)return void(e.dom.destroyed||e.dom.redrawNow());const o=1-(t-n.start)*n.frequency;if(o<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=(s=o)<.5?4*s*s*s:(s-1)*(2*s-2)*(2*s-2)+1;for(const e of n.plan.anims.values())e[2]=e[0]*t,e[3]=e[1]*t;e.dom.redrawNow(!0),requestAnimationFrame(((t=performance.now())=>Me(e,t)))}var s}const Te=["green","red","blue","yellow"];function _e(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?ae(e):ue(e);const n=K(t),o=pe(n,fe(e),e.dom.bounds());o&&(e.drawable.current={orig:o,pos:n,brush:Ne(t),snapToValidMove:e.drawable.defaultSnapToValidMove},Ie(e))}function Ie(e){requestAnimationFrame((()=>{const t=e.drawable.current;if(t){const n=pe(t.pos,fe(e),e.dom.bounds());n||(t.snapToValidMove=!1);const o=t.snapToValidMove?function(e,t,n,o){const s=T(e),r=_.filter((e=>X(s[0],s[1],e[0],e[1])||H(s[0],s[1],e[0],e[1]))),a=r.map((e=>W(M(e),n,o))).map((e=>j(t,e))),[,i]=a.reduce(((e,t,n)=>e[0]<t?e:[t,n]),[a[0],0]);return M(r[i])}(t.orig,t.pos,fe(e),e.dom.bounds()):n;o!==t.mouseSq&&(t.mouseSq=o,t.dest=o!==t.orig?o:void 0,e.dom.redrawNow()),Ie(e)}}))}function Oe(e,t){e.drawable.current&&(e.drawable.current.pos=K(t))}function je(e){const t=e.drawable.current;t&&(t.mouseSq&&function(e,t){const n=e=>e.orig===t.orig&&e.dest===t.dest,o=e.shapes.find(n);o&&(e.shapes=e.shapes.filter((e=>!n(e))));o&&o.brush===t.brush||e.shapes.push(t);Le(e)}(e.drawable,t),$e(e))}function $e(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Ne(e){var t;const n=(e.shiftKey||e.ctrlKey)&&D(e),o=e.altKey||e.metaKey||(null===(t=e.getModifierState)||void 0===t?void 0:t.call(e,"AltGraph"));return Te[(n?1:0)+(o?2:0)]}function Le(e){e.onChange&&e.onChange(e.shapes)}function Ae(e,t){if(!t.isTrusted||void 0!==t.button&&0!==t.button)return;if(t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),o=K(t),s=pe(o,fe(e),n);if(!s)return;const r=e.pieces.get(s),a=e.selected;var i;a||!e.drawable.enabled||!e.drawable.eraseOnClick&&r&&r.color===e.turnColor||(i=e).drawable.shapes.length&&(i.drawable.shapes=[],i.dom.redraw(),Le(i.drawable)),!1===t.cancelable||t.touches&&e.movable.color&&!r&&!a&&!function(e,t){const n=fe(e),o=e.dom.bounds(),s=Math.pow(o.width/8,2);for(const r in e.pieces){const e=W(r,n,o);if(j(e,t)<=s)return!0}return!1}(e,o)||t.preventDefault();const c=!!e.premovable.current,l=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&ce(e,e.selected,s)?xe((e=>se(e,s)),e):se(e,s);const d=e.selected===s,u=De(e,s);if(r&&u&&d&&function(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}(e,s)){e.draggable.current={orig:s,piece:r,origPos:o,pos:o,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:a,originTarget:t.target},u.cgDragging=!0,u.classList.add("dragging");const i=e.dom.elements.ghost;i&&(i.className=`ghost ${r.color} ${r.role}`,E(i,A(n)(T(s),fe(e))),B(i,!0)),Re(e)}else c&&Z(e),l&&J(e);e.dom.redraw()}function Re(e){requestAnimationFrame((()=>{var t;const n=e.draggable.current;if(!n)return;(null===(t=e.animation.current)||void 0===t?void 0:t.plan.anims.has(n.orig))&&(e.animation.current=void 0);const o=e.pieces.get(n.orig);if(o&&N(o,n.piece)){if(!n.started&&j(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if("function"==typeof n.element){const e=n.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),n.element=e}const t=e.dom.bounds();E(n.element,[n.pos[0]-t.left-t.width/16,n.pos[1]-t.top-t.height/16])}}else Be(e);Re(e)}))}function Ee(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=K(t))}function qe(e,t){const n=e.draggable.current;if(!n)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&n.originTarget!==t.target&&!n.newPiece)return void(e.draggable.current=void 0);Z(e),J(e);const o=pe(K(t)||n.pos,fe(e),e.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?oe(e,n.orig,o,n.force):(e.stats.ctrlKey=t.ctrlKey,ne(e,n.orig,o)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(n.orig),Y(e.events.change)),(n.orig!==n.previouslySelected||n.orig!==o&&o)&&e.selectable.enabled||ae(e),Ke(e),e.draggable.current=void 0,e.dom.redraw()}function Be(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,ae(e),Ke(e),e.dom.redraw())}function Ke(e){const t=e.dom.elements;t.ghost&&B(t.ghost,!1)}function De(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&"PIECE"===n.tagName)return n;n=n.nextSibling}}function Fe(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function We(e,t){function n(){!function(e){e.orientation=O(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}(e),t()}return{set(t){t.orientation&&t.orientation!==e.orientation&&n(),(t.fen?xe:Ce)((e=>we(e,t)),e)},state:e,getFen:()=>{return t=e.pieces,S.map((e=>x.map((n=>{const o=t.get(n+e);if(o){const e=ve[o.role];return"white"===o.color?e.toUpperCase():e}return"1"})).join(""))).join("/").replace(/1{2,}/g,(e=>e.length.toString()));var t},toggleOrientation:n,setPieces(t){xe((e=>function(e,t){for(const[n,o]of t)o?e.pieces.set(n,o):e.pieces.delete(n)}(e,t)),e)},selectSquare(t,n){t?xe((e=>se(e,t,n)),e):e.selected&&(ae(e),e.dom.redraw())},move(t,n){xe((e=>Q(e,t,n)),e)},newPiece(t,n){xe((e=>ee(e,t,n)),e)},playPremove(){if(e.premovable.current){if(xe(de,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const n=function(e,t){const n=e.predroppable.current;let o=!1;if(!n)return!1;t(n)&&ee(e,{role:n.role,color:e.movable.color},n.key)&&(Y(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),o=!0);return J(e),o}(e,t);return e.dom.redraw(),n}return!1},cancelPremove(){Ce(Z,e)},cancelPredrop(){Ce(J,e)},cancelMove(){Ce((e=>{ue(e),Be(e)}),e)},stop(){Ce((e=>{he(e),Be(e)}),e)},explode(t){!function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout((()=>{Fe(e,2),setTimeout((()=>Fe(e,void 0)),120)}),120)}(e,t)},setAutoShapes(t){Ce((e=>e.drawable.autoShapes=t),e)},setShapes(t){Ce((e=>e.drawable.shapes=t),e)},getKeyAtDomPos:t=>pe(t,fe(e),e.dom.bounds()),redrawAll:t,dragNewPiece(t,n,o){!function(e,t,n,o){const s="a0";e.pieces.set(s,t),e.dom.redraw();const r=K(n);e.draggable.current={orig:s,piece:t,origPos:r,pos:r,started:!0,element:()=>De(e,s),originTarget:n.target,newPiece:!0,force:!!o},Re(e)}(e,t,n,o)},destroy(){he(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Ge(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function He(e,t,n){const o=e.drawable,s=o.current,r=s&&s.mouseSq?s:void 0,a=new Map,i=e.dom.bounds();for(const e of o.shapes.concat(o.autoShapes).concat(r?[r]:[]))e.dest&&a.set(e.dest,(a.get(e.dest)||0)+1);const c=o.shapes.concat(o.autoShapes).map((e=>({shape:e,current:!1,hash:Ve(e,a,!1,i)})));r&&c.push({shape:r,current:!0,hash:Ve(r,a,!0,i)});const l=c.map((e=>e.hash)).join(";");if(l===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=l;const d=t.querySelector("defs"),u=t.querySelector("g"),h=n.querySelector("g");!function(e,t,n){const o=new Map;let s;for(const n of t)n.shape.dest&&(s=e.brushes[n.shape.brush],n.shape.modifiers&&(s=et(s,n.shape.modifiers)),o.set(s.key,s));const r=new Set;let a=n.firstChild;for(;a;)r.add(a.getAttribute("cgKey")),a=a.nextSibling;for(const[e,t]of o.entries())r.has(e)||n.appendChild(Ze(t))}(o,c,d),ze(e,c.filter((e=>!e.shape.customSvg)),o.brushes,a,u),ze(e,c.filter((e=>e.shape.customSvg)),o.brushes,a,h)}function ze(e,t,n,o,s){const r=e.dom.bounds(),a=new Map,i=[];for(const e of t)a.set(e.hash,!1);let c,l=s.firstChild;for(;l;)c=l.getAttribute("cgHash"),a.has(c)?a.set(c,!0):i.push(l),l=l.nextSibling;for(const e of i)s.removeChild(e);for(const i of t)a.get(i.hash)||s.appendChild(Ye(e,i,n,o,r))}function Ve({orig:e,dest:t,brush:n,piece:o,modifiers:s,customSvg:r},a,i,c){return[c.width,c.height,i,e,t,n,t&&(a.get(t)||0)>1,o&&Xe(o),s&&(l=s,""+(l.lineWidth||"")),r&&Ue(r)].filter((e=>e)).join(",");var l}function Xe(e){return[e.color,e.role,e.scale].filter((e=>e)).join(",")}function Ue(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return"custom-"+t.toString()}function Ye(e,{shape:t,current:n,hash:o},s,r,a){let i;if(t.customSvg){const n=Qe(T(t.orig),e.orientation);i=function(e,t,n){const{width:o,height:s}=n,r=o/8,a=s/8,i=t[0]*r,c=(7-t[1])*a,l=Je(Ge("g"),{transform:`translate(${i},${c})`}),d=Je(Ge("svg"),{width:r,height:a,viewBox:"0 0 100 100"});return l.appendChild(d),d.innerHTML=e,l}(t.customSvg,n,a)}else if(t.piece)i=function(e,t,n,o){const s=ot(t,o),r=o.width/8*(n.scale||1),a=n.color[0]+("knight"===n.role?"n":n.role[0]).toUpperCase();return Je(Ge("image"),{className:`${n.role} ${n.color}`,x:s[0]-r/2,y:s[1]-r/2,width:r,height:r,href:e+a+".svg"})}(e.drawable.pieces.baseUrl,Qe(T(t.orig),e.orientation),t.piece,a);else{const o=Qe(T(t.orig),e.orientation);if(t.dest){let c=s[t.brush];t.modifiers&&(c=et(c,t.modifiers)),i=function(e,t,n,o,s,r){const a=function(e,t){return(t?20:10)/512*e.width}(r,s&&!o),i=ot(t,r),c=ot(n,r),l=c[0]-i[0],d=c[1]-i[1],u=Math.atan2(d,l),h=Math.cos(u)*a,p=Math.sin(u)*a;return Je(Ge("line"),{stroke:e.color,"stroke-width":tt(e,o,r),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:nt(e,o),x1:i[0],y1:i[1],x2:c[0]-h,y2:c[1]-p})}(c,o,Qe(T(t.dest),e.orientation),n,(r.get(t.dest)||0)>1,a)}else i=function(e,t,n,o){const s=ot(t,o),r=function(e){const t=e.width/512;return[3*t,4*t]}(o),a=(o.width+o.height)/32;return Je(Ge("circle"),{stroke:e.color,"stroke-width":r[n?0:1],fill:"none",opacity:nt(e,n),cx:s[0],cy:s[1],r:a-r[1]/2})}(s[t.brush],o,n,a)}return i.setAttribute("cgHash",o),i}function Ze(e){const t=Je(Ge("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(Je(Ge("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function Je(e,t){for(const n in t)e.setAttribute(n,t[n]);return e}function Qe(e,t){return"white"===t?e:[7-e[0],7-e[1]]}function et(e,t){return{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter((e=>e)).join("")}}function tt(e,t,n){return(e.lineWidth||10)*(t?.85:1)/512*n.width}function nt(e,t){return(e.opacity||1)*(t?.9:1)}function ot(e,t){return[(e[0]+.5)*t.width/8,(7.5-e[1])*t.height/8]}function st(e,t){const n=F("coords",t);let o;for(const t of e)o=F("coord"),o.textContent=t,n.appendChild(o);return n}function rt(e,t){const n=e.dom.elements.board;if(!e.dom.relative&&e.resizable&&"ResizeObserver"in window){new window.ResizeObserver(t).observe(n)}if(e.viewOnly)return;const o=function(e){return t=>{e.draggable.current?Be(e):e.drawable.current?$e(e):t.shiftKey||D(t)?e.drawable.enabled&&_e(e,t):e.viewOnly||(e.dropmode.active?function(e,t){if(!e.dropmode.active)return;Z(e),J(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const o=K(t),s=o&&pe(o,fe(e),e.dom.bounds());s&&oe(e,"a0",s)}e.dom.redraw()}(e,t):Ae(e,t))}}(e);n.addEventListener("touchstart",o,{passive:!1}),n.addEventListener("mousedown",o,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",(e=>e.preventDefault()))}function at(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function it(e,t,n){return o=>{e.drawable.current?e.drawable.enabled&&n(e,o):e.viewOnly||t(e,o)}}function ct(e){const t=fe(e),n=e.dom.relative?R:A(e.dom.bounds()),o=e.dom.relative?q:E,s=e.dom.elements.board,r=e.pieces,a=e.animation.current,i=a?a.plan.anims:new Map,c=a?a.plan.fadings:new Map,l=e.draggable.current,d=function(e){var t;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const t of e.lastMove)ft(n,t,"last-move");e.check&&e.highlight.check&&ft(n,e.check,"check");if(e.selected&&(ft(n,e.selected,"selected"),e.movable.showDests)){const o=null===(t=e.movable.dests)||void 0===t?void 0:t.get(e.selected);if(o)for(const t of o)ft(n,t,"move-dest"+(e.pieces.has(t)?" oc":""));const s=e.premovable.dests;if(s)for(const t of s)ft(n,t,"premove-dest"+(e.pieces.has(t)?" oc":""))}const o=e.premovable.current;if(o)for(const e of o)ft(n,e,"current-premove");else e.predroppable.current&&ft(n,e.predroppable.current.key,"current-premove");const s=e.exploding;if(s)for(const e of s.keys)ft(n,e,"exploding"+s.stage);return n}(e),u=new Set,h=new Set,p=new Map,f=new Map;let m,g,v,b,w,y,k,x,C,S;for(g=s.firstChild;g;){if(m=g.cgKey,lt(g))if(v=r.get(m),w=i.get(m),y=c.get(m),b=g.cgPiece,!g.cgDragging||l&&l.orig===m||(g.classList.remove("dragging"),o(g,n(T(m),t)),g.cgDragging=!1),!y&&g.cgFading&&(g.cgFading=!1,g.classList.remove("fading")),v){if(w&&g.cgAnimating&&b===pt(v)){const e=T(m);e[0]+=w[2],e[1]+=w[3],g.classList.add("anim"),o(g,n(e,t))}else g.cgAnimating&&(g.cgAnimating=!1,g.classList.remove("anim"),o(g,n(T(m),t)),e.addPieceZIndex&&(g.style.zIndex=ht(T(m),t)));b!==pt(v)||y&&g.cgFading?y&&b===pt(y)?(g.classList.add("fading"),g.cgFading=!0):mt(p,b,g):u.add(m)}else mt(p,b,g);else if(dt(g)){const e=g.className;d.get(m)===e?h.add(m):mt(f,e,g)}g=g.nextSibling}for(const[e,r]of d)if(!h.has(e)){C=f.get(r),S=C&&C.pop();const a=n(T(e),t);if(S)S.cgKey=e,o(S,a);else{const t=F("square",r);t.cgKey=e,o(t,a),s.insertBefore(t,s.firstChild)}}for(const[a,c]of r)if(w=i.get(a),!u.has(a))if(k=p.get(pt(c)),x=k&&k.pop(),x){x.cgKey=a,x.cgFading&&(x.classList.remove("fading"),x.cgFading=!1);const s=T(a);e.addPieceZIndex&&(x.style.zIndex=ht(s,t)),w&&(x.cgAnimating=!0,x.classList.add("anim"),s[0]+=w[2],s[1]+=w[3]),o(x,n(s,t))}else{const r=pt(c),i=F("piece",r),l=T(a);i.cgPiece=r,i.cgKey=a,w&&(i.cgAnimating=!0,l[0]+=w[2],l[1]+=w[3]),o(i,n(l,t)),e.addPieceZIndex&&(i.style.zIndex=ht(l,t)),s.appendChild(i)}for(const t of p.values())ut(e,t);for(const t of f.values())ut(e,t)}function lt(e){return"PIECE"===e.tagName}function dt(e){return"SQUARE"===e.tagName}function ut(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function ht(e,t){let n=2+8*e[1]+(7-e[0]);return t&&(n=67-n),n+""}function pt(e){return`${e.color} ${e.role}`}function ft(e,t,n){const o=e.get(t);o?e.set(t,`${o} ${n}`):e.set(t,n)}function mt(e,t,n){const o=e.get(t);o?o.push(n):e.set(t,[n])}function gt(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame((()=>{e(),t=!1})))}}function vt(e,t){let n,o=0;return function(...s){const r=this,a=performance.now()-o;function i(){n=void 0,o=performance.now(),t.apply(r,s)}n&&clearTimeout(n),a>e?i():n=setTimeout(i,e-a)}}const bt=e=>{let t=e;return function(e){return(e=>void 0!==e)(e)&&(t=e),t}},wt={Accept:"application/vnd.lichess.v5+json"},yt={cache:"no-cache",credentials:"same-origin"},kt={"X-Requested-With":"XMLHttpRequest"},xt=(e,t={})=>fetch(e,Object.assign(Object.assign(Object.assign({},yt),{headers:Object.assign(Object.assign({},wt),kt)}),t)).then((e=>{if(e.ok)return e.json();throw e.statusText})),Ct=(e,t={})=>St(e,t).then((e=>{if(e.ok)return e.text();throw e.statusText})),St=(e,t={})=>fetch(e,Object.assign(Object.assign(Object.assign({},yt),{headers:Object.assign({},kt)}),t)),Pt=e=>{const t=new FormData;for(const n of Object.keys(e))t.append(n,e[n]);return t};function Mt(e){return"absent"==e||"late"==e||"bye"==e}const Tt=()=>lichess.reload();var _t={join:vt(1e3,((e,t)=>xt(`/swiss/${e.data.id}/join`,{method:"post",body:JSON.stringify({password:t||""}),headers:{"Content-Type":"application/json"}}).catch(Tt))),withdraw:vt(1e3,(e=>xt(`/swiss/${e.data.id}/withdraw`,{method:"post"}).catch(Tt))),loadPage:vt(1e3,((e,t)=>xt(`/swiss/${e.data.id}/standing/${t}`).then((t=>{e.loadPage(t),e.redraw()})))),loadPageOf:(e,t)=>xt(`/swiss/${e.data.id}/page-of/${t}`),reloadNow:e=>xt(`/swiss/${e.data.id}?page=${e.focusOnMe?"":e.page}&playerInfo=${e.playerInfoId||""}`).then((t=>{e.reload(t),e.redraw()}),Tt),playerInfo:(e,t)=>xt(`/swiss/${e.data.id}/player/${t}`).then((t=>{e.data.playerInfo=t,e.redraw()}),Tt),readSheetMin:e=>e?e.split("|").map((e=>Mt(e)?e:{g:e.slice(0,8),o:"o"==e[8],w:"w"==e[8]||"l"!=e[8]&&void 0})):[]};let It=!1;const Ot=e=>(!1===It&&(It=window.Intl&&Intl.NumberFormat?new Intl.NumberFormat:null),null===It?""+e:It.format(e));function jt(e,t,n){return $t((o=>o.addEventListener(e,(e=>{const o=t(e);return n&&n(),o}))))}function $t(e){return{insert(t){e(t.elm)}}}function Nt(e){return{"data-icon":e}}const Lt=e=>e.title?[p("span.utitle",e.title)," "+e.name]:[e.name];function At(e,t,n){return p("a.ulpt.user-link"+(((e.user.title||"")+e.user.name).length>15?".long":""),{attrs:t?{href:"/@/"+e.user.name}:{"data-href":"/@/"+e.user.name},hook:{destroy:e=>$.powerTip.destroy(e.elm)}},[p("span.name",Lt(e.user)),n?p("span.rating"," "+e.rating+(e.provisional?"?":"")):null])}function Rt(e,t,n){return p("tr",[p("th",e),p("td","raw"===n?t:"percent"===n?t[1]>0?(o=t[0]/t[1],Math.round(100*o)+"%"):0:Ot(t))]);var o}function Et(){return p("div.spinner",[p("svg",{attrs:{viewBox:"0 0 40 40"}},[p("circle",{attrs:{cx:20,cy:20,r:18,fill:"none"}})])])}function qt(e){return p("button.fbt",{class:{active:e.searching},attrs:{"data-icon":e.searching?"L":"y",title:"Search tournament players"},hook:jt("click",e.toggleSearch,e.redraw)})}function Bt(e){return p("div.search",p("input",{hook:$t((t=>lichess.userComplete().then((n=>{n({input:t,swiss:e.data.id,tag:"span",focus:!0,onSelect(t){e.jumpToPageOf(t.id),e.redraw()}}),t.focus()}))))}))}function Kt(e,t,n,o,s){return p("button.fbt.is",{attrs:{"data-icon":t,disabled:!o,title:e},hook:jt("mousedown",n,s.redraw)})}function Dt(e){return e.data.me?p("button.fbt"+(e.focusOnMe?".active":""),{attrs:{"data-icon":"7",title:"Scroll to your player"},hook:jt("mousedown",e.toggleFocusOnMe,e.redraw)}):void 0}function Ft(e,t){const n=!!t.currentPageResults,o=e.page;return t.nbPages>-1?[qt(e),...e.searching?[Bt(e)]:[Kt("First","W",(()=>e.userSetPage(1)),n&&o>1,e),Kt("Prev","Y",e.userPrevPage,n&&o>1,e),p("span.page",(t.nbResults?t.from+1:0)+"-"+t.to+" / "+t.nbResults),Kt("Next","X",e.userNextPage,n&&o<t.nbPages,e),Kt("Last","V",e.userLastPage,n&&o<t.nbPages,e),Dt(e)]]:[]}function Wt(e){const t=e.page,n=e.data.nbPlayers;return{currentPage:t,maxPerPage:10,from:10*(t-1),to:Math.min(n,10*t),currentPageResults:e.pages[t],nbResults:n,nbPages:Math.ceil(n/10)}}class Gt{constructor(e,t){this.opts=e,this.redraw=t,this.pages={},this.joinSpinner=!1,this.disableClicks=!0,this.searching=!1,this.lastStorage=lichess.storage.make("last-redirect"),this.reload=e=>{this.data=Object.assign(Object.assign({},this.data),this.readData(e)),this.data.me=e.me,this.data.nextRound=e.nextRound,this.loadPage(this.data.standing),this.focusOnMe&&this.scrollToMe(),this.joinSpinner=!1,this.redirectToMyGame(),this.redrawNbRounds()},this.isCreated=()=>"created"==this.data.status,this.isStarted=()=>"started"==this.data.status,this.isFinished=()=>"finished"==this.data.status,this.myGameId=()=>{var e;return null===(e=this.data.me)||void 0===e?void 0:e.gameId},this.join=e=>{_t.join(this,e),this.joinSpinner=!0,this.focusOnMe=!0},this.redirectFirst=(e,t)=>{const n=t||document.hasFocus()?10:1e3+500*Math.random();setTimeout((()=>{this.lastStorage.get()!==e&&(this.lastStorage.set(e),lichess.redirect("/"+e))}),n)},this.scrollToMe=()=>{const e=(t=this).data.me?Math.floor((t.data.me.rank-1)/10)+1:void 0;var t;e&&e!==this.page&&this.setPage(e)},this.loadPage=e=>{this.pages[e.page]=this.readStanding(e).players},this.setPage=e=>{this.page=e,_t.loadPage(this,e)},this.toggleFocusOnMe=()=>{this.data.me&&(this.focusOnMe=!this.focusOnMe,this.focusOnMe&&this.scrollToMe())},this.toggleSearch=()=>this.searching=!this.searching,this.jumpToPageOf=e=>{const t=e.toLowerCase();_t.loadPageOf(this,t).then((e=>{this.loadPage(e),this.page=e.page,this.searching=!1,this.focusOnMe=!1,this.pages[this.page].filter((e=>e.user.id==t)).forEach(this.showPlayerInfo),this.redraw()}))},this.userSetPage=e=>{this.focusOnMe=!1,this.setPage(e)},this.userNextPage=()=>this.userSetPage(this.page+1),this.userPrevPage=()=>this.userSetPage(this.page-1),this.userLastPage=()=>this.userSetPage(Wt(this).nbPages),this.showPlayerInfo=e=>{this.playerInfoId=this.playerInfoId===e.user.id?void 0:e.user.id,this.playerInfoId&&_t.playerInfo(this,this.playerInfoId)},this.askReload=()=>{this.joinSpinner||this.data.nextRound&&this.data.me?_t.reloadNow(this):this.reloadSoon()},this.withdraw=()=>{_t.withdraw(this),this.joinSpinner=!0},this.reloadSoon=()=>{this.reloadSoonThrottle||(this.reloadSoonThrottle=vt(Math.max(2e3,Math.min(5e3,20*this.data.nbPlayers)),(()=>_t.reloadNow(this)))),this.reloadSoonThrottle()},this.isIn=()=>!!this.data.me&&!this.data.me.absent,this.redrawNbRounds=()=>$(".swiss__meta__round").text(`${this.data.round}/${this.data.nbRounds}`),this.readData=e=>Object.assign(Object.assign({},e),{standing:this.readStanding(e.standing)}),this.readStanding=e=>Object.assign(Object.assign({},e),{players:e.players.map((e=>Object.assign(Object.assign({},e),{sheet:_t.readSheetMin(e.sheetMin)})))}),this.data=this.readData(e.data),this.trans=lichess.trans(e.i18n),this.socket=function(e,t){const n={reload(){const e=Math.min(10*t.data.nbPlayers,4e3);e>500?setTimeout(t.askReload,Math.floor(Math.random()*e)):t.askReload()},redirect:e=>(t.redirectFirst(e.slice(0,8),!0),!0)};return{send:e,receive:(e,t)=>!!n[e]&&n[e](t)}}(e.socketSend,this),this.page=this.data.standing.page,this.focusOnMe=this.isIn(),setTimeout((()=>this.disableClicks=!1),1500),this.loadPage(this.data.standing),this.scrollToMe(),this.redirectToMyGame()}redirectToMyGame(){const e=this.myGameId();e&&this.redirectFirst(e)}}function Ht(e,t){const n=e.substring(0,14);return p("a",{class:{"user-link":!0,ulpt:!0},attrs:{href:"/@/"+e}},t&&"BOT"!=t?[p("span.utitle",t),n]:[n])}function zt(e,t){return{insert(n){n.elm.addEventListener(e,t)}}}const Vt={start:["hi/Hello","gl/Good luck","hf/Have fun!","u2/You too!"].map(Xt),end:["gg/Good game","wp/Well played","ty/Thank you","gtg/I've got to go","bye/Bye!"].map(Xt)};function Xt(e){const t=e.split("/");return{key:t[0],text:t[1]}}const Ut=e=>Ct(Yt(e)),Yt=e=>`/${e}/note`;function Zt(e){let t=e.text;const n=function(e,t,n=!1){let o,s=0;return function(...r){const a=this;o&&clearTimeout(o),o=void 0;const i=performance.now()-s;s=performance.now(),n&&i>t?e.apply(a,r):o=setTimeout((()=>{o=void 0,e.apply(a,r)}),t)}}((()=>{((e,t)=>{xt(Yt(e),{method:"post",body:Pt({text:t})})})(e.id,t||"")}),1e3);return{id:e.id,trans:e.trans,text:()=>t,fetch(){Ut(e.id).then((n=>{t=n||"",e.redraw()}))},post(e){t=e,n()}}}function Jt(e){const t=e.text();return null==t?p("div.loading",{hook:{insert:e.fetch}}):p("textarea",{attrs:{placeholder:e.trans("typePrivateNotesHere")},hook:{insert(n){const o=$(n.elm);o.val(t).on("change keyup paste",(()=>e.post(o.val())))}}})}function Qt(e){let t,n=!1;const o=()=>{t=void 0,n=!1,e.redraw()};return{loading:()=>n,data:()=>t,reasons:e.reasons,permissions:()=>e.permissions,open:o=>{const s=o.querySelector("a.user-link"),r=o.querySelector("t").innerText,a=s.href.split("/")[4];e.permissions.timeout?(n=!0,(e=>xt("/mod/chat-user/"+e))(a).then((o=>{t=Object.assign(Object.assign({},o),{text:r}),n=!1,e.redraw()}))):t={id:a.toLowerCase(),username:a,text:r},e.redraw()},close:o,timeout(n,s){t&&lichess.pubsub.emit("socket.send","timeout",{userId:t.id,reason:n.key,text:s}),o(),e.redraw()}}}const en=()=>p("i.mod",{attrs:{"data-icon":""}});function tn(e,t){const n=e.data;n.domVersion=1;const o={instance:void 0,loaded:!1,enabled:bt(!!n.palantir)},s=["discussion"];e.noteId&&s.push("note"),e.plugin&&s.push(e.plugin.tab.key);const r=lichess.storage.make("chat.tab"),a=r.get();let i;const c={tab:s.find((e=>e===a))||s[0],enabled:e.alwaysEnabled||!lichess.storage.get("nochat"),placeholderKey:"talkInChat",loading:!1,timeout:e.timeout,writeable:e.writeable};s.length>1&&"discussion"===c.tab&&lichess.storage.get("nochat")&&(c.tab=s[1]);const l=e=>!!(e=e.trim())&&(!("You too!"==e&&!n.lines.some((e=>e.u!=n.userId)))&&(e.length>140?(alert("Max length: 140 chars. "+e.length+" chars used."),!1):(lichess.pubsub.emit("socket.send","talk",e),!0))),d=lichess.trans(e.i18n);function u(){(e.permissions.timeout||e.permissions.local)&&(i=Qt({reasons:e.timeoutReasons||[{key:"other",name:"Inappropriate behavior"}],permissions:e.permissions,redraw:t}),e.loadCss("chat.mod"))}u();const h=e.noteId?Zt({id:e.noteId,text:e.noteText,trans:d,redraw:t}):void 0,p=function(e){let t=e.initialGroup,n=[];return{group:()=>t,said:()=>n,setGroup(o){o!==t&&(t=o,o||(n=[]),e.redraw())},post(o){t&&Vt[t]&&(n.includes(o.key)||e.post(o.text)&&n.push(o.key))}}}({initialGroup:e.preset,post:l,redraw:t}),f=[["socket.in.message",e=>{n.lines.push(e);const o=n.lines.length;o>200&&(n.lines.splice(0,o-200+50),n.domVersion++),t()}],["socket.in.chat_timeout",e=>{let o=!1;n.lines.forEach((t=>{t.u&&t.u.toLowerCase()==e&&(t.d=!0,o=!0)})),e==n.userId&&(c.timeout=o=!0),o&&(n.domVersion++,t())}],["socket.in.chat_reinstate",e=>{e==n.userId&&(c.timeout=!1,t())}],["chat.writeable",e=>{c.writeable=e,t()}],["chat.permissions",n=>{let o;for(o in n)e.permissions[o]=n[o];u(),t()}],["palantir.toggle",o.enabled]];f.forEach((([e,t])=>lichess.pubsub.on(e,t)));const m=()=>lichess.pubsub.emit("chat.enabled",c.enabled);return m(),{data:n,opts:e,vm:c,allTabs:s,setTab(e){c.tab=e,r.set(e),"discussion"===e&&lichess.requestIdleCallback((()=>$(".mchat__say").each((function(){this.focus()}))),500),t()},moderation:()=>i,note:h,preset:p,post:l,trans:d,plugin:e.plugin,setEnabled(e){c.enabled=e,m(),e?lichess.storage.remove("nochat"):lichess.storage.set("nochat","1"),t()},redraw:t,palantir:o,destroy:()=>{f.forEach((([e,t])=>lichess.pubsub.off(e,t)))}}}const nn=/(^|[^\w@#/])@([a-z0-9][a-z0-9_-]{0,28}[a-z0-9])/gi;function on(e,t,n){return e.includes("&quot;")?e:`<a target="_blank" rel="noopener nofollow noreferrer" href="${e.startsWith("/")||e.includes("://")?e:"//"+e}"${n?` class="${n}"`:""}>${t||e}</a>`}const sn=/\b\b(?:https?:\/\/)?(lichess\.org\/[-–—\w+&'@#\/%?=()~|!:,.;]+[\w+&@#\/%=~|])/gi,rn=/^[a-h][2-7]$/,an=/\b(\d+)\s*(\.+)\s*(?:[o0-]+[o0]|[NBRQKP\u2654\u2655\u2656\u2657\u2658\u2659]?[a-h]?[1-8]?[x@]?[a-z][1-8](?:=[NBRQK\u2654\u2655\u2656\u2657\u2658\u2659])?)\+?#?[!\?=]{0,5}/gi;function cn(e,t,n){if(t<1||t>200)return e;return'<a class="jump" data-ply="'+(2*t-(n.length>1?0:1))+'">'+e+"</a>"}function ln(e,t,n){return n.match(rn)?e:function(e,t,n){return t+on("/@/"+n,"@"+n)}(0,t,n)}function dn(e,t){const n=lichess.escapeHtml(e),o=n.replace(nn,ln).replace(sn,on);return t&&o===n?o.replace(an,cn):o}const un=()=>"1"==lichess.storage.get("chat-spam"),hn=new RegExp(["xcamweb.com","(^|[^i])chess-bot","chess-cheat","coolteenbitch","letcafa.webcam","tinyurl.com/","wooga.info/","bit.ly/","wbt.link/","eb.by/","001.rs/","shr.name/","u.to/",".3-a.net",".ssl443.org",".ns02.us",".myftp.info",".flinkup.com",".serveusers.com","badoogirls.com","hide.su","wyon.de","sexdatingcz.club","qps.ru","tiny.cc/"].map((e=>e.replace(/\./g,"\\.").replace(/\//g,"\\/"))).join("|")),pn=e=>!!e.match(hn),fn=/follow me|join my team/i,mn=e=>!!e.match(fn),gn=/lichess\.org\/team\//i,vn=/^\/[wW](?:hisper)?\s/;function bn(e){if(!e.vm.enabled)return[];const t=t=>{const n=t.elm;if(e.data.lines.length>5){(0===n.scrollTop||n.scrollTop>n.scrollHeight-n.clientHeight-100)&&(n.scrollTop=999999,setTimeout((e=>n.scrollTop=999999),300))}},n=!!e.moderation(),o=[p("ol.mchat__messages.chat-v-"+e.data.domVersion,{attrs:{role:"log","aria-live":"polite","aria-atomic":"false"},hook:{insert(o){const s=$(o.elm).on("click","a.jump",(e=>{lichess.pubsub.emit("jump",e.target.getAttribute("data-ply"))}));n?s.on("click",".mod",(t=>{var n;return null===(n=e.moderation())||void 0===n?void 0:n.open(t.target.parentNode)})):s.on("click",".flag",(t=>function(e,t){const n=t.querySelector("a.user-link"),o=t.querySelector("t").innerText;n&&confirm(`Report "${o}" to moderators?`)&&((e,t,n)=>{xt("/report/flag",{method:"post",body:Pt({username:t,resource:e,text:n})})})(e.data.resourceId,n.href.split("/")[4],o)}(e,t.target.parentNode))),t(o)},postpatch:(e,n)=>t(n)}},xn(e).map((t=>function(e,t){const n=function(e,t){if(n=e,/(\n|(@|#|\.)\w{2,})/.test(n)){const n=function(e){return(t,n)=>{n.data.lichessChat!==t.data.lichessChat&&(n.elm.innerHTML=dn(n.data.lichessChat,e))}}(t);return p("t",{lichessChat:e,hook:{create:n,update:n}})}var n;return p("t",e)}(t.t,e.opts.parseMoves);if("lichess"===t.u)return p("li.system",n);if(t.c)return p("li",[p("span.color","["+t.c+"]"),n]);const o=(s="a",r=t.u,a=Ht,i=[t.u,t.title],void 0===i&&(i=a,a=r,r=void 0),p(s,{key:r,hook:{init:m,prepatch:g},fn:a,args:i}));var s,r,a,i;return p("li",e.moderation()?[t.u?en():null,o," ",n]:[e.data.userId&&t.u&&e.data.userId!=t.u?p("i.flag",{attrs:{"data-icon":"!",title:"Report"}}):null,o," ",n])}(e,t)))),wn(e)],s=function(e){const t=e.group();if(!t)return;const n=Vt[t],o=e.said();return n&&o.length<2?p("div.mchat__presets",n.map((t=>{const n=o.includes(t.key);return p("span",{class:{disabled:n},attrs:{title:t.text,disabled:n},hook:zt("click",(()=>{!n&&e.post(t)}))},t.key)}))):void 0}(e.preset);return s&&o.push(s),o}function wn(e){if(!e.vm.writeable)return;if(e.data.loginRequired&&!e.data.userId||e.data.restricted)return p("input.mchat__say",{attrs:{placeholder:e.trans("loginToChat"),disabled:!0}});let t;return t=e.vm.timeout?e.trans("youHaveBeenTimedOut"):e.opts.blind?"Chat":e.trans.noarg(e.vm.placeholderKey),p("input.mchat__say",{attrs:{placeholder:t,autocomplete:"off",maxlength:140,disabled:e.vm.timeout||!e.vm.writeable,"aria-label":"Chat input"},hook:{insert(t){kn(e,t.elm)}}})}let yn;const kn=(e,t)=>{const n=lichess.tempStorage.make("chat.input"),o=n.get();o&&(t.value=o,t.focus(),!e.opts.public&&o.match(vn)&&t.classList.add("whisper")),t.addEventListener("keydown",(t=>{"Enter"===t.key&&setTimeout((()=>{const o=t.target,s=o.value,r=e.opts.public;""===s?$(".keyboard-move input").each((function(){this.focus()})):(e.opts.kobold||(e=>{if(un())return;const t=pn(e);t&&Ct(`/jslog/${window.location.href.substr(-12)}?n=spam`,{method:"post"}),(t||mn(e))&&lichess.storage.set("chat-spam","1")})(s),r&&(e=>!!e.match(gn))(s)?alert("Please don't advertise teams in the chat."):e.post(s),o.value="",n.remove(),r||o.classList.remove("whisper"))}))})),t.addEventListener("input",(t=>setTimeout((()=>{const o=t.target,s=o.value;o.removeAttribute("placeholder"),e.opts.public||o.classList.toggle("whisper",!!s.match(vn)),n.set(s)})))),window.Mousetrap.bind("c",(()=>t.focus()));const s=["touchstart","mousedown"];yn&&s.forEach((e=>document.body.removeEventListener(e,yn,{capture:!0}))),yn=e=>{e.shiftKey||2===e.buttons||2===e.button||t.blur()},t.onfocus=()=>s.forEach((e=>document.body.addEventListener(e,yn,{passive:!0,capture:!0}))),t.onblur=()=>s.forEach((e=>document.body.removeEventListener(e,yn,{capture:!0})))};function xn(e){const t=[];let n;return e.data.lines.forEach((o=>{var s,r,a;o.d||n&&(a=o,(r=n).d&&a.d&&r.u===a.u)||o.r&&(o.u||"").toLowerCase()!=e.data.userId||(s=o.t,(pn(s)||mn(s))&&!un())||t.push(o),n=o})),t}function Cn(e){const t=e.moderation();return p("section.mchat"+(e.opts.alwaysEnabled?"":".mchat-optional"),{class:{"mchat-mod":!!t},hook:{destroy:e.destroy}},function(e){if(!e)return;if(e.loading())return[p("div.loading")];const t=e.data();if(!t)return;const n=e.permissions(),o=t.history?p("div.infos.block",[Ot(t.games||0)+" games",t.troll?"TROLL":void 0,t.engine?"ENGINE":void 0,t.booster?"BOOSTER":void 0].map((e=>e&&p("span",e))).concat([p("a",{attrs:{href:"/@/"+t.username+"?mod"}},"profile")]).concat(n.shadowban?[p("a",{attrs:{href:"/mod/"+t.username+"/communication"}},"coms")]:[])):void 0,s=n.timeout?p("div.timeout.block",[p("strong","Timeout 15 minutes for"),...e.reasons.map((n=>p("a.text",{attrs:{"data-icon":"p"},hook:zt("click",(()=>e.timeout(n,t.text)))},n.name)))]):p("div.timeout.block",[p("strong","Moderation"),p("a.text",{attrs:{"data-icon":"p"},hook:zt("click",(()=>e.timeout(e.reasons[0],t.text)))},"Timeout 15 minutes")]),r=t.history?p("div.history.block",[p("strong","Timeout history"),p("table",p("tbody.slist",{hook:{insert(){lichess.contentLoaded()}}},t.history.map((function(e){return p("tr",[p("td.reason",e.reason),p("td.mod",e.mod),p("td",p("time.timeago",{attrs:{datetime:e.date}}))])}))))]):void 0;return[p("div.top",{key:"mod-"+t.id},[p("span.text",{attrs:{"data-icon":""}},[Ht(t.username)]),p("a",{attrs:{"data-icon":"L"},hook:zt("click",e.close)})]),p("div.mchat__content.moderation",[p("i.line-text.block",['"',t.text,'"']),o,s,r])]}(t)||function(e){const t=e.vm.tab;return[p("div.mchat__tabs.nb_"+e.allTabs.length,[...e.allTabs.map((n=>function(e,t,n){return p("div.mchat__tab."+t,{class:{"mchat__tab-active":t===n},hook:zt("click",(()=>e.setTab(t)))},function(e,t){return"discussion"===t?[p("span",e.data.name),e.opts.alwaysEnabled?void 0:p("input",{attrs:{type:"checkbox",title:e.trans.noarg("toggleTheChat"),checked:e.vm.enabled},hook:zt("change",(t=>{e.setEnabled(t.target.checked)}))})]:"note"===t?[p("span",e.trans.noarg("notes"))]:e.plugin&&t===e.plugin.tab.key?[p("span",e.plugin.tab.name)]:[]}(e,t))}(e,n,t))),Sn(e)]),p("div.mchat__content."+t,"note"===t&&e.note?[Jt(e.note)]:e.plugin&&t===e.plugin.tab.key?[e.plugin.view()]:bn(e))]}(e))}function Sn(e){const t=e.palantir;if(t.enabled())return t.instance?t.instance.render(p):p("div.mchat__tab.palantir.palantir-slot",{attrs:{"data-icon":"",title:"Voice chat"},hook:zt("click",(()=>{t.loaded||(t.loaded=!0,lichess.loadScript("javascripts/vendor/peerjs.min.js").then((()=>{lichess.loadModule("palantir").then((()=>{t.instance=window.Palantir.palantir({uid:e.data.userId,redraw:e.redraw}),e.redraw()}))})))}))})}function Pn(e){const t=e.data.nextRound;var n;if(t)return t.in>86400?p("div.clock",[p("time.timeago.shy",{attrs:{datetime:Date.now()+1e3*t.in},hook:{insert(e){e.elm.setAttribute("datetime",""+(Date.now()+1e3*t.in))}}})]):p(`div.clock.clock-created.time-cache-${t.at}`,[p("span.shy","created"==e.data.status?"Starting in":"Next round"),p("span.time.text",{hook:(n=t.in+1,{insert:e=>$(e.elm).clock({time:n})})})])}function Mn(e){const t=e.data.nbOngoing;return t?p("div.ongoing",[p("span.nb",[t]),p("span.shy","Ongoing games")]):void 0}function Tn(e){const t=e.data.greatPlayer;return p("div.swiss__main__header",[p("i.img",Nt("g")),p("h1",t?[p("a",{attrs:{href:t.url,target:"_blank",rel:"noopener"}},t.name)," Tournament"]:[e.data.name]),"finished"==e.data.status?void 0:Pn(e)||Mn(e)])}const _n=e=>({attrs:{title:e}});let In;const On=e=>lichess.powertip.manualUserIn(e.elm);function jn(e,t,n){const o=t.currentPageResults?t.currentPageResults.map((t=>function(e,t){var n;const o=t.user.id;return p("tr",{key:o,class:{me:(null===(n=e.data.me)||void 0===n?void 0:n.id)==o,active:e.playerInfoId===o},hook:jt("click",(n=>e.showPlayerInfo(t)),e.redraw)},[p("td.rank",t.absent&&"finished"!=e.data.status?p("i",{attrs:{"data-icon":"Z",title:"Absent"}}):[t.rank]),p("td.player",At(t,!1,!0)),p("td.pairings",p("div",t.sheet.map((e=>"absent"==e?p(e,_n("Absent"),"-"):"bye"==e?p(e,_n("Bye"),"1"):"late"==e?p(e,_n("Late"),"½"):p("a.glpt."+(e.o?"ongoing":!0===e.w?"win":!1===e.w?"loss":"draw"),{attrs:{key:e.g,href:`/${e.g}`},hook:$t(lichess.powertip.manualGame)},e.o?"*":!0===e.w?"1":!1===e.w?"0":"½"))).concat([...Array(Math.max(0,e.data.nbRounds-t.sheet.length))].map((e=>p("r")))))),p("td.points",_n("Points"),""+t.points),p("td.tieBreak",_n("Tie Break"),""+t.tieBreak)])}(e,t))):In;return t.currentPageResults&&(In=o),p("table.slist.swiss__standing"+(n?"."+n:""),{class:{loading:!t.currentPageResults,long:e.data.round>10,xlong:e.data.round>20}},[p("tbody",{hook:{insert:On,update(e,t){On(t)}}},o)])}function $n(e){return p("div.swiss__boards.now-playing",e.map(Nn))}const Nn=e=>p(`div.swiss__board.mini-game.mini-game-${e.id}.mini-game--init.is2d`,{key:e.id,attrs:{"data-state":`${e.fen},${e.orientation},${e.lastMove}`,"data-live":e.id},hook:{insert(e){lichess.powertip.manualUserIn(e.elm)}}},[Ln(e,O(e.orientation)),p("a.cg-wrap",{attrs:{href:`/${e.id}/${e.orientation}`}}),Ln(e,e.orientation)]);function Ln(e,t){const n=e[t];return p("span.mini-game__player",[p("span.mini-game__user",[p("strong","#"+n.rank),At(n,!0,!0)]),e.clock?p(`span.mini-game__clock.mini-game__clock--${t}`,{attrs:{"data-time":e.clock[t],"data-managed":1}}):p("span.mini-game__result",e.winner?e.winner==t?1:0:"½")])}function An(e,t){const n=t.noarg;return p("table.stats",[p("tr",[p("th","Points"),p("td",""+e.points)]),p("tr",[p("th","Tie Break"),p("td",""+e.tieBreak)]),e.performance?p("tr",[p("th",n("performance")),p("td",""+e.performance)]):null])}function Rn(e,t,n){return e?p("div."+t,{class:{engine:!!e.engine}},[p("div.trophy"),p("a.text.ulpt.user-link",{attrs:{href:"/@/"+e.user.name}},Lt(e.user)),An(e,n)]):void 0}function En(e){const t=e.data.podium||[];return p("div.podium",[Rn(t[1],"second",e.trans),Rn(t[0],"first",e.trans),Rn(t[2],"third",e.trans)])}function qn(e){if(!e.playerInfoId)return;const t=e.data.playerInfo,n=e.trans.noarg,o="div.swiss__player-info.swiss__table";if((null==t?void 0:t.user.id)!==e.playerInfoId)return p(o,[p("div.stats",[p("h2",e.playerInfoId),Et()])]);const s=t.sheet.filter((e=>e.g)).length,r=t.sheet.filter((e=>e.w)).length,a=s?Math.round(t.sheet.reduce(((e,t)=>e+(t.rating||1)),0)/s):void 0;return p(o,{hook:{insert:Bn,postpatch(e,t){Bn(t)}}},[p("a.close",{attrs:Nt("L"),hook:jt("click",(()=>e.showPlayerInfo(t)),e.redraw)}),p("div.stats",[p("h2",[p("span.rank",t.rank+". "),At(t,!0,!1)]),p("table",[Rt("Points",t.points,"raw"),Rt("Tie break",t.tieBreak,"raw"),...s?[t.performance?Rt(n("performance"),t.performance+(s<3?"?":""),"raw"):null,Rt(n("winRate"),[r,s],"percent"),Rt(n("averageOpponent"),a,"raw")]:[]])]),p("div",[p("table.pairings.sublist",{hook:jt("click",(e=>{const t=e.target.parentNode.getAttribute("data-href");t&&window.open(t,"_blank","noopener")}))},t.sheet.map(((t,n)=>{const o=e.data.round-n;if(Mt(t))return p("tr."+t,{key:o},[p("th",""+o),p("td.outcome",{attrs:{colspan:3}},t),p("td","absent"==t?"-":"bye"==t?"1":"½")]);const s=function(e){switch(e.w){case!0:return"1";case!1:return"0";default:return e.o?"*":"½"}}(t);return p("tr.glpt."+("1"===s?".win":"0"===s?".loss":""),{key:o,attrs:{"data-href":"/"+t.g+(t.c?"":"/black")},hook:{destroy:e=>$.powerTip.destroy(e.elm)}},[p("th",""+o),p("td",Lt(t.user)),p("td",""+t.rating),p("td.is.color-icon."+(t.c?"white":"black")),p("td",s)])})))])])}function Bn(e){const t=e.elm,n=lichess.powertip;n.manualUserIn(t),n.manualGameIn(t)}function Kn(e){const t=e.data,n="created"==t.status?function(e){const t=Wt(e);return[Tn(e),Wn(e),Fn(e,t),jn(e,t,"created"),e.data.quote?p("blockquote.pull-quote",[p("p",e.data.quote.text),p("footer",e.data.quote.author)]):void 0]}(e):"started"==t.status?function(e){const t=Wt(e);return[Tn(e),Hn(e)||Dn(e),Wn(e),Fn(e,t),jn(e,t,"started")]}(e):function(e){const t=Wt(e);return[p("div.podium-wrap",[zn(e.data),Tn(e),En(e)]),Fn(e,t),jn(e,t,"finished")]}(e);return p("main."+e.opts.classes,{hook:{postpatch(){lichess.miniGame.initAll()}}},[p("aside.swiss__side",{hook:$t((t=>{$(t).replaceWith(e.opts.$side),e.opts.chat&&lichess.makeChat(e.opts.chat)}))}),p("div.swiss__underchat",{hook:$t((e=>{$(e).replaceWith($(".swiss__underchat.none").removeClass("none"))}))}),qn(e)||Vn(e)||(o=t.boards,p("div.swiss__board__top.swiss__table",o.slice(0,1).map(Nn))),p("div.swiss__main",[p("div.box.swiss__main-"+t.status,n),$n(t.boards)]),e.opts.chat?p("div.chat__members.none",{hook:$t(lichess.watchers)}):null]);var o}const Dn=e=>{const t=e.data;return t.me&&!t.me.absent&&"started"==t.status&&t.nextRound?p("div.swiss__notice.bar-glider",e.trans("standByX",t.me.name)):void 0};function Fn(e,t){return p("div.swiss__controls",[p("div.pager",Ft(e,t)),Gn(e)])}function Wn(e){var t;if(e.opts.schedule&&!e.data.nbOngoing&&0!=e.data.round)return p("form.schedule-next-round",{class:{required:!e.data.nextRound},attrs:{action:`/swiss/${e.data.id}/schedule-next-round`,method:"post"}},[p("input",{attrs:{name:"date",placeholder:"Schedule the next round",value:(null===(t=e.data.nextRound)||void 0===t?void 0:t.at)||""},hook:$t((e=>window.LichessFlatpickr(e,{minDate:"today",maxDate:new Date(Date.now()+26784e5),dateFormat:"Z",altInput:!0,altFormat:"Y-m-d h:i K",enableTime:!0,monthSelectorType:"static",onClose(){e.parentNode.submit()}})))})])}function Gn(e){const t=e.data;return e.opts.userId?t.joinTeam?p("a.fbt.text.highlight",{attrs:{href:`/team/${t.joinTeam}`,"data-icon":"f"}},"Join the team"):t.canJoin?e.joinSpinner?Et():p("button.fbt.text.highlight",{attrs:Nt("G"),hook:jt("click",(n=>{if(t.password){const t=prompt(e.trans.noarg("password"));null!==t&&e.join(t)}else e.join()}),e.redraw)},e.trans.noarg("join")):t.me&&"finished"!=t.status?t.me.absent?e.joinSpinner?Et():p("button.fbt.text.highlight",{attrs:Nt("G"),hook:jt("click",(t=>e.join()),e.redraw)},e.trans.noarg("join")):e.joinSpinner?Et():p("button.fbt.text",{attrs:Nt("b"),hook:jt("click",e.withdraw,e.redraw)},e.trans.noarg("withdraw")):void 0:p("a.fbt.text.highlight",{attrs:{href:"/login?referrer="+window.location.pathname,"data-icon":"G"}},e.trans("signIn"))}function Hn(e){var t;const n=null===(t=e.data.me)||void 0===t?void 0:t.gameId;return n?p("a.swiss__ur-playing.button.is.is-after",{attrs:{href:"/"+n}},[e.trans("youArePlaying"),p("br"),e.trans("joinTheGame")]):void 0}function zn(e){return e.me&&e.isRecentlyFinished&&lichess.once("tournament.end.canvas."+e.id)?p("canvas#confetti",{hook:{insert:e=>lichess.loadScript("javascripts/confetti.js")}}):void 0}function Vn(e){const t=e.data.stats,n=e.trans.noarg,o=e.data.round*e.data.nbPlayers;return t?p("div.swiss__stats",[p("h2",n("tournamentComplete")),p("table",[Rt(n("averageElo"),t.averageRating,"raw"),Rt(n("gamesPlayed"),t.games),Rt(n("whiteWins"),[t.whiteWins,o],"percent"),Rt(n("blackWins"),[t.blackWins,o],"percent"),Rt(n("draws"),[t.draws,o],"percent"),Rt("Byes",[t.byes,o],"percent"),Rt("Absences",[t.absences,o],"percent")]),p("div.swiss__stats__links",[p("a",{attrs:{href:`/swiss/${e.data.id}/round/1`}},e.trans("viewAllXRounds",e.data.round)),p("br"),p("a.text",{attrs:{"data-icon":"x",href:`/swiss/${e.data.id}.trf`,download:!0}},"Download TRF file"),p("a.text",{attrs:{"data-icon":"x",href:`/api/swiss/${e.data.id}/games`,download:!0}},"Download all games"),p("a.text",{attrs:{"data-icon":"x",href:`/api/swiss/${e.data.id}/results`,download:!0}},"Download results as NDJSON"),p("a.text",{attrs:{"data-icon":"x",href:`/api/swiss/${e.data.id}/results?as=csv`,download:!0}},"Download results as CSV"),p("br"),p("a.text",{attrs:{"data-icon":"",href:"https://lichess.org/api#tag/Swiss-tournaments"}},"Swiss API documentation")])]):void 0}const Xn=u([y,b]);return window.Chessground=function(e,t){const n={pieces:be(me),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:I()};function o(){const t="dom"in n?n.dom.unbind:void 0,o=n.viewOnly&&!n.drawable.visible,s=function(e,t,n){e.innerHTML="",e.classList.add("cg-wrap");for(const n of k)e.classList.toggle("orientation-"+n,t.orientation===n);e.classList.toggle("manipulable",!t.viewOnly);const o=F("cg-helper");e.appendChild(o);const s=F("cg-container");o.appendChild(s);const r=F("cg-board");let a,i,c;if(s.appendChild(r),t.drawable.visible&&!n&&(a=Je(Ge("svg"),{class:"cg-shapes"}),a.appendChild(Ge("defs")),a.appendChild(Ge("g")),i=Je(Ge("svg"),{class:"cg-custom-svgs"}),i.appendChild(Ge("g")),s.appendChild(a),s.appendChild(i)),t.coordinates){const e="black"===t.orientation?" black":"";s.appendChild(st(C,"ranks"+e)),s.appendChild(st(x,"files"+e))}return t.draggable.showGhost&&!n&&(c=F("piece","ghost"),B(c,!1),s.appendChild(c)),{board:r,container:s,ghost:c,svg:a,customSvg:i}}(e,n,o),r=function(e){let t;const n=()=>(void 0===t&&(t=e()),t);return n.clear=()=>{t=void 0},n}((()=>s.board.getBoundingClientRect())),a=e=>{ct(c),!e&&s.svg&&He(c,s.svg,s.customSvg)},i=()=>{r.clear(),function(e){if(e.dom.relative)return;const t=fe(e),n=A(e.dom.bounds());let o=e.dom.elements.board.firstChild;for(;o;)(lt(o)&&!o.cgAnimating||dt(o))&&E(o,n(T(o.cgKey),t)),o=o.nextSibling}(c),s.svg&&He(c,s.svg,s.customSvg)},c=n;return c.dom={elements:s,bounds:r,redraw:gt(a),redrawNow:a,unbind:t,relative:o},c.drawable.prevSvgHash="",a(!1),rt(c,i),t||(c.dom.unbind=function(e,t){const n=[];if(e.dom.relative||!e.resizable||"ResizeObserver"in window||n.push(at(document.body,"chessground.resize",t)),!e.viewOnly){const t=it(e,Ee,Oe),o=it(e,qe,je);for(const e of["touchmove","mousemove"])n.push(at(document,e,t));for(const e of["touchend","mouseup"])n.push(at(document,e,o));const s=()=>e.dom.bounds.clear();n.push(at(document,"scroll",s,{capture:!0,passive:!0})),n.push(at(window,"resize",s,{passive:!0}))}return()=>n.forEach((e=>e()))}(c,i)),c.events.insert&&c.events.insert(s),c}return we(n,t||{}),We(o(),o)},window.LichessChat=function(e,t){const n=u([y,b]),o=tn(t,(function(){r=n(r,Cn(o))})),s=Cn(o);e.innerHTML="";let r=n(e,s);return o},e.start=function(e){const t=document.querySelector("main.swiss");let n;function o(){n=Xn(n,Kn(s))}lichess.socket=new lichess.StrongSocket("/swiss/"+e.data.id,e.data.socketVersion||0,{receive:(e,t)=>s.socket.receive(e,t)}),e.classes=t.getAttribute("class"),e.socketSend=lichess.socket.send,e.element=t,e.$side=$(".swiss__side").clone();const s=new Gt(e,o),r=Kn(s);t.innerHTML="",n=Xn(t,r),o()},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
