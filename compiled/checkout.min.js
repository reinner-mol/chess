var checkoutStart=function(){"use strict";const t={Accept:"application/vnd.lichess.v5+json"},n={cache:"no-cache",credentials:"same-origin"},e={"X-Requested-With":"XMLHttpRequest"},i=t=>{const n=new FormData;for(const e of Object.keys(t))n.append(e,t[e]);return n};return function(o){const s=$("div.plan_checkout"),c={cents:parseInt(s.data("lifetime-cents")),usd:s.data("lifetime-usd")},a=100,r=1e7;"#onetime"===location.hash&&$("#freq_onetime").trigger("click"),"#lifetime"===location.hash&&$("#freq_lifetime").trigger("click");const u=function(){return s.find("group.freq input:checked").val()};s.find(".amount_choice group.amount input:checked").data("amount")||s.find("#plan_monthly_1000").trigger("click");const l=function(){const t=u();s.find(".amount_fixed").toggleClass("none","lifetime"!=t),s.find(".amount_choice").toggleClass("none","lifetime"==t)};l(),s.find("group.freq input").on("change",l),s.find("group.amount .other label").on("click",(function(){let t;const n=prompt(this.title)||"";try{t=parseFloat(n.replace(",",".").replace(/[^0-9\.]/gim,""))}catch(t){return!1}let e=Math.round(100*t);if(!e)return $(this).text($(this).data("trans-other")),s.find("#plan_monthly_1000").trigger("click"),!1;e<a?e=a:e>r&&(e=r);const i="$"+e/100;$(this).text(i),$(this).siblings("input").data("amount",e).data("usd",i)})),s.find("button.paypal").on("click",(function(){const t=u(),n="lifetime"==t?c.cents:parseInt(s.find("group.amount input:checked").data("amount"));if(!n||n<a||n>r)return;const e=n/100,i=s.find("form.paypal_checkout."+t);i.find("input.amount").val(""+e),i[0].submit(),s.find(".service").html(lichess.spinnerHtml)}));const d=window.Stripe(o),f=t=>{alert(t)};s.find("button.stripe").on("click",(function(){const o=u(),l="lifetime"==o?c.cents:parseInt(s.find("group.amount input:checked").data("amount"));l<a||l>r||(s.find(".service").html(lichess.spinnerHtml),((i,o={})=>fetch(i,Object.assign(Object.assign(Object.assign({},n),{headers:Object.assign(Object.assign({},t),e)}),o)).then((t=>{if(t.ok)return t.json();throw t.statusText})))("/patron/stripe-checkout",{method:"post",body:i({email:s.data("email"),amount:l,freq:o})}).then((t=>{t.session&&t.session.id?d.redirectToCheckout({sessionId:t.session.id}).then((t=>f(t.error.message))):location.assign("/patron")}),f))})),$(window).on("popstate",(function(){window.stripeHandler.close()}))}}();
