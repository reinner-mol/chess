var LichessChat=function(){"use strict";const t={createElement:function(t,e){return document.createElement(t,e)},createElementNS:function(t,e,n){return document.createElementNS(t,e,n)},createTextNode:function(t){return document.createTextNode(t)},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,n){t.insertBefore(e,n)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){t.appendChild(e)},parentNode:function(t){return t.parentNode},nextSibling:function(t){return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},getTextContent:function(t){return t.textContent},isElement:function(t){return 1===t.nodeType},isText:function(t){return 3===t.nodeType},isComment:function(t){return 8===t.nodeType}};function e(t,e,n,o,s){return{sel:t,data:e,children:n,text:o,elm:s,key:void 0===e?void 0:e.key}}const n=Array.isArray;function o(t){return"string"==typeof t||"number"==typeof t}function s(t){return void 0===t}function a(t){return void 0!==t}const r=e("",{},[],void 0,void 0);function i(t,e){var n,o;const s=t.key===e.key,a=(null===(n=t.data)||void 0===n?void 0:n.is)===(null===(o=e.data)||void 0===o?void 0:o.is);return t.sel===e.sel&&s&&a}function l(t,e,n){var o;const s={};for(let a=e;a<=n;++a){const e=null===(o=t[a])||void 0===o?void 0:o.key;void 0!==e&&(s[e]=a)}return s}const c=["create","update","remove","destroy","pre","post"];function u(u,d){let h,m;const p={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},f=void 0!==d?d:t;for(h=0;h<c.length;++h)for(p[c[h]]=[],m=0;m<u.length;++m){const t=u[m][c[h]];void 0!==t&&p[c[h]].push(t)}function g(t){const n=t.id?"#"+t.id:"",o=t.className?"."+t.className.split(" ").join("."):"";return e(f.tagName(t).toLowerCase()+n+o,{},[],void 0,t)}function v(t,e){return function(){if(0==--e){const e=f.parentNode(t);f.removeChild(e,t)}}}function b(t,e){var i,l;let c,u=t.data;if(void 0!==u){const e=null===(i=u.hook)||void 0===i?void 0:i.init;a(e)&&(e(t),u=t.data)}const d=t.children,h=t.sel;if("!"===h)s(t.text)&&(t.text=""),t.elm=f.createComment(t.text);else if(void 0!==h){const s=h.indexOf("#"),i=h.indexOf(".",s),m=s>0?s:h.length,g=i>0?i:h.length,v=-1!==s||-1!==i?h.slice(0,Math.min(m,g)):h,y=t.elm=a(u)&&a(c=u.ns)?f.createElementNS(c,v,u):f.createElement(v,u);for(m<g&&y.setAttribute("id",h.slice(m+1,g)),i>0&&y.setAttribute("class",h.slice(g+1).replace(/\./g," ")),c=0;c<p.create.length;++c)p.create[c](r,t);if(n(d))for(c=0;c<d.length;++c){const t=d[c];null!=t&&f.appendChild(y,b(t,e))}else o(t.text)&&f.appendChild(y,f.createTextNode(t.text));const k=t.data.hook;a(k)&&(null===(l=k.create)||void 0===l||l.call(k,r,t),k.insert&&e.push(t))}else t.elm=f.createTextNode(t.text);return t.elm}function y(t,e,n,o,s,a){for(;o<=s;++o){const s=n[o];null!=s&&f.insertBefore(t,b(s,a),e)}}function k(t){var e,n;const o=t.data;if(void 0!==o){null===(n=null===(e=null==o?void 0:o.hook)||void 0===e?void 0:e.destroy)||void 0===n||n.call(e,t);for(let e=0;e<p.destroy.length;++e)p.destroy[e](t);if(void 0!==t.children)for(let e=0;e<t.children.length;++e){const n=t.children[e];null!=n&&"string"!=typeof n&&k(n)}}}function w(t,e,n,o){for(var s,r;n<=o;++n){let o,i;const l=e[n];if(null!=l)if(a(l.sel)){k(l),o=p.remove.length+1,i=v(l.elm,o);for(let t=0;t<p.remove.length;++t)p.remove[t](l,i);const t=null===(r=null===(s=null==l?void 0:l.data)||void 0===s?void 0:s.hook)||void 0===r?void 0:r.remove;a(t)?t(l,i):i()}else f.removeChild(t,l.elm)}}function x(t,e,n){var o,r,c,u,d;const h=null===(o=e.data)||void 0===o?void 0:o.hook;null===(r=null==h?void 0:h.prepatch)||void 0===r||r.call(h,t,e);const m=e.elm=t.elm,g=t.children,v=e.children;if(t!==e){if(void 0!==e.data){for(let n=0;n<p.update.length;++n)p.update[n](t,e);null===(u=null===(c=e.data.hook)||void 0===c?void 0:c.update)||void 0===u||u.call(c,t,e)}s(e.text)?a(g)&&a(v)?g!==v&&function(t,e,n,o){let a,r,c,u,d=0,h=0,m=e.length-1,p=e[0],g=e[m],v=n.length-1,k=n[0],T=n[v];for(;d<=m&&h<=v;)null==p?p=e[++d]:null==g?g=e[--m]:null==k?k=n[++h]:null==T?T=n[--v]:i(p,k)?(x(p,k,o),p=e[++d],k=n[++h]):i(g,T)?(x(g,T,o),g=e[--m],T=n[--v]):i(p,T)?(x(p,T,o),f.insertBefore(t,p.elm,f.nextSibling(g.elm)),p=e[++d],T=n[--v]):i(g,k)?(x(g,k,o),f.insertBefore(t,g.elm,p.elm),g=e[--m],k=n[++h]):(void 0===a&&(a=l(e,d,m)),r=a[k.key],s(r)?f.insertBefore(t,b(k,o),p.elm):(c=e[r],c.sel!==k.sel?f.insertBefore(t,b(k,o),p.elm):(x(c,k,o),e[r]=void 0,f.insertBefore(t,c.elm,p.elm))),k=n[++h]);(d<=m||h<=v)&&(d>m?(u=null==n[v+1]?null:n[v+1].elm,y(t,u,n,h,v,o)):w(t,e,d,m))}(m,g,v,n):a(v)?(a(t.text)&&f.setTextContent(m,""),y(m,null,v,0,v.length-1,n)):a(g)?w(m,g,0,g.length-1):a(t.text)&&f.setTextContent(m,""):t.text!==e.text&&(a(g)&&w(m,g,0,g.length-1),f.setTextContent(m,e.text)),null===(d=null==h?void 0:h.postpatch)||void 0===d||d.call(h,t,e)}}return function(t,e){let n,o,s;const a=[];for(n=0;n<p.pre.length;++n)p.pre[n]();for(function(t){return void 0!==t.sel}(t)||(t=g(t)),i(t,e)?x(t,e,a):(o=t.elm,s=f.parentNode(o),b(e,a),null!==s&&(f.insertBefore(s,e.elm,f.nextSibling(o)),w(s,[t],0,0))),n=0;n<a.length;++n)a[n].data.hook.insert(a[n]);for(n=0;n<p.post.length;++n)p.post[n]();return e}}function d(t,e,n){if(t.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==e)for(let t=0;t<e.length;++t){const n=e[t].data;void 0!==n&&d(n,e[t].children,e[t].sel)}}function h(t,s,a){let r,i,l,c={};if(void 0!==a?(null!==s&&(c=s),n(a)?r=a:o(a)?i=a:a&&a.sel&&(r=[a])):null!=s&&(n(s)?r=s:o(s)?i=s:s&&s.sel?r=[s]:c=s),void 0!==r)for(l=0;l<r.length;++l)o(r[l])&&(r[l]=e(void 0,void 0,void 0,r[l],void 0));return"s"!==t[0]||"v"!==t[1]||"g"!==t[2]||3!==t.length&&"."!==t[3]&&"#"!==t[3]||d(c,r,t),e(t,c,r,i,void 0)}function m(t,e){t.data.fn=e.data.fn,t.data.args=e.data.args,e.data=t.data,e.children=t.children,e.text=t.text,e.elm=t.elm}function p(t){const e=t.data;m(e.fn(...e.args),t)}function f(t,e){let n;const o=t.data,s=e.data,a=o.args,r=s.args;if(o.fn===s.fn&&a.length===r.length){for(n=0;n<r.length;++n)if(a[n]!==r[n])return void m(s.fn(...r),e);m(t,e)}else m(s.fn(...r),e)}function g(t,e){let n;const o=e.elm;let s=t.data.attrs,a=e.data.attrs;if((s||a)&&s!==a){for(n in s=s||{},a=a||{},a){const t=a[n];s[n]!==t&&(!0===t?o.setAttribute(n,""):!1===t?o.removeAttribute(n):120!==n.charCodeAt(0)?o.setAttribute(n,t):58===n.charCodeAt(3)?o.setAttributeNS("http://www.w3.org/XML/1998/namespace",n,t):58===n.charCodeAt(5)?o.setAttributeNS("http://www.w3.org/1999/xlink",n,t):o.setAttribute(n,t))}for(n in s)n in a||o.removeAttribute(n)}}const v={create:g,update:g};function b(t,e){let n,o;const s=e.elm;let a=t.data.class,r=e.data.class;if((a||r)&&a!==r){for(o in a=a||{},r=r||{},a)a[o]&&!Object.prototype.hasOwnProperty.call(r,o)&&s.classList.remove(o);for(o in r)n=r[o],n!==a[o]&&s.classList[n?"add":"remove"](o)}}const y={create:b,update:b};function k(t,e){const n=t.substring(0,14);return h("a",{class:{"user-link":!0,ulpt:!0},attrs:{href:"/@/"+t}},e&&"BOT"!=e?[h("span.utitle",e),n]:[n])}function w(t,e){return{insert(n){n.elm.addEventListener(t,e)}}}const x={start:["hi/Hello","gl/Good luck","hf/Have fun!","u2/You too!"].map(T),end:["gg/Good game","wp/Well played","ty/Thank you","gtg/I've got to go","bye/Bye!"].map(T)};function T(t){const e=t.split("/");return{key:e[0],text:e[1]}}const C=t=>{let e=t;return function(t){return(t=>void 0!==t)(t)&&(e=t),e}},E={Accept:"application/vnd.lichess.v5+json"},N={cache:"no-cache",credentials:"same-origin"},_={"X-Requested-With":"XMLHttpRequest"},j=(t,e={})=>fetch(t,Object.assign(Object.assign(Object.assign({},N),{headers:Object.assign(Object.assign({},E),_)}),e)).then((t=>{if(t.ok)return t.json();throw t.statusText})),L=(t,e={})=>O(t,e).then((t=>{if(t.ok)return t.text();throw t.statusText})),O=(t,e={})=>fetch(t,Object.assign(Object.assign(Object.assign({},N),{headers:Object.assign({},_)}),e)),I=t=>{const e=new FormData;for(const n of Object.keys(t))e.append(n,t[n]);return e},A=t=>L(S(t)),S=t=>`/${t}/note`;function B(t){let e=t.text;const n=function(t,e,n=!1){let o,s=0;return function(...a){const r=this;o&&clearTimeout(o),o=void 0;const i=performance.now()-s;s=performance.now(),n&&i>e?t.apply(r,a):o=setTimeout((()=>{o=void 0,t.apply(r,a)}),e)}}((()=>{((t,e)=>{j(S(t),{method:"post",body:I({text:e})})})(t.id,e||"")}),1e3);return{id:t.id,trans:t.trans,text:()=>e,fetch(){A(t.id).then((n=>{e=n||"",t.redraw()}))},post(t){e=t,n()}}}function R(t){const e=t.text();return null==e?h("div.loading",{hook:{insert:t.fetch}}):h("textarea",{attrs:{placeholder:t.trans("typePrivateNotesHere")},hook:{insert(n){const o=$(n.elm);o.val(e).on("change keyup paste",(()=>t.post(o.val())))}}})}let q=!1;function H(t){let e,n=!1;const o=()=>{e=void 0,n=!1,t.redraw()};return{loading:()=>n,data:()=>e,reasons:t.reasons,permissions:()=>t.permissions,open:o=>{const s=o.querySelector("a.user-link"),a=o.querySelector("t").innerText,r=s.href.split("/")[4];t.permissions.timeout?(n=!0,(t=>j("/mod/chat-user/"+t))(r).then((o=>{e=Object.assign(Object.assign({},o),{text:a}),n=!1,t.redraw()}))):e={id:r.toLowerCase(),username:r,text:a},t.redraw()},close:o,timeout(n,s){e&&lichess.pubsub.emit("socket.send","timeout",{userId:e.id,reason:n.key,text:s}),o(),t.redraw()}}}const M=()=>h("i.mod",{attrs:{"data-icon":""}});function G(t,e){const n=t.data;n.domVersion=1;const o={instance:void 0,loaded:!1,enabled:C(!!n.palantir)},s=["discussion"];t.noteId&&s.push("note"),t.plugin&&s.push(t.plugin.tab.key);const a=lichess.storage.make("chat.tab"),r=a.get();let i;const l={tab:s.find((t=>t===r))||s[0],enabled:t.alwaysEnabled||!lichess.storage.get("nochat"),placeholderKey:"talkInChat",loading:!1,timeout:t.timeout,writeable:t.writeable};s.length>1&&"discussion"===l.tab&&lichess.storage.get("nochat")&&(l.tab=s[1]);const c=t=>!!(t=t.trim())&&(!("You too!"==t&&!n.lines.some((t=>t.u!=n.userId)))&&(t.length>140?(alert("Max length: 140 chars. "+t.length+" chars used."),!1):(lichess.pubsub.emit("socket.send","talk",t),!0))),u=lichess.trans(t.i18n);function d(){(t.permissions.timeout||t.permissions.local)&&(i=H({reasons:t.timeoutReasons||[{key:"other",name:"Inappropriate behavior"}],permissions:t.permissions,redraw:e}),t.loadCss("chat.mod"))}d();const h=t.noteId?B({id:t.noteId,text:t.noteText,trans:u,redraw:e}):void 0,m=function(t){let e=t.initialGroup,n=[];return{group:()=>e,said:()=>n,setGroup(o){o!==e&&(e=o,o||(n=[]),t.redraw())},post(o){e&&x[e]&&(n.includes(o.key)||t.post(o.text)&&n.push(o.key))}}}({initialGroup:t.preset,post:c,redraw:e}),p=[["socket.in.message",t=>{n.lines.push(t);const o=n.lines.length;o>200&&(n.lines.splice(0,o-200+50),n.domVersion++),e()}],["socket.in.chat_timeout",t=>{let o=!1;n.lines.forEach((e=>{e.u&&e.u.toLowerCase()==t&&(e.d=!0,o=!0)})),t==n.userId&&(l.timeout=o=!0),o&&(n.domVersion++,e())}],["socket.in.chat_reinstate",t=>{t==n.userId&&(l.timeout=!1,e())}],["chat.writeable",t=>{l.writeable=t,e()}],["chat.permissions",n=>{let o;for(o in n)t.permissions[o]=n[o];d(),e()}],["palantir.toggle",o.enabled]];p.forEach((([t,e])=>lichess.pubsub.on(t,e)));const f=()=>lichess.pubsub.emit("chat.enabled",l.enabled);return f(),{data:n,opts:t,vm:l,allTabs:s,setTab(t){l.tab=t,a.set(t),"discussion"===t&&lichess.requestIdleCallback((()=>$(".mchat__say").each((function(){this.focus()}))),500),e()},moderation:()=>i,note:h,preset:m,post:c,trans:u,plugin:t.plugin,setEnabled(t){l.enabled=t,f(),t?lichess.storage.remove("nochat"):lichess.storage.set("nochat","1"),e()},redraw:e,palantir:o,destroy:()=>{p.forEach((([t,e])=>lichess.pubsub.off(t,e)))}}}const z=/(^|[^\w@#/])@([a-z0-9][a-z0-9_-]{0,28}[a-z0-9])/gi;function K(t,e,n){return t.includes("&quot;")?t:`<a target="_blank" rel="noopener nofollow noreferrer" href="${t.startsWith("/")||t.includes("://")?t:"//"+t}"${n?` class="${n}"`:""}>${e||t}</a>`}const P=/\b\b(?:https?:\/\/)?(lichess\.org\/[-–—\w+&'@#\/%?=()~|!:,.;]+[\w+&@#\/%=~|])/gi,V=/^[a-h][2-7]$/,W=/\b(\d+)\s*(\.+)\s*(?:[o0-]+[o0]|[NBRQKP\u2654\u2655\u2656\u2657\u2658\u2659]?[a-h]?[1-8]?[x@]?[a-z][1-8](?:=[NBRQK\u2654\u2655\u2656\u2657\u2658\u2659])?)\+?#?[!\?=]{0,5}/gi;function F(t,e,n){if(e<1||e>200)return t;return'<a class="jump" data-ply="'+(2*e-(n.length>1?0:1))+'">'+t+"</a>"}function X(t,e,n){return n.match(V)?t:function(t,e,n){return e+K("/@/"+n,"@"+n)}(0,e,n)}function Q(t,e){const n=lichess.escapeHtml(t),o=n.replace(z,X).replace(P,K);return e&&o===n?o.replace(W,F):o}const Y=()=>"1"==lichess.storage.get("chat-spam"),D=new RegExp(["xcamweb.com","(^|[^i])chess-bot","chess-cheat","coolteenbitch","letcafa.webcam","tinyurl.com/","wooga.info/","bit.ly/","wbt.link/","eb.by/","001.rs/","shr.name/","u.to/",".3-a.net",".ssl443.org",".ns02.us",".myftp.info",".flinkup.com",".serveusers.com","badoogirls.com","hide.su","wyon.de","sexdatingcz.club","qps.ru","tiny.cc/"].map((t=>t.replace(/\./g,"\\.").replace(/\//g,"\\/"))).join("|")),J=t=>!!t.match(D),U=/follow me|join my team/i,Z=t=>!!t.match(U),tt=/lichess\.org\/team\//i,et=/^\/[wW](?:hisper)?\s/;function nt(t){if(!t.vm.enabled)return[];const e=e=>{const n=e.elm;if(t.data.lines.length>5){(0===n.scrollTop||n.scrollTop>n.scrollHeight-n.clientHeight-100)&&(n.scrollTop=999999,setTimeout((t=>n.scrollTop=999999),300))}},n=!!t.moderation(),o=[h("ol.mchat__messages.chat-v-"+t.data.domVersion,{attrs:{role:"log","aria-live":"polite","aria-atomic":"false"},hook:{insert(o){const s=$(o.elm).on("click","a.jump",(t=>{lichess.pubsub.emit("jump",t.target.getAttribute("data-ply"))}));n?s.on("click",".mod",(e=>{var n;return null===(n=t.moderation())||void 0===n?void 0:n.open(e.target.parentNode)})):s.on("click",".flag",(e=>function(t,e){const n=e.querySelector("a.user-link"),o=e.querySelector("t").innerText;n&&confirm(`Report "${o}" to moderators?`)&&((t,e,n)=>{j("/report/flag",{method:"post",body:I({username:e,resource:t,text:n})})})(t.data.resourceId,n.href.split("/")[4],o)}(t,e.target.parentNode))),e(o)},postpatch:(t,n)=>e(n)}},rt(t).map((e=>function(t,e){const n=function(t,e){if(n=t,/(\n|(@|#|\.)\w{2,})/.test(n)){const n=function(t){return(e,n)=>{n.data.lichessChat!==e.data.lichessChat&&(n.elm.innerHTML=Q(n.data.lichessChat,t))}}(e);return h("t",{lichessChat:t,hook:{create:n,update:n}})}var n;return h("t",t)}(e.t,t.opts.parseMoves);if("lichess"===e.u)return h("li.system",n);if(e.c)return h("li",[h("span.color","["+e.c+"]"),n]);const o=(s="a",a=e.u,r=k,i=[e.u,e.title],void 0===i&&(i=r,r=a,a=void 0),h(s,{key:a,hook:{init:p,prepatch:f},fn:r,args:i}));var s,a,r,i;return h("li",t.moderation()?[e.u?M():null,o," ",n]:[t.data.userId&&e.u&&t.data.userId!=e.u?h("i.flag",{attrs:{"data-icon":"!",title:"Report"}}):null,o," ",n])}(t,e)))),ot(t)],s=function(t){const e=t.group();if(!e)return;const n=x[e],o=t.said();return n&&o.length<2?h("div.mchat__presets",n.map((e=>{const n=o.includes(e.key);return h("span",{class:{disabled:n},attrs:{title:e.text,disabled:n},hook:w("click",(()=>{!n&&t.post(e)}))},e.key)}))):void 0}(t.preset);return s&&o.push(s),o}function ot(t){if(!t.vm.writeable)return;if(t.data.loginRequired&&!t.data.userId||t.data.restricted)return h("input.mchat__say",{attrs:{placeholder:t.trans("loginToChat"),disabled:!0}});let e;return e=t.vm.timeout?t.trans("youHaveBeenTimedOut"):t.opts.blind?"Chat":t.trans.noarg(t.vm.placeholderKey),h("input.mchat__say",{attrs:{placeholder:e,autocomplete:"off",maxlength:140,disabled:t.vm.timeout||!t.vm.writeable,"aria-label":"Chat input"},hook:{insert(e){at(t,e.elm)}}})}let st;const at=(t,e)=>{const n=lichess.tempStorage.make("chat.input"),o=n.get();o&&(e.value=o,e.focus(),!t.opts.public&&o.match(et)&&e.classList.add("whisper")),e.addEventListener("keydown",(e=>{"Enter"===e.key&&setTimeout((()=>{const o=e.target,s=o.value,a=t.opts.public;""===s?$(".keyboard-move input").each((function(){this.focus()})):(t.opts.kobold||(t=>{if(Y())return;const e=J(t);e&&L(`/jslog/${window.location.href.substr(-12)}?n=spam`,{method:"post"}),(e||Z(t))&&lichess.storage.set("chat-spam","1")})(s),a&&(t=>!!t.match(tt))(s)?alert("Please don't advertise teams in the chat."):t.post(s),o.value="",n.remove(),a||o.classList.remove("whisper"))}))})),e.addEventListener("input",(e=>setTimeout((()=>{const o=e.target,s=o.value;o.removeAttribute("placeholder"),t.opts.public||o.classList.toggle("whisper",!!s.match(et)),n.set(s)})))),window.Mousetrap.bind("c",(()=>e.focus()));const s=["touchstart","mousedown"];st&&s.forEach((t=>document.body.removeEventListener(t,st,{capture:!0}))),st=t=>{t.shiftKey||2===t.buttons||2===t.button||e.blur()},e.onfocus=()=>s.forEach((t=>document.body.addEventListener(t,st,{passive:!0,capture:!0}))),e.onblur=()=>s.forEach((t=>document.body.removeEventListener(t,st,{capture:!0})))};function rt(t){const e=[];let n;return t.data.lines.forEach((o=>{var s,a,r;o.d||n&&(r=o,(a=n).d&&r.d&&a.u===r.u)||o.r&&(o.u||"").toLowerCase()!=t.data.userId||(s=o.t,(J(s)||Z(s))&&!Y())||e.push(o),n=o})),e}function it(t){const e=t.moderation();return h("section.mchat"+(t.opts.alwaysEnabled?"":".mchat-optional"),{class:{"mchat-mod":!!e},hook:{destroy:t.destroy}},function(t){if(!t)return;if(t.loading())return[h("div.loading")];const e=t.data();if(!e)return;const n=t.permissions(),o=e.history?h("div.infos.block",[(s=e.games||0,!1===q&&(q=window.Intl&&Intl.NumberFormat?new Intl.NumberFormat:null),(null===q?""+s:q.format(s))+" games"),e.troll?"TROLL":void 0,e.engine?"ENGINE":void 0,e.booster?"BOOSTER":void 0].map((t=>t&&h("span",t))).concat([h("a",{attrs:{href:"/@/"+e.username+"?mod"}},"profile")]).concat(n.shadowban?[h("a",{attrs:{href:"/mod/"+e.username+"/communication"}},"coms")]:[])):void 0;var s;const a=n.timeout?h("div.timeout.block",[h("strong","Timeout 15 minutes for"),...t.reasons.map((n=>h("a.text",{attrs:{"data-icon":"p"},hook:w("click",(()=>t.timeout(n,e.text)))},n.name)))]):h("div.timeout.block",[h("strong","Moderation"),h("a.text",{attrs:{"data-icon":"p"},hook:w("click",(()=>t.timeout(t.reasons[0],e.text)))},"Timeout 15 minutes")]),r=e.history?h("div.history.block",[h("strong","Timeout history"),h("table",h("tbody.slist",{hook:{insert(){lichess.contentLoaded()}}},e.history.map((function(t){return h("tr",[h("td.reason",t.reason),h("td.mod",t.mod),h("td",h("time.timeago",{attrs:{datetime:t.date}}))])}))))]):void 0;return[h("div.top",{key:"mod-"+e.id},[h("span.text",{attrs:{"data-icon":""}},[k(e.username)]),h("a",{attrs:{"data-icon":"L"},hook:w("click",t.close)})]),h("div.mchat__content.moderation",[h("i.line-text.block",['"',e.text,'"']),o,a,r])]}(e)||function(t){const e=t.vm.tab;return[h("div.mchat__tabs.nb_"+t.allTabs.length,[...t.allTabs.map((n=>function(t,e,n){return h("div.mchat__tab."+e,{class:{"mchat__tab-active":e===n},hook:w("click",(()=>t.setTab(e)))},function(t,e){return"discussion"===e?[h("span",t.data.name),t.opts.alwaysEnabled?void 0:h("input",{attrs:{type:"checkbox",title:t.trans.noarg("toggleTheChat"),checked:t.vm.enabled},hook:w("change",(e=>{t.setEnabled(e.target.checked)}))})]:"note"===e?[h("span",t.trans.noarg("notes"))]:t.plugin&&e===t.plugin.tab.key?[h("span",t.plugin.tab.name)]:[]}(t,e))}(t,n,e))),lt(t)]),h("div.mchat__content."+e,"note"===e&&t.note?[R(t.note)]:t.plugin&&e===t.plugin.tab.key?[t.plugin.view()]:nt(t))]}(t))}function lt(t){const e=t.palantir;if(e.enabled())return e.instance?e.instance.render(h):h("div.mchat__tab.palantir.palantir-slot",{attrs:{"data-icon":"",title:"Voice chat"},hook:w("click",(()=>{e.loaded||(e.loaded=!0,lichess.loadScript("javascripts/vendor/peerjs.min.js").then((()=>{lichess.loadModule("palantir").then((()=>{e.instance=window.Palantir.palantir({uid:t.data.userId,redraw:t.redraw}),t.redraw()}))})))}))})}return function(t,e){const n=u([y,v]),o=G(e,(function(){a=n(a,it(o))})),s=it(o);t.innerHTML="";let a=n(t,s);return o}}();
